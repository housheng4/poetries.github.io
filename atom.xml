<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Poetry&#39;s Blog</title>
  
  <subtitle>Choose a gesture to allow yourself to live irreplaceable.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.poetries.top/"/>
  <updated>2019-12-16T02:35:06.831Z</updated>
  <id>http://blog.poetries.top/</id>
  
  <author>
    <name>Poetry</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>学会使用Curl调试接口</title>
    <link href="http://blog.poetries.top/2019/12/12/linux-curl/"/>
    <id>http://blog.poetries.top/2019/12/12/linux-curl/</id>
    <published>2019-12-12T03:32:41.000Z</published>
    <updated>2019-12-16T02:35:06.831Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在我们平时开发接口完成后，需要上线联调接口，而接口往往和业务逻辑精密联系，想要调试接口，就需要将业务测一遍，那么有没有更好的办法使得调试更简单？</p></blockquote><p><strong>常用的接口分为两类</strong></p><ul><li>第一类：自己开发服务于自己系统的接口，该类接口调试可以在本地使用<code>postman</code>工具调试；</li><li>第二类：不是自己开发，调用别人能力接口服务于自己的系统，该类接口我们就可以使用<code>curl</code>命令调试。</li></ul><h1 id="一、Curl常用参数"><a href="#一、Curl常用参数" class="headerlink" title="一、Curl常用参数"></a>一、Curl常用参数</h1><ul><li><code>-X/--request [GET|POST|PUT|DELETE|…]</code> 使用指定的<code>http method</code>发出 <code>http request</code></li><li><code>-H/--header</code> 设定<code>request</code>里的<code>header</code></li><li><code>-i/--include</code> 显示<code>response</code>的<code>header</code></li><li><code>-d/--data</code> 设定 <code>http parameters</code></li><li><code>-v/--verbose</code> 輸出比较多的信息</li><li><code>-u/--user</code> 使用者账号</li><li><code>-b/--cookie</code> <code>cookie</code> 文件路径 使用<code>cookie</code></li></ul><blockquote><p>同一个功能常会有两个完全相同的参数, 一个是比较短的参数, 另一个是比较长的参数</p></blockquote><blockquote><p>参数<code>-X</code> 和 <code>--request</code> 两个功能是一样的 <code>curl -X POST http://www.example.com</code>  or  <code>curl --request POST http://www.example.com/</code>  是完全相同的.</p></blockquote><h1 id="二、curl发送请求参数使用"><a href="#二、curl发送请求参数使用" class="headerlink" title="二、curl发送请求参数使用"></a>二、curl发送请求参数使用</h1><ul><li><code>curl</code>发送请求参数使用</li></ul><h2 id="2-1-设置header"><a href="#2-1-设置header" class="headerlink" title="2.1 设置header"></a>2.1 设置header</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -i -H &quot;Content-Type: application/json&quot; http://www.baidu.com</span><br></pre></td></tr></table></figure><h2 id="2-2-设置HTTP-parameter"><a href="#2-2-设置HTTP-parameter" class="headerlink" title="2.2 设置HTTP parameter"></a>2.2 设置HTTP parameter</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X POST -d &quot;param1:value1&amp;param2=value2&quot; 或者 -d &quot;param1=value1&quot; -d &quot;param2=value2&quot;</span><br></pre></td></tr></table></figure><h2 id="2-3-session认证"><a href="#2-3-session认证" class="headerlink" title="2.3 session认证"></a>2.3 session认证</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X GET &apos;http://www.baidu.com/&apos; --header &apos;sessionid:sessionid值&apos;</span><br></pre></td></tr></table></figure><h2 id="2-4-使用cookie"><a href="#2-4-使用cookie" class="headerlink" title="2.4 使用cookie"></a>2.4 使用cookie</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -i --header &quot;Content-Type:application/json&quot; -X GET -b ~/cookie.txt http://www.baidu.com</span><br></pre></td></tr></table></figure><blockquote><p>测试接口上传文件:我们用 <code>-F &quot;file=@__FILE_PATH__&quot;</code> 的方式，传输文件即可, 如果想看到详细的请求信息，可以加上 <code>-v</code> 参数 <code>curl -i -X POST -F &#39;file=@/User/uploadFile.txt&#39; -H &quot;token:abc123</code>“ -v</p></blockquote><h2 id="2-5-HTTP基本认证"><a href="#2-5-HTTP基本认证" class="headerlink" title="2.5 HTTP基本认证"></a>2.5 HTTP基本认证</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -i -u username:password http://www.baidu.com/api/foo&apos;</span><br></pre></td></tr></table></figure><h2 id="2-6-post请求"><a href="#2-6-post请求" class="headerlink" title="2.6 post请求"></a>2.6 post请求</h2><blockquote><p>由于我们平时遇到接口请求都是<code>post</code>请求，所以接下来我们以<code>post</code>请求为例，分别探讨http协议和https协议两种情况下如何通过curl命令来调试接口；</p></blockquote><p><strong>http协议</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -v -X POST http://localhost:3000/api/posts --data &apos;&#123;&quot;title&quot;:&quot;controller&quot;, &quot;content&quot;: &quot;what is controller&quot;&#125;&apos; -H &apos;Content-Type:application/json; charset=UTF-8&apos;</span><br></pre></td></tr></table></figure><ul><li><code>-v</code> 显示版本信息</li><li><code>--header</code>等同于 <code>-H</code> 指定请求头（可校验调用方是否有权限，通过判断请求头信息，如果有规定的请求头信息，则允许调用，否则拒绝调用</li><li><code>--data</code> 请求参数(请求报文)</li><li><code>-X</code>：指定请求方式</li></ul><p><strong>通过 curl 发出的 HTTP 请求的内容就会是下面这样的</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST /api/posts HTTP/1.1</span><br><span class="line">Host: localhost:3000</span><br><span class="line">Content-Type: application/json; charset=UTF-8</span><br><span class="line"></span><br><span class="line">&#123;&quot;title&quot;: &quot;controller&quot;, &quot;content&quot;: &quot;what is controller&quot;&#125;</span><br></pre></td></tr></table></figure><p><strong>https协议</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -v -k -X POST http://localhost:3000/api/posts</span><br><span class="line">–cert &apos;/app/milo/tomcat/milogenius/webapps/client.crt&apos;</span><br><span class="line">–key &apos;/app/milo/tomcat/milogenius/webapps/client.key&apos;</span><br><span class="line">–pass &apos;milogenius&apos;</span><br></pre></td></tr></table></figure><ul><li><code>-k</code> :允许不使用证书到<code>SSL</code>站点;</li><li><code>-cert</code>: 客户端证书文件;</li><li><code>-key</code>: 私钥文件名 (<code>SSL</code>);</li><li><code>-pass</code>: 私钥密码 (<code>SSL</code>);</li></ul><h2 id="2-7-扩展知识"><a href="#2-7-扩展知识" class="headerlink" title="2.7 扩展知识"></a>2.7 扩展知识</h2><ul><li><code>curl post</code>请求, 数据可以采用<code>xml</code> 或者<code>json</code>格式, 并且可以发送本地<code>xml</code>和<code>json</code>文件</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -H &apos;Content-Type:application/json&apos; -X POST -d &apos;&#123;&quot;name&quot;:&quot;zhangsan&quot;&#125;&apos; http://www.baidu.com/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X POST -H &apos;content-type: application/json&apos;  -d /apps/jsonfile.json http://www.baidu.com/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X POST -H &apos;content-type:application/xml&apos;  -d &apos;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;name&gt;zhangsan&lt;/name&gt;&apos; http://www.baidu.com/</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;在我们平时开发接口完成后，需要上线联调接口，而接口往往和业务逻辑精密联系，想要调试接口，就需要将业务测一遍，那么有没有更好的办法使得调试更简单？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;常用的接口分为两类&lt;/strong&gt;&lt;/p&gt;
      
    
    </summary>
    
      <category term="Back-end" scheme="http://blog.poetries.top/categories/Back-end/"/>
    
    
      <category term="Linux" scheme="http://blog.poetries.top/tags/Linux/"/>
    
      <category term="Curl" scheme="http://blog.poetries.top/tags/Curl/"/>
    
  </entry>
  
  <entry>
    <title>Python基础小结(二)</title>
    <link href="http://blog.poetries.top/2019/12/11/python-base-2/"/>
    <id>http://blog.poetries.top/2019/12/11/python-base-2/</id>
    <published>2019-12-11T13:40:39.000Z</published>
    <updated>2019-12-16T02:35:06.835Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、初识Python"><a href="#一、初识Python" class="headerlink" title="一、初识Python"></a>一、初识Python</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/136.png" alt="初识Python"></p><h2 id="二、语法基础"><a href="#二、语法基础" class="headerlink" title="二、语法基础"></a>二、语法基础</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/155.png" alt="语法基础"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/156.png" alt="变量"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/157.png" alt="运算符"></p><h3 id="2-1-字符串处理"><a href="#2-1-字符串处理" class="headerlink" title="2.1 字符串处理"></a>2.1 字符串处理</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/158.png" alt="创建字符串"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/159.png" alt="字符串连接"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/160.png" alt="字符串运算"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/161.png" alt="字符串转译"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/162.png" alt="切片"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/163.png" alt="常用函数"></p><h3 id="2-2-列表"><a href="#2-2-列表" class="headerlink" title="2.2 列表"></a>2.2 列表</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/164.png" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/12/165.png" alt></p><h3 id="2-3-元组"><a href="#2-3-元组" class="headerlink" title="2.3 元组"></a>2.3 元组</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/166.png" alt></p><h3 id="2-4-字典"><a href="#2-4-字典" class="headerlink" title="2.4 字典"></a>2.4 字典</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/173.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/12/174.png" alt></p><h3 id="2-5-函数"><a href="#2-5-函数" class="headerlink" title="2.5 函数"></a>2.5 函数</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/167.png" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/12/168.png" alt></p><h3 id="2-6-流程控制"><a href="#2-6-流程控制" class="headerlink" title="2.6 流程控制"></a>2.6 流程控制</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/169.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/12/170.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/12/171.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/12/172.png" alt></p><h2 id="三、类"><a href="#三、类" class="headerlink" title="三、类"></a>三、类</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/175.png" alt></p><h3 id="3-1-创建类"><a href="#3-1-创建类" class="headerlink" title="3.1 创建类"></a>3.1 创建类</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/176.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/12/177.png" alt></p><h3 id="3-2-属性"><a href="#3-2-属性" class="headerlink" title="3.2 属性"></a>3.2 属性</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/178.png" alt></p><h3 id="3-3-方法"><a href="#3-3-方法" class="headerlink" title="3.3 方法"></a>3.3 方法</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/180.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/12/179.png" alt></p><h2 id="四、高级特性"><a href="#四、高级特性" class="headerlink" title="四、高级特性"></a>四、高级特性</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/147.png" alt="函数式编程"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/148.png" alt="切片"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/149.png" alt="迭代"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/150.png" alt="生成器"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/151.png" alt="yield关键字"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/152.png" alt="迭代器Iterator"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/153.png" alt="闭包"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/154.png" alt="装饰器"></p><h2 id="五、自带模块"><a href="#五、自带模块" class="headerlink" title="五、自带模块"></a>五、自带模块</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/140.png" alt="自带模块概览"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/137.png" alt="urllib"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/138.png" alt="正则表达式re"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/141.png" alt="random"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/142.png" alt="Math"></p><h2 id="六、Python并发"><a href="#六、Python并发" class="headerlink" title="六、Python并发"></a>六、Python并发</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/135.png" alt="python并发"></p><h2 id="七、应用领域"><a href="#七、应用领域" class="headerlink" title="七、应用领域"></a>七、应用领域</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/143.png" alt="应用领域"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/144.png" alt="网络爬虫"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/145.png" alt="数据存储、提取"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/146.png" alt="数据预处理、模型分析、可视化"></p><h2 id="八、更多"><a href="#八、更多" class="headerlink" title="八、更多"></a>八、更多</h2><ul><li><a href="https://processon.com/mindmap/5df0e70ce4b0e2c298af0b11" target="_blank" rel="noopener">Python完整思维导图</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、初识Python&quot;&gt;&lt;a href=&quot;#一、初识Python&quot; class=&quot;headerlink&quot; title=&quot;一、初识Python&quot;&gt;&lt;/a&gt;一、初识Python&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://blog.poetries.top/img
      
    
    </summary>
    
      <category term="Back-end" scheme="http://blog.poetries.top/categories/Back-end/"/>
    
    
      <category term="python" scheme="http://blog.poetries.top/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Python基础小结(一)</title>
    <link href="http://blog.poetries.top/2019/12/10/python-base-1/"/>
    <id>http://blog.poetries.top/2019/12/10/python-base-1/</id>
    <published>2019-12-10T09:40:39.000Z</published>
    <updated>2019-12-16T02:35:06.835Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近需要用<code>python</code>做数据分析，决定开始学<code>python</code>，总结一些基础笔记</p></blockquote><h2 id="一、导语"><a href="#一、导语" class="headerlink" title="一、导语"></a>一、导语</h2><ul><li><code>python</code>是解析性语言</li><li><code>python</code>能做什么<ul><li>大数据分析</li><li>自动化运维与自动化测试</li><li>web开发：<code>flask</code>、<code>jdango</code></li><li>机器学习 <code>TensorFlow</code></li><li>胶水语言：如混合c++、java编程，能够把其他语法编写的模块连接在一起</li></ul></li></ul><p><strong>Python语言的特点</strong></p><ul><li>语法简洁</li><li>可跨平台</li><li>应用广泛</li><li>支持中文</li><li>强制可读：通过强制缩进体现语句间的逻辑关系提高了程序的可读性</li><li>模式多样：语法层面同时支持面向过程和面向对象两种编程方式</li><li>粘性扩展：通过接口和函数集成其他语言编写的代码</li><li>开源理念</li><li>库类丰富</li></ul><p><strong>Python语言开发环境配置</strong></p><ul><li><code>Python</code>解释器</li><li><code>IDLE</code>开发环境</li><li>交互式启动</li><li>文件式启动</li><li><code>Python</code>语言集成开发环境——<code>PyCharm</code></li></ul><h2 id="二、基本知识"><a href="#二、基本知识" class="headerlink" title="二、基本知识"></a>二、基本知识</h2><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><ul><li>注释是辅助性文字，不被执行</li><li>单行注释：以<code>#</code>开头</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#这是注释</span><br></pre></td></tr></table></figure><blockquote><p>多行注释：以<code>&#39;&#39;&#39;</code>(3个单引号)开头和结尾</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&apos;&apos;&apos;</span><br><span class="line">这是注释</span><br><span class="line">这也是注释</span><br><span class="line">这还是注释</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure><h3 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h3><ul><li>命名是为变量关联标识符的过程，用于确保程序元素的唯一性</li><li>标识符由字母、数字、下划线（和汉字）等字符及其组合构成</li><li>标识符的首字符不能是数字 ，且中间不能出现空格</li><li>标识符对大小写敏感</li></ul><h3 id="保留字"><a href="#保留字" class="headerlink" title="保留字"></a>保留字</h3><ul><li>保留字（<code>Keyword</code>）也被称为关键字，是被编程语言内部定义并保留使用的标识符</li><li><code>Python</code> 的标准库提供了一个 <code>keyword</code> 模块，可以输出当前版本的所有关键字：</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import keyword</span><br><span class="line">&gt;&gt;&gt; ls=keyword.kwlist</span><br><span class="line">&gt;&gt;&gt; ls</span><br><span class="line">&gt;&gt;&gt;len(ls)</span><br><span class="line">33</span><br></pre></td></tr></table></figure><p><strong>Python 3 有33个保留字</strong></p><ul><li><code>True</code></li><li><code>False</code></li><li><code>None</code></li><li><code>and</code></li><li><code>as</code></li><li><code>assert</code></li><li><code>break</code></li><li><code>class</code></li><li><code>continue</code></li><li><code>def</code></li><li><code>del</code></li><li><code>elif</code></li><li><code>else</code></li><li><code>except</code></li><li><code>finally</code></li><li><code>for</code></li><li><code>from</code></li><li><code>global</code></li><li><code>if</code></li><li><code>import</code></li><li><code>in</code></li><li><code>is</code></li><li><code>lambda</code></li><li><code>nonlocal</code></li><li><code>not</code></li><li><code>or</code></li><li><code>pass</code></li><li><code>raise</code></li><li><code>return</code></li><li><code>try</code></li><li><code>while</code></li><li><code>with</code></li><li><code>yield</code></li></ul><h3 id="input-函数"><a href="#input-函数" class="headerlink" title="input()函数"></a>input()函数</h3><ul><li>使用<code>input()</code>函数从控制台获得用户输入</li><li><code>input()</code>函数以字符串类型返回结果</li></ul><h3 id="eval-函数"><a href="#eval-函数" class="headerlink" title="eval()函数"></a>eval()函数</h3><ul><li><code>eval(&lt;字符串&gt;)</code>函数的作用是间输入的字符串变成Python语句并执行</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">x=eval(input(&quot;请输入：&quot;))</span><br></pre></td></tr></table></figure><h3 id="print-函数"><a href="#print-函数" class="headerlink" title="print()函数"></a>print()函数</h3><ul><li><code>print()</code>函数可以输出字符信息，也可以用字符的形式输出变量</li><li>输出字符信息时，可以直接将待输出内容传递给<code>print()</code>函数</li><li>输出变量值时，<code>print()</code>函数用槽格式和过<code>format()</code>方法将变量和字符串结合到一起输出</li></ul><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul><li>函数可以理解为对一组表达特定功能表达式的封装，将特定功能代码编写在一个函数里，使程序模块化更好，便于阅读和复用</li><li>可通过保留字<code>def</code>自定义函数</li></ul><h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/107.png" alt></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用with操作文件</span></span><br><span class="line"><span class="keyword">with</span> open(os.path.dirname(__file__) + <span class="string">'/blog.text'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(json.dumps(data))</span><br></pre></td></tr></table></figure><p><img src="http://blog.poetries.top/img-repo/2019/12/131.png" alt="路径操作模块"><br><img src="http://blog.poetries.top/img-repo/2019/12/132.png" alt="图片"><br><img src="http://blog.poetries.top/img-repo/2019/12/133.png" alt="Excel"><br><img src="http://blog.poetries.top/img-repo/2019/12/134.png" alt="文本其他"></p><h2 id="三、基本类型"><a href="#三、基本类型" class="headerlink" title="三、基本类型"></a>三、基本类型</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/112.png" alt="python基本数据类型"></p><p><strong>类型判断两个方式</strong></p><ul><li><code>type</code> 判断基本类型 如 <code>type(10) == int</code> 不推荐</li><li><p><code>isinstance(值,类型)</code> 或者 <code>isinstance(值,(int,float,str))</code> 三种中任意一种</p><ul><li>例 <code>isinstance(1,int)</code></li></ul></li><li><p><code>Number</code></p><ul><li><code>int</code></li><li><code>float</code></li><li><code>complex</code> 复数<ul><li>如<code>36j</code></li></ul></li></ul></li><li><code>Bool</code><ul><li><code>bool(&#39;&#39;)/bool([])/bool({})/bool(0)/bool(None)</code></li><li>都是转化为<code>False</code></li></ul></li><li>字符串<code>str</code> （序列）<ul><li>单引号</li><li>双引号</li><li>三引号(可以换行写多个字符串和ES6的反引号类似)</li><li>在字符串前面加一个<code>r</code>，这个字符串就不是一个普通字符串，而是一个原始字符串会原样输出 <code>print(r&#39;\n88fafa&#39;)</code> 此时<code>\n</code>不会转译</li></ul></li><li><code>list</code> 列表 （序列）</li><li><code>tuple</code> 元组 （序列）</li><li>集合<code>set</code>(无序，没有索引，不能切片，元素唯一，不能重复,只有<code>value</code>，没<code>key</code>) <code>{}</code> 如 <code>{1,2,3,4}</code><ul><li><code>1 in {1,2,3}</code></li><li><code>1 not in {1,2,3,4}</code></li><li>两个集合插集<code>{1,2,3} - {4,5}</code></li><li>两个集合求交集 <code>{1,2,3,4} &amp; {2,3}</code></li><li>并集 <code>{1,2,3,4,5,6} | {3,4,7}</code></li><li>定义一个空的集合 <code>set()</code></li></ul></li><li>字典<code>dict</code>（有<code>key</code>无<code>value</code>，不同于集合只有<code>value</code>）<ul><li>很多<code>key-value</code>组成,不能够有相同的键，</li><li><code>key</code>键不可变类型，可以是<code>int/str/tuple</code> </li><li><code>value</code>可以是：<code>int/str/float/list/set/dict</code></li><li>定义一个空的字典 <code>{}</code></li></ul></li></ul><blockquote><p>两个整型相除得到整型 type(1//2) ==&gt;int 整除会保留整数</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// 二进制</span><br><span class="line">0b10012</span><br><span class="line"></span><br><span class="line">// 八进制</span><br><span class="line">0o101</span><br><span class="line"></span><br><span class="line">// 16进制</span><br><span class="line">0x10</span><br><span class="line"></span><br><span class="line">// 10进制转二进制</span><br><span class="line">bin(10)</span><br><span class="line"></span><br><span class="line">// 八进制转二进制</span><br><span class="line">bin(o09012)</span><br><span class="line"></span><br><span class="line">// 八进制、二进制转十进制</span><br><span class="line">int(0b1000)</span><br><span class="line"></span><br><span class="line">// 十进制转16进制</span><br><span class="line">hex(88891)</span><br><span class="line"></span><br><span class="line">// 八进制转化</span><br><span class="line">oct(0b100)</span><br></pre></td></tr></table></figure><p><strong>转译字符</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">\n 换行</span><br><span class="line">\t 横向制表符</span><br></pre></td></tr></table></figure><p><strong>内置的字符串处理函数</strong></p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>len(&#39;x&#39;)</code></td><td>返回字符串<code>x</code>的长度，也可返回其他组合数据类型元素个数</td></tr><tr><td><code>str(&#39;x&#39;)</code></td><td>返回任意类型<code>x</code>所对应的字符串形式</td></tr><tr><td><code>chr(x)</code></td><td>返回<code>Unicode</code>编码<code>x</code>对应的单字符</td></tr><tr><td><code>ord(&#39;x&#39;)</code></td><td>返回单字符表示的<code>Unicode</code>编码</td></tr><tr><td><code>hex(x)</code></td><td>返回整数<code>x</code>对应十六进制数的小写形式字符串</td></tr><tr><td><code>oct(x)</code></td><td>返回整数<code>x</code>对应八进制数的小写形式字符串</td></tr></tbody></table><p><strong>内置的字符串处理方法（共43个，常用16个）</strong></p><ul><li>在<code>Python</code>解释器内部，所有数据类型都采用面向对象的方式实现，封装为一个类</li><li>字符串是一个类，具有类似<code>&lt;a&gt;.&lt;b&gt;()</code>形式的字符串处理函数，称为方法</li></ul><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td><code>str.lower()</code></td><td>返回字符串<code>str</code>的副本，全部字符小写</td></tr><tr><td><code>str.upper()</code></td><td>返回字符串<code>str</code>的副本，全部字符大写</td></tr><tr><td><code>str.islower()</code></td><td>当str所有字符都是小写时，返回<code>Ture</code>，否则返回<code>False</code></td></tr><tr><td><code>str.isprintable()</code></td><td>当str所有字符都是可打印的，返回<code>Ture</code>，否则返回<code>False</code></td></tr><tr><td><code>str.isnumeric()</code></td><td>当str所有字符都是数字时，返回<code>Ture</code>，否则返回<code>False</code></td></tr><tr><td><code>str.isspace()</code></td><td>当str所有字符都是空格，返回<code>Ture</code>，否则返回<code>Flase</code></td></tr><tr><td><code>str.endswith(suffix[,start[,end]])</code></td><td><code>str[start:end]</code>以<code>suffix</code>结尾返回<code>Ture</code>，否则返回<code>Flase</code></td></tr><tr><td><code>str.srartswith(prefix[,start[,end]])</code></td><td><code>str[start:end]</code>以<code>prefix</code>开始返回<code>Ture</code>，否则返回<code>Flase</code></td></tr><tr><td><code>str.split(sep=None,maxsplit=-1)</code></td><td>返回一个列表，由<code>str</code>根据<code>sep</code>被分割的部分构成</td></tr><tr><td><code>str.count(sub[,start[,end]]</code></td><td>返回<code>str[start:end]</code>中<code>sub</code>子串出现的次数</td></tr><tr><td><code>str.replace(old,new[,count])</code></td><td>返回字符串<code>str</code>的副本，所有<code>old</code>子串被替换为<code>new</code>，如果<code>count</code>给出，则前<code>count</code>次<code>old</code>出现被替换</td></tr><tr><td><code>str.center(width[,fillchar])</code></td><td>字符串居中函数</td></tr><tr><td><code>str.strip([chars])</code></td><td>返回字符串<code>str</code>的副本，在其左侧和右侧去掉<code>chars</code>中列出的字符</td></tr><tr><td><code>str.zfill(width)</code></td><td>返回字符串<code>str</code>副本，长度为<code>width</code>。不足部分在其左侧添加<code>0</code></td></tr><tr><td><code>str.format()</code></td><td>返回字符串<code>str</code>的一种排版格式</td></tr><tr><td><code>str.join(iterable)</code></td><td>返回一个新字符串，由组合数据类型<code>iterable</code>变量的每个元素组成，元素间用<code>str</code>分隔</td></tr></tbody></table><h2 id="四、序列-元组、字符串、列表"><a href="#四、序列-元组、字符串、列表" class="headerlink" title="四、序列-元组、字符串、列表"></a>四、序列-元组、字符串、列表</h2><p><strong>序列共性</strong></p><ul><li>切片</li><li>序号</li><li><code>in</code>判断符 <code>2 in [1,2,3]</code> <code>2 not in [1,2,3]</code></li><li><code>len()</code></li><li><code>max(list)</code></li><li><code>min(list)</code></li></ul><p><img src="http://blog.poetries.top/img-repo/2019/12/109.png" alt="序列"></p><p><img src="http://blog.poetries.top/img-repo/2019/12/108.png" alt="序列基本操作"></p><p><strong>可变类型</strong></p><ul><li><code>list</code> 需要动态改变，就用列表</li><li><code>dict</code></li><li><code>set</code></li></ul><p><strong>不可变类型</strong></p><ul><li><code>str</code></li><li><code>tuple</code> 定义之后不可变，安全性较高</li><li><code>int</code></li></ul><p><strong>字符串基本操作</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// +号运算</span><br><span class="line">str1 = &apos;hell&apos;</span><br><span class="line">str2 = &apos;world&apos;</span><br><span class="line">str = str1 + str2</span><br><span class="line"></span><br><span class="line">// 乘法运算 </span><br><span class="line">str1*3 // 重复3次</span><br><span class="line"></span><br><span class="line">// 切片</span><br><span class="line">str1[1:2]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// 赋值操作</span><br><span class="line">year,month,day = (2019,10,12)</span><br></pre></td></tr></table></figure><blockquote><p>如果只有一个元素，应该这样表示元组 <code>(1,)</code>,一个元素都没有的元组 <code>type( () )</code></p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/12/126.png" alt="python类型转换"></p><h2 id="五、运算符"><a href="#五、运算符" class="headerlink" title="五、运算符"></a>五、运算符</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/113.png" alt="python运算符"></p><p><strong>列表元组都可以比较</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) &gt; (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>) <span class="comment">// 两两比较第一个、第二个...数字</span></span><br></pre></td></tr></table></figure><p><strong>字典的成员运算符</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只针对key</span></span><br><span class="line"><span class="string">'a'</span> <span class="keyword">in</span> &#123;<span class="string">'a'</span>: <span class="string">'1'</span>&#125; <span class="comment">// True</span></span><br></pre></td></tr></table></figure><p><strong>身份运算符</strong></p><ul><li><code>is</code> 两个取值相等才会返回True  <code>&#39;1&#39; is &#39;1&#39; // True</code></li><li><code>is not</code> 不等</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 关系运算符比较的是两个值是否相等 如</span></span><br><span class="line"><span class="number">1</span> == <span class="number">1.0</span> <span class="comment">// True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// is比较的是两个变量内存地址是否相等 id(值) 获取内存地址</span></span><br><span class="line"><span class="number">1</span> is <span class="number">1.0</span> <span class="comment">// False</span></span><br></pre></td></tr></table></figure><p><strong>对象的三个特征</strong></p><ul><li><code>id</code>(身份) =&gt; <code>is</code>判断</li><li><code>value</code> =&gt; <code>==</code> 判断</li><li><code>type</code> =&gt; <code>isinstance</code> 判断</li></ul><p><strong>位运算符</strong></p><blockquote><p>把数字当二进制进行运算。把非二进制转化为二进制才计算</p></blockquote><ul><li><code>&amp;</code> 按位与</li><li><code>|</code> 按位或</li><li><code>^</code> 按位异或</li><li><code>~</code>按位取反</li><li><code>&lt;&lt;</code> 左移动</li><li><code>&gt;&gt;</code> 右移动</li></ul><h2 id="六、循环、条件、枚举"><a href="#六、循环、条件、枚举" class="headerlink" title="六、循环、条件、枚举"></a>六、循环、条件、枚举</h2><ul><li><code>if else</code></li><li><code>while</code></li><li><code>for in</code></li></ul><p><strong>range</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// range</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2是步长</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取出1，3，5，7</span></span><br><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(a),<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//切片写法</span></span><br><span class="line">a[<span class="number">0</span>:len(a):<span class="number">2</span>]</span><br></pre></td></tr></table></figure><h2 id="七、枚举"><a href="#七、枚举" class="headerlink" title="七、枚举"></a>七、枚举</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">''' </span></span><br><span class="line"><span class="string">枚举</span></span><br><span class="line"><span class="string">'''</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VIP</span><span class="params">(Enum)</span>:</span></span><br><span class="line">  <span class="comment"># 值可以相同 但是py会把第二个设置别名</span></span><br><span class="line">  yellow = <span class="number">1</span></span><br><span class="line">  green = <span class="number">2</span></span><br><span class="line">  red = <span class="number">3</span></span><br><span class="line">  black = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 枚举不能被修改</span></span><br><span class="line"><span class="comment"># VIP.red = 10</span></span><br><span class="line">print(VIP.yellow)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取枚举值</span></span><br><span class="line">print(VIP.yellow.value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取枚举标签</span></span><br><span class="line">print(VIP.yellow.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据名称获取枚举类</span></span><br><span class="line">print(VIP[<span class="string">'red'</span>]) <span class="comment"># VIP.red</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 枚举遍历 获取每个成员</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> VIP:</span><br><span class="line">  print(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> VIP.__members__.items():</span><br><span class="line">  print(v)</span><br><span class="line"></span><br><span class="line"><span class="string">''' </span></span><br><span class="line"><span class="string">('yellow', &lt;VIP.yellow: 1&gt;)</span></span><br><span class="line"><span class="string">('green', &lt;VIP.green: 2&gt;)</span></span><br><span class="line"><span class="string">('red', &lt;VIP.red: 3&gt;)</span></span><br><span class="line"><span class="string">('black', &lt;VIP.black: 4&gt;)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 成员之间进行比较 不持续大小比较</span></span><br><span class="line">res = VIP.red == VIP.black</span><br><span class="line">print(res) <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 身份比较</span></span><br><span class="line">print(VIP.red <span class="keyword">is</span> VIP.red)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 枚举类型转换</span></span><br><span class="line">print(VIP(<span class="number">1</span>)) <span class="comment"># VIP.yellow</span></span><br></pre></td></tr></table></figure><h2 id="八、闭包、模块、函数、变量作用域"><a href="#八、闭包、模块、函数、变量作用域" class="headerlink" title="八、闭包、模块、函数、变量作用域"></a>八、闭包、模块、函数、变量作用域</h2><h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p><img src="http://blog.poetries.top/img-repo/2019/12/110.png" alt="模块"></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在文件中写`__init__.py` 只是标注这是一个包 可以什么都不用写</span></span><br></pre></td></tr></table></figure><p><strong>导入模块重新命名</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import test as t</span><br></pre></td></tr></table></figure><p><strong>函数</strong></p><blockquote><p>函数内部没有<code>return</code> 返回的结果就是<code>None</code></p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 函数可以返回多个值</span></span><br><span class="line">def test():</span><br><span class="line">  <span class="keyword">return</span> x, y,z</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 接收返回的值</span></span><br><span class="line">x,y,z = test()  <span class="comment">// 其实就是返回了一个元组类型</span></span><br></pre></td></tr></table></figure><h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">''' </span></span><br><span class="line"><span class="string">闭包 = 函数+环境变量（在函数外部）</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">  num = <span class="number">10</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> num * x</span><br><span class="line">  <span class="keyword">return</span> fun</span><br><span class="line"></span><br><span class="line">f = test()</span><br><span class="line">print(f(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">origin = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">go</span><span class="params">(step)</span>:</span></span><br><span class="line">  <span class="keyword">global</span> origin </span><br><span class="line">  new_pos = step + origin </span><br><span class="line">  origin = new_pos</span><br><span class="line">  <span class="keyword">return</span> new_pos</span><br><span class="line"></span><br><span class="line">print(go(<span class="number">1</span>))</span><br><span class="line">print(go(<span class="number">2</span>))</span><br><span class="line">print(go(<span class="number">3</span>))</span><br></pre></td></tr></table></figure><h3 id="匿名函数-lambda"><a href="#匿名函数-lambda" class="headerlink" title="匿名函数 lambda"></a>匿名函数 lambda</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">''' </span></span><br><span class="line"><span class="string">函数式编程：匿名函数 lambda</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> x + y </span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匿名函数定义</span></span><br><span class="line">f = <span class="keyword">lambda</span> x,y: x+y</span><br><span class="line"></span><br><span class="line">print(f(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">arr = [&#123;<span class="string">'key'</span>: <span class="string">'poetries'</span>,<span class="string">'value'</span>: <span class="number">100</span>&#125;,&#123;<span class="string">'key'</span>: <span class="string">'jing'</span>,<span class="string">'value'</span>: <span class="number">10</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理键值对</span></span><br><span class="line">res = map(<span class="keyword">lambda</span> item: &#123;<span class="string">'name'</span>: item[<span class="string">'key'</span>],<span class="string">'score'</span>: item[<span class="string">'value'</span>]&#125;, arr)</span><br><span class="line"></span><br><span class="line">print(list(res))</span><br></pre></td></tr></table></figure><h3 id="map函数"><a href="#map函数" class="headerlink" title="map函数"></a>map函数</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">''' </span></span><br><span class="line"><span class="string">map函数</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">arr2 = [<span class="number">10</span>,<span class="number">12</span>,<span class="number">14</span>,<span class="number">16</span>,<span class="number">12</span>,<span class="number">14</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表推导式</span></span><br><span class="line">a = [i*i <span class="keyword">for</span> i <span class="keyword">in</span> arr ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(a)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># map函数</span></span><br><span class="line">b = map(<span class="keyword">lambda</span> x: x*x,arr)</span><br><span class="line">print(list(b))</span><br><span class="line"></span><br><span class="line">c = map(<span class="keyword">lambda</span> x,y: x*x + y,arr,arr2) <span class="comment"># 可以传多个list，个数要相同</span></span><br><span class="line">print(list(c))</span><br></pre></td></tr></table></figure><h3 id="reduce函数"><a href="#reduce函数" class="headerlink" title="reduce函数"></a>reduce函数</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">''' </span></span><br><span class="line"><span class="string">reduce函数</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连续调用lambda</span></span><br><span class="line">r = reduce(<span class="keyword">lambda</span> x,y:x+y,arr)</span><br><span class="line"></span><br><span class="line">print(r)</span><br></pre></td></tr></table></figure><h3 id="filter函数"><a href="#filter函数" class="headerlink" title="filter函数"></a>filter函数</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">''' </span></span><br><span class="line"><span class="string">filter函数</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="literal">False</span>,<span class="string">''</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤空字符串</span></span><br><span class="line">res = filter(<span class="keyword">lambda</span> x: <span class="keyword">not</span> <span class="keyword">not</span> x,arr)</span><br><span class="line"></span><br><span class="line">print(list(res)) <span class="comment"># [1,2,3,4,5,6,7]</span></span><br></pre></td></tr></table></figure><h2 id="九、装饰器"><a href="#九、装饰器" class="headerlink" title="九、装饰器"></a>九、装饰器</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">''' </span></span><br><span class="line"><span class="string">装饰器:特性、注解</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator1</span><span class="params">(func)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(time.time())</span><br><span class="line">    func(name)</span><br><span class="line">  <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@decorator1 </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(name)</span>:</span></span><br><span class="line">  print(<span class="string">'this is a func'</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># f1('poetries')</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator2</span><span class="params">(func)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kw)</span>:</span></span><br><span class="line">    print(time.time())</span><br><span class="line">    print(args,<span class="string">'args'</span>)</span><br><span class="line">    print(kw,<span class="string">'kw'</span>)</span><br><span class="line">    func(*args,**kw)</span><br><span class="line">  <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@decorator2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(p1,p2)</span>:</span></span><br><span class="line">  print(<span class="string">'this is a func'</span>,p1,p2)</span><br><span class="line"></span><br><span class="line">f2(<span class="string">'静观流叶'</span>,<span class="string">'1'</span>)</span><br></pre></td></tr></table></figure><h2 id="十、面向对象"><a href="#十、面向对象" class="headerlink" title="十、面向对象"></a>十、面向对象</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/115.png" alt="类"></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">面向对象</span></span><br><span class="line"><span class="string">类=面向对象</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">行为、特征</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">类最基本的作用封装代码</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'poetries'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(Human)</span>:</span></span><br><span class="line">  <span class="comment"># 类变量 静态属性</span></span><br><span class="line">  author = <span class="string">'poetry'</span> </span><br><span class="line">  SUM = <span class="number">10</span></span><br><span class="line">  num = <span class="number">999</span></span><br><span class="line">  score = <span class="number">98</span></span><br><span class="line">  text = <span class="string">'小明今年'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age)</span>:</span></span><br><span class="line">    <span class="comment"># 构造函数 初始化对象属性</span></span><br><span class="line">    <span class="comment"># 成员可见性 __外部不能访问</span></span><br><span class="line">    self.__name = name </span><br><span class="line">    self.__age = age </span><br><span class="line"></span><br><span class="line">  <span class="comment"># 实例方法 第一个参数默认是self</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getAge</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># 实例中可调用类变量</span></span><br><span class="line">    <span class="comment"># print(self.author)</span></span><br><span class="line">    <span class="keyword">return</span> self.__getText() + str(self.__age)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getName</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.__name</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">setName</span><span class="params">(self,name)</span>:</span></span><br><span class="line">    self.__name = name</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 私有方法，外部不可以访问</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__getText</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.text</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 静态方法</span></span><br><span class="line">  <span class="comment"># 没有self</span></span><br><span class="line">  <span class="comment"># 实例和类都可以调用</span></span><br><span class="line"><span class="meta">  @staticmethod</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 内部可以访问类变量</span></span><br><span class="line">    print(<span class="string">'静态方法'</span>,Student.SUM)</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 类方法 操作和类相关的</span></span><br><span class="line">  <span class="comment"># cls代表student这个类</span></span><br><span class="line">  <span class="comment"># 使用方式 student.testd()</span></span><br><span class="line">  <span class="comment"># 实例和类都可以调用，不要使用实例调用</span></span><br><span class="line">  <span class="comment"># 推荐使用类方法代替静态方法</span></span><br><span class="line"><span class="meta">  @classmethod</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">testd</span><span class="params">(cls)</span>:</span></span><br><span class="line">    print(<span class="string">'classMethod'</span>)</span><br><span class="line">  </span><br><span class="line">stu = Student(<span class="string">'poetries'</span>,<span class="number">22</span>)</span><br><span class="line"></span><br><span class="line">print(stu.getAge())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改内部变量值，通过内部定义一个方法，可以在内部进行判断，起到保护作用</span></span><br><span class="line">stu.setName(<span class="string">'静观流叶'</span>)</span><br><span class="line"></span><br><span class="line">print(stu.getName())</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(Student.author)</span></span><br><span class="line"><span class="comment"># print(Student.__dict__)</span></span><br><span class="line"><span class="comment"># print(Student.test())</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">继承</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span><span class="params">(object)</span>:</span></span><br><span class="line">  num =<span class="number">10</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age)</span>:</span></span><br><span class="line">    self.__name = name</span><br><span class="line">    self.__age = age </span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getName</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 继承父类Human</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(Human)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,school,name,age)</span>:</span></span><br><span class="line">    self.school = school</span><br><span class="line">    <span class="comment"># 子类调用父类构造函数 </span></span><br><span class="line">    <span class="comment"># 方式1</span></span><br><span class="line">    <span class="comment"># Human.__init__(self,name,age)</span></span><br><span class="line">    <span class="comment"># 方式2 推荐super</span></span><br><span class="line">    super(Student,self).__init__(name,age)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getInfo</span><span class="params">(self)</span>:</span> </span><br><span class="line">    <span class="keyword">return</span> self.getName() + self.school</span><br><span class="line"></span><br><span class="line">stu = Student(<span class="string">'中山大学'</span>,<span class="string">'poetry'</span>,<span class="number">22</span>)</span><br><span class="line">print(stu.getInfo())</span><br></pre></td></tr></table></figure><h2 id="十一、正则表达式"><a href="#十一、正则表达式" class="headerlink" title="十一、正则表达式"></a>十一、正则表达式</h2><blockquote><p>是一个特殊的字符序列，一个字符串是否与我们所设定的这样的字符序列相匹配</p></blockquote><p>库re</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//替换非数字的</span></span><br><span class="line"> s = re.sub(<span class="string">'\D'</span>,<span class="string">''</span>,<span class="string">'9fafjla9dfaldfah-dfal+++)@#--9912'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 例子 传递函数 根据匹配结果替换操作</span></span><br><span class="line">def convert(value):</span><br><span class="line">  match = value.group()</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'!!'</span> + match</span><br><span class="line"></span><br><span class="line">re.sub(<span class="string">'#c'</span>, convert, <span class="string">'pythonc#fda'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// findall 可以加上第三个参数模式re.I忽略大小写</span></span><br><span class="line"><span class="comment">// re.S 改变.的匹配行为，可以匹配换行符`/n`  </span></span><br><span class="line"><span class="comment">// 返回 ['99999']</span></span><br><span class="line">re.findall(<span class="string">'\d+'</span>,<span class="string">'kfdafd99999fa'</span>,re.I | re.S)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配仅仅是对前面那个字符起作用</span></span><br><span class="line"><span class="comment">// n匹配0次或者1次</span></span><br><span class="line">re.findall(<span class="string">'python?'</span>, <span class="string">'pythonnn'</span>)</span><br></pre></td></tr></table></figure><ul><li><code>re.match</code> 没有找到匹配的，将会返回<code>None</code></li><li><code>re.search</code> 直到搜索到</li><li><code>re.sub</code> 替换</li><li><code>re.findall</code> 推荐 返回一个列表</li></ul><h2 id="十二、内建函数"><a href="#十二、内建函数" class="headerlink" title="十二、内建函数"></a>十二、内建函数</h2><p><a href="https://docs.python.org/3/library/functions.html" target="_blank" rel="noopener">https://docs.python.org/3/library/functions.html</a></p><p><img src="http://blog.poetries.top/img-repo/2019/12/114.png" alt="内建函数"></p><h2 id="十三、标准库"><a href="#十三、标准库" class="headerlink" title="十三、标准库"></a>十三、标准库</h2><p>常用模块</p><ul><li>文字处理 re</li><li>日期类型 time、datetime</li><li>随机数、数学类型  math、random</li><li>文件和目录访问 pathlib os.path</li><li>数据压缩 tarfile</li><li>通用操作系统 os、logging、argparse</li><li>多线程 threading、queue</li><li>网络数据处理 base64 json urllib</li><li>结构化标记处理工具 html xml</li><li>调试工具 timeit</li><li>软件包发布 venv</li><li>运行服务的 <strong>main</strong></li></ul><h2 id="十四、异常处理"><a href="#十四、异常处理" class="headerlink" title="十四、异常处理"></a>十四、异常处理</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/127.png" alt="python异常类型"></p><blockquote><p><code>try-except</code>语句</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">try:</span><br><span class="line">    &lt;语句块1&gt;</span><br><span class="line">except &lt;异常类型&gt;:</span><br><span class="line">    &lt;语句块2&gt;</span><br></pre></td></tr></table></figure><blockquote><p>try-except语句可以支持多个except语句</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">try:</span><br><span class="line">    &lt;语句块1&gt;</span><br><span class="line">except &lt;异常类型1&gt;：</span><br><span class="line">    &lt;语句块2&gt;</span><br><span class="line">...</span><br><span class="line">except &lt;异常类型N&gt;:</span><br><span class="line">    &lt;语句块N+1&gt;</span><br><span class="line">except &lt;异常类型N+!&gt;:</span><br><span class="line">    &lt;语句块N+2&gt;</span><br></pre></td></tr></table></figure><h2 id="十五、JSON操作"><a href="#十五、JSON操作" class="headerlink" title="十五、JSON操作"></a>十五、JSON操作</h2><ul><li><code>json</code>库主要包括两类函数，操作类函数和解析类函数</li><li>操作类函数主要完成外部<code>JSON</code>格式和程序内部数据类型之间的转换功能<br>解析类函数主要用于解析键值对内容</li><li><code>json</code>格式包括对象和数组</li><li>对象用大括号(<code>{}</code>)表示，对应键值对的组合关系（被<code>json</code>库解析为字典）</li><li>数组用中括号(<code>{}</code>)表示，对应键值对的对等关系（被<code>json</code>库解析为列表）</li></ul><p><strong>json库解析</strong></p><ul><li><code>json</code>库包含编码（<code>encoding</code>）和解码（<code>decoding</code>）两个过程<br>编码将<code>Python</code>数据类型变换成JSON格式</li><li>解码是从<code>JSON</code>格式中解析数据对应到<code>Python</code>数据类型的过程<br><code>json</code>库的操作类函数</li></ul><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>json.dumps(obj,sort_keys=Flase,indent=None)</code></td><td>将Python的数据类型转换为<code>JSON</code>格式，编码过程</td></tr><tr><td><code>json.loads(string)</code></td><td>将<code>JSON</code>格式字符串转换为Python的数据类型，解码过程</td></tr><tr><td><code>json.dump(obj,fp，sort_keys=Flase,indent=None)</code></td><td>与<code>dumps()</code>功能一致，输出到文件<code>fp</code></td></tr><tr><td><code>json.load(fp)</code></td><td>与<code>loads()</code>功能一致，从文件<code>fp</code>读入</td></tr></tbody></table><ul><li><code>json.dumps()</code>中的<code>obj</code>可以是<code>Python</code>的列表或字典类型，当输入字典类型时，<code>dumps()</code>函数将其变为<code>JSON</code>格式字符串</li><li>默认生成的字符串是顺序存放的，<code>sort_keys</code>可以对字典元素按照<code>key</code>进行排序控制输出结果</li><li><code>indent</code>参数用于增加数据缩进，使得生成的<code>JSON</code>格式字符串更具可读性</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment">// 反序列化</span></span><br><span class="line">str = <span class="string">"&#123;'name': 'poetries'&#125;"</span></span><br><span class="line">json.loads(str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 序列化</span></span><br><span class="line">json.dumps([&#123;<span class="attr">name</span>: <span class="string">'poetries'</span>])</span><br></pre></td></tr></table></figure><blockquote><p>json数据类型和python对比</p></blockquote><table><thead><tr><th>JSON</th><th>python</th></tr></thead><tbody><tr><td><code>object</code></td><td><code>dict</code></td></tr><tr><td><code>array</code></td><td><code>list</code></td></tr><tr><td><code>string</code></td><td><code>str</code></td></tr><tr><td><code>number</code></td><td><code>int</code></td></tr><tr><td><code>number</code></td><td><code>float</code></td></tr><tr><td><code>true</code></td><td><code>True</code></td></tr><tr><td><code>false</code></td><td><code>False</code></td></tr><tr><td><code>null</code></td><td><code>None</code></td></tr></tbody></table><h2 id="十六、爬虫"><a href="#十六、爬虫" class="headerlink" title="十六、爬虫"></a>十六、爬虫</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/111.png" alt="模块"></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">''' </span></span><br><span class="line"><span class="string">原生爬虫: 分页爬取我的博客文章列表</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re,json,os</span><br><span class="line"></span><br><span class="line">baseUrl = <span class="string">'http://blog.poetries.top'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Spider</span><span class="params">()</span>:</span></span><br><span class="line">  url = baseUrl + <span class="string">'/archives/'</span></span><br><span class="line">  pattern = <span class="string">'&lt;a class="post-title" href="(.*)"&gt;([\w]*?)&lt;/a&gt;'</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,page=<span class="number">1</span>)</span>:</span></span><br><span class="line">    self.page = page </span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__fetch_content</span><span class="params">(self)</span>:</span></span><br><span class="line">    url = Spider.url</span><br><span class="line">    <span class="keyword">if</span> self.page != <span class="number">1</span>: </span><br><span class="line">      url = Spider.url + <span class="string">'page/'</span> + str(self.page)</span><br><span class="line"></span><br><span class="line">    r = request.urlopen(url)</span><br><span class="line">    <span class="comment">#bytes</span></span><br><span class="line">    htmls = str(r.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">return</span> htmls</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_analyse</span><span class="params">(self, htmls)</span>:</span></span><br><span class="line">    res = re.findall(Spider.pattern, htmls)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">    htmls = self.__fetch_content()</span><br><span class="line">    <span class="keyword">return</span> self._analyse(htmls)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页获取所有文章标题</span></span><br><span class="line">result = [] <span class="comment"># 保存多页数据 [[],[],[]]</span></span><br><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">15</span>):</span><br><span class="line">  print(<span class="string">'开始趴取，第(%d/%d)页文章.......'</span>%(page,<span class="number">14</span>))</span><br><span class="line">  spider = Spider(page)</span><br><span class="line">  res = spider.start()</span><br><span class="line">  result.append(res)</span><br><span class="line">  <span class="keyword">if</span> page == <span class="number">14</span>:</span><br><span class="line">    print(<span class="string">'所有页面已趴取完...'</span>)</span><br><span class="line"></span><br><span class="line">data = [] <span class="comment"># 处理后的数据</span></span><br><span class="line"><span class="keyword">if</span> len(result) != <span class="number">0</span>:</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">    res = list(map(<span class="keyword">lambda</span> item: &#123;</span><br><span class="line">        <span class="string">'url'</span>: baseUrl + item[<span class="number">0</span>],</span><br><span class="line">        <span class="string">'title'</span>: item[<span class="number">1</span>]</span><br><span class="line">      &#125;,i))</span><br><span class="line">    <span class="comment"># 合并两个数组 [] + []</span></span><br><span class="line">    data += res</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 保存到当前文件夹</span></span><br><span class="line">  <span class="keyword">with</span> open(os.path.dirname(__file__) + <span class="string">'/blog.text'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(json.dumps(data))</span><br><span class="line"></span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure><h2 id="十七、常用库"><a href="#十七、常用库" class="headerlink" title="十七、常用库"></a>十七、常用库</h2><h3 id="datetime库"><a href="#datetime库" class="headerlink" title="datetime库"></a>datetime库</h3><blockquote><p><code>datetime</code>库可以从系统中获得时间，并以用户选择的格式输出</p></blockquote><blockquote><ul><li><code>datetime</code>库以格林威治时间为基础，每天由<code>3600*24</code>秒精准定义</li><li><code>datetime</code>库以类的方式提供多种日期和时间</li></ul></blockquote><ul><li><code>datetime.date</code>：日期表示类，坑人表示年、月、日等。</li><li><code>datetime.time</code>：时间表示类，可表示小时、分钟、秒、毫秒等。</li><li><code>datetime.datetime</code>：日期和时间表示类，功能覆盖date和time类。</li><li><code>datetime.timedelta</code>：与时间间隔有关的类。</li><li><code>datetime.tzinfo</code>：与时区有关的信息表示类。</li></ul><p><strong>datetime库解析</strong></p><ol><li><code>datetime.now()</code>：返回一个<code>datetime</code>类型，表示当前日期和时间，精确到毫秒</li></ol><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">&gt;&gt;&gt;now=datetime.now()</span><br><span class="line">&gt;&gt;&gt;now</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">5</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">49</span>, <span class="number">38</span>, <span class="number">627464</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li><code>datetime.utcnow()</code>：返回一个<code>datetime</code>类型，表示当前日期和时间的<code>UTC</code>（世界标准时间）表示，精确到毫秒</li></ol><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">&gt;&gt;&gt;utcnow=datetime.now()</span><br><span class="line">&gt;&gt;&gt;utcnow</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">5</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">53</span>, <span class="number">59</span>, <span class="number">788612</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>直接使用<code>datetime()</code>构造一个日期和时间对象：</li></ol><blockquote><p>datetime(Y,M,D,hour=0,minute=0,second=0,microsecond=0)</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;some=datetime(<span class="number">2018</span>,<span class="number">5</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">&gt;&gt;&gt;some</span><br><span class="line">datetime.datetime(<span class="number">2018</span>, <span class="number">5</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p><strong>datetime类的常用属性</strong></p><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td><code>some.min</code></td><td>固定返回<code>datetime</code>的最小时间对象，<code>datetime(1,1,1,0,0)</code></td></tr><tr><td><code>some.max</code></td><td>固定返回datetime的最大时间对象，<code>datetime(9999,12,31,23,59,59,999999)</code></td></tr><tr><td><code>some.year</code></td><td>返回<code>some</code>包含的年份</td></tr><tr><td><code>some.month</code></td><td>返回<code>some</code>包含的月份</td></tr><tr><td><code>some.day</code></td><td>返回<code>some</code>包含的日期</td></tr><tr><td><code>some.hour</code></td><td>返回<code>some</code>包含的小时</td></tr><tr><td><code>some.minute</code></td><td>返回<code>some</code>包含的分钟</td></tr><tr><td><code>some.second</code></td><td>返回<code>some</code>包含的秒钟</td></tr><tr><td><code>some.microsecond</code></td><td>返回<code>some</code>包含的毫秒</td></tr></tbody></table><p><strong>datetime类的常用时间格式化方法</strong></p><p>|属性|    描述|<br>|<code>some.isofomat()</code>    |采用<code>ISO8601</code>标准显示时间|<br>|<code>some.isoweekday()</code>    |根据日期计算星期|<br>|<code>some.strftime()</code>    |根据格式化字符串<code>format</code>进行格式显示的方法|</p><p><strong>strftime()方法用于输出特定格式时间</strong></p><table><thead><tr><th>格式化字符串</th><th>对象</th><th>取值范围</th></tr></thead><tbody><tr><td><code>%Y</code></td><td>年</td><td><code>0001~9999</code></td></tr><tr><td><code>%m</code></td><td>月</td><td><code>1~12</code></td></tr><tr><td><code>%B</code></td><td>月名</td><td><code>January~December</code></td></tr><tr><td><code>%b</code></td><td>月名缩写</td><td><code>Jan~Dec</code></td></tr><tr><td><code>%d</code></td><td>日期</td><td><code>01~31</code></td></tr><tr><td><code>%A</code></td><td>星期</td><td><code>Monday~Sunday</code></td></tr><tr><td><code>%a</code></td><td>星期缩写</td><td><code>Mon~Sum</code></td></tr><tr><td><code>%H</code></td><td>小时（<code>24h</code>制）</td><td><code>00~23</code></td></tr><tr><td><code>%I</code></td><td>小时（<code>12h</code>制）</td><td><code>01~12</code></td></tr><tr><td><code>%p</code></td><td>上、下午</td><td><code>AM/PM</code></td></tr><tr><td><code>%M</code></td><td>分钟</td><td><code>00~59</code></td></tr><tr><td><code>%S</code></td><td>秒</td><td><code>00~59</code></td></tr></tbody></table><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;some=datetime(<span class="number">2018</span>,<span class="number">5</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">&gt;&gt;&gt;some.strftime(<span class="string">"%Y年%m月%d日，%H时%M分%S秒"</span>)</span><br><span class="line"><span class="string">'2018年05月13日，17时00分00秒'</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;print(<span class="string">'今天是&#123;0:%Y&#125;年&#123;0:%m&#125;月&#123;0:%d&#125;日'</span>.format(some))</span><br><span class="line">今天是<span class="number">2018</span>年<span class="number">05</span>月<span class="number">13</span>日</span><br></pre></td></tr></table></figure><h3 id="random库"><a href="#random库" class="headerlink" title="random库"></a>random库</h3><blockquote><p>random库采用梅森旋转算法生成伪随机数序列，可用于除随机性要求更高的加解密算法外的大多数工程应用</p></blockquote><ul><li><code>Python</code>内置的<code>random</code>库主要用于产生各种分布的伪随机数序列</li><li><code>random</code>库提供<code>9</code>个常用函数</li></ul><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>seed(a=None)</code></td><td>初始化随机数种子，默认值为当前系统时间</td></tr><tr><td><code>random()</code></td><td>生成一个<code>[0.0,1.0]</code>之间的随机小数</td></tr><tr><td><code>randint(a,b)</code></td><td>生成一个<code>[a,b]</code>之间的整数</td></tr><tr><td><code>getrandbits(k)</code></td><td>生成一个<code>k</code>比特长度的随机整数</td></tr><tr><td><code>randrange(start,stop[,step])</code></td><td>生成一个[start,stop]之间以<code>step</code>为步数的随机整数</td></tr><tr><td><code>uniform(a,b)</code></td><td>生成一个<code>[a,b]</code>之间的随机小数</td></tr><tr><td><code>choice(seq)</code></td><td>从序列类型，例如列表中随机返回一个元素</td></tr><tr><td><code>shuffle(seq)</code></td><td>将序列类型中的元素随机排列，返回打乱后的序列</td></tr><tr><td><code>sample(pok,k)</code></td><td>从<code>pop</code>类型中随机选取<code>k</code>个元素，以列表类型返回</td></tr></tbody></table><blockquote><p>生成随机数之前可通过<code>seed()</code>函数指定随机数种子，随机数种子一般是一个整数，只要种子相同，每次生成的随机数序列也相同</p></blockquote><h2 id="十八、技巧"><a href="#十八、技巧" class="headerlink" title="十八、技巧"></a>十八、技巧</h2><p><strong>查看命令信息</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 例如</span></span><br><span class="line">help(filter)</span><br></pre></td></tr></table></figure><p><strong>列表中取出符合条件的元素</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 取出大于5的元素</span></span><br><span class="line"></span><br><span class="line">arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line"></span><br><span class="line">arr1 = filter(lambda x: x&gt;<span class="number">5</span>, arr)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转化为列表</span></span><br><span class="line">list(arr1)</span><br></pre></td></tr></table></figure><p><strong>列表推导式</strong></p><blockquote><p>代替for和if嵌套循环。最常用的方式</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// for循环列子</span></span><br><span class="line">list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line"> <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">    list.append(x*x)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 等价于上面写法</span></span><br><span class="line">[x*x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> x%<span class="number">2</span> == <span class="number">0</span>]</span><br></pre></td></tr></table></figure><p><strong>字典推导式</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一般写法</span></span><br><span class="line">d = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">'xxx'</span>:</span><br><span class="line">  d[i] = i</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 字典推导写法</span></span><br><span class="line">&#123;<span class="attr">i</span>:i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">'xxx'</span>&#125;</span><br></pre></td></tr></table></figure><p><strong>文件读取</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># f = open('test.txt',encoding='utf-8')</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># data = f.readlines()</span></span><br><span class="line"><span class="comment"># for line in data:</span></span><br><span class="line"><span class="comment">#   print(line.strip('\n'))</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># f.close()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 推荐用with处理</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'test.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">  <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">    print(line.strip(<span class="string">'\n'</span>))</span><br></pre></td></tr></table></figure><p><strong>函数作用域</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">def test():</span><br><span class="line">    global a <span class="comment">// 定义一个全局变量</span></span><br></pre></td></tr></table></figure><p><strong>装饰器</strong></p><blockquote><p>本质是返回一个闭包</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">'start'</span>)</span><br><span class="line">        func()</span><br><span class="line">        print(<span class="string">'end'</span>)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line">    </span><br><span class="line"><span class="meta">@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'测试'</span>)</span><br></pre></td></tr></table></figure><p><strong>交换两个变量</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = <span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x,y = y,x</span><br></pre></td></tr></table></figure><h2 id="十九、Python知识体系"><a href="#十九、Python知识体系" class="headerlink" title="十九、Python知识体系"></a>十九、Python知识体系</h2><p><img src="http://blog.poetries.top/img-repo/2019/12/181.png" alt="Python知识体系"></p><h2 id="二十、更多参考"><a href="#二十、更多参考" class="headerlink" title="二十、更多参考"></a>二十、更多参考</h2><ul><li><a href="https://www.liaoxuefeng.com/wiki/1016959663602400" target="_blank" rel="noopener">廖雪峰python3教程</a></li><li><a href="https://jupyter.org/" target="_blank" rel="noopener">Jupyter Notebook</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;最近需要用&lt;code&gt;python&lt;/code&gt;做数据分析，决定开始学&lt;code&gt;python&lt;/code&gt;，总结一些基础笔记&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;一、导语&quot;&gt;&lt;a href=&quot;#一、导语&quot; class=&quot;heade
      
    
    </summary>
    
      <category term="Back-end" scheme="http://blog.poetries.top/categories/Back-end/"/>
    
    
      <category term="python" scheme="http://blog.poetries.top/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>ES2015/ES2016/ES2017/ES2018/ES2019</title>
    <link href="http://blog.poetries.top/2019/11/17/es6-review-summary/"/>
    <id>http://blog.poetries.top/2019/11/17/es6-review-summary/</id>
    <published>2019-11-17T11:50:43.000Z</published>
    <updated>2019-12-16T02:35:06.811Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://blog.poetries.top/img-repo/2019/11/123.png" alt></p><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><ul><li><code>ES6</code>是<code>ECMA</code>为<code>JavaScript</code>制定的第6个标准版本</li><li>标准委员会最终决定，标准在每年6月正式发布并作为当年的正式版本，接下来的时间里就在此版本的基础上进行改动，直到下一年6月草案就自然变成新一年的版本，这样一来就无需以前的版本号，只要用年份标记即可。<code>ECMAscript 2015</code>是在2015年6月发布ES6的第一个版本。以此类推，<code>ECMAscript</code> 2016是ES6的第二个版本、 ECMAscript 2017是ES6的第三个版本。ES6既是一个历史名词也是一个泛指，含义是5.1版本以后的JavaScript下一代标准，目前涵盖了<code>ES2015</code>、<code>ES2016</code>、<code>ES2017</code>、<code>ES2018</code>、<code>ES2019</code></li></ul><blockquote><p>所以有些文章上提到的ES7(实质上是ES2016)、ES8(实质上是ES2017)、ES9(实质上是ES2018)、ES10(实质上是ES2019)，实质上都是一些不规范的概念。从ES1到ES6，每个标准都是花了好几年甚至十多年才制定下来，你一个ES6到ES7，ES7到ES8，才用了一年，按照这样的定义下去，那不是很快就ES20了。用正确的概念来说ES6目前涵盖了ES2015、ES2016、ES2017、ES2018、ES2019</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/11/124.png" alt></p><h2 id="二、ES2015"><a href="#二、ES2015" class="headerlink" title="二、ES2015"></a>二、ES2015</h2><p><img src="http://blog.poetries.top/img-repo/2019/11/125.png" alt></p><h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><ul><li><code>const</code>命令：声明常量</li><li><code>let</code>命令：声明变量</li></ul><blockquote><p>作用</p></blockquote><p><strong>作用域</strong></p><ul><li>全局作用域</li><li>函数作用域：<code>function() {}</code></li><li>块级作用域：<code>{}</code></li></ul><p><strong>作用范围</strong></p><ul><li><code>var</code>命令在全局代码中执行</li><li><code>const</code>命令和<code>let</code>命令只能在代码块中执行</li></ul><p><strong>赋值使用</strong></p><ul><li><code>const</code>命令声明常量后必须立马赋值</li><li><code>let</code>命令声明变量后可立马赋值或使用时赋值</li></ul><blockquote><p>声明方法：<code>var</code>、<code>const</code>、<code>let</code>、<code>function</code>、<code>class</code>、<code>import</code></p></blockquote><p><strong>重点难点</strong></p><ul><li>不允许重复声明</li><li>未定义就使用会报错：<code>const</code>命令和<code>let</code>命令不存在变量提升</li><li>暂时性死区：在代码块内使用let命令声明变量之前，该变量都不可用</li></ul><h3 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h3><ul><li>字符串解构：<code>const [a, b, c, d, e] = &quot;hello&quot;</code></li><li>数值解构：<code>const { toString: s } = 123</code></li><li>布尔值解构：<code>const { toString: b } = true</code></li></ul><p><strong>对象解构</strong></p><ul><li>形式：<code>const { x, y } = { x: 1, y: 2 }</code></li><li>默认：<code>const { x, y = 2 } = { x: 1 }</code></li><li>改名：<code>const { x, y: z } = { x: 1, y: 2 }</code></li></ul><p><strong>数组解构</strong></p><ul><li>规则：数据结构具有<code>Iterator</code>接口可采用数组形式的解构赋值</li><li>形式：<code>const [x, y] = [1, 2]</code></li><li>默认：<code>const [x, y = 2] = [1]</code></li></ul><p><strong>函数参数解构</strong></p><ul><li>数组解构：<code>function Func([x = 0, y = 1]) {}</code></li><li>对象解构：<code>function Func({ x = 0, y = 1 } = {}) {}</code></li></ul><p><strong>应用场景</strong></p><ul><li>交换变量值：<code>[x, y] = [y, x]</code></li><li>返回函数多个值：<code>const [x, y, z] = Func()</code></li><li>定义函数参数：<code>Func([1, 2])</code></li><li>提取JSON数据：<code>const { name, version } = packageJson</code></li><li>定义函数参数默认值：<code>function Func({ x = 1, y = 2 } = {}) {}</code></li><li>遍历Map结构：<code>for (let [k, v] of Map) {}</code></li><li>输入模块指定属性和方法：<code>const { readFile, writeFile } = require(&quot;fs&quot;)</code></li></ul><p><strong>重点难点</strong></p><ul><li>匹配模式：只要等号两边的模式相同，左边的变量就会被赋予对应的值</li><li>解构赋值规则：只要等号右边的值不是对象或数组，就先将其转为对象</li><li>解构默认值生效条件：属性值严格等于undefined</li><li>解构遵循匹配模式</li><li>解构不成功时变量的值等于<code>undefined</code></li><li><code>undefined</code>和<code>null</code>无法转为对象，因此无法进行解构</li></ul><h3 id="字符串扩展"><a href="#字符串扩展" class="headerlink" title="字符串扩展"></a>字符串扩展</h3><ul><li><code>Unicode</code>表示法：大括号包含表示<code>Unicode</code>字符(<code>\u{0xXX}</code>或<code>\u{0XXX}</code>)</li><li>字符串遍历：可通过for-of遍历字符串</li><li>字符串模板：可单行可多行可插入变量的增强版字符串</li><li>标签模板：函数参数的特殊调用</li><li><code>String.raw()</code>：返回把字符串所有变量替换且对斜杠进行转义的结果</li><li><code>String.fromCodePoint()</code>：返回码点对应字符</li><li><code>codePointAt()</code>：返回字符对应码点(<code>String.fromCodePoint()</code>的逆操作)</li><li><code>normalize()</code>：把字符的不同表示方法统一为同样形式，返回新字符串(Unicode正规化)</li><li><code>repeat()</code>：把字符串重复n次，返回新字符串</li><li><code>matchAll()</code>：返回正则表达式在字符串的所有匹配</li><li><code>includes()</code>：是否存在指定字符串</li><li><code>startsWith()</code>：是否存在字符串头部指定字符串</li><li><code>endsWith()</code>：是否存在字符串尾部指定字符串</li></ul><p><strong>重点难点</strong></p><blockquote><p>以上扩展方法均可作用于由4个字节储存的<code>Unicode</code>字符上</p></blockquote><h3 id="数值扩展"><a href="#数值扩展" class="headerlink" title="数值扩展"></a>数值扩展</h3><ul><li>二进制表示法：0b或0B开头表示二进制(<code>0bXX</code>或<code>0BXX</code>)</li><li>八进制表示法：0o或0O开头表示二进制(<code>0oXX</code>或<code>0OXX</code>)</li><li><code>Number.EPSILON</code>：数值最小精度</li><li><code>Number.MIN_SAFE_INTEGER</code>：最小安全数值(<code>-2^53</code>)</li><li><code>Number.MAX_SAFE_INTEGER</code>：最大安全数值(<code>2^53</code>)</li><li><code>Number.parseInt()</code>：返回转换值的整数部分</li><li><code>Number.parseFloat()</code>：返回转换值的浮点数部分</li><li><code>Number.isFinite()</code>：是否为有限数值</li><li><code>Number.isNaN()</code>：是否为<code>NaN</code></li><li><code>Number.isInteger()</code>：是否为整数</li><li><code>Number.isSafeInteger()</code>：是否在数值安全范围内</li><li><code>Math.trunc()</code>：返回数值整数部分</li><li><code>Math.sign()</code>：返回数值类型(正数1、负数-1、零0)</li><li><code>Math.cbrt()</code>：返回数值立方根</li><li><code>Math.clz32()</code>：返回数值的32位无符号整数形式</li><li><code>Math.imul()</code>：返回两个数值相乘</li><li><code>Math.fround()</code>：返回数值的32位单精度浮点数形式</li><li><code>Math.hypot()</code>：返回所有数值平方和的平方根</li><li><code>Math.expm1()</code>：返回<code>e^n - 1</code></li><li><code>Math.log1p()</code>：返回<code>1 + n</code>的自然对数(<code>Math.log(1 + n)</code>)</li><li><code>Math.log10()</code>：返回以10为底的n的对数</li><li><code>Math.log2()</code>：返回以2为底的n的对数</li><li><code>Math.sinh()</code>：返回n的双曲正弦</li><li><code>Math.cosh()</code>：返回n的双曲余弦</li><li><code>Math.tanh()</code>：返回n的双曲正切</li><li><code>Math.asinh()</code>：返回n的反双曲正弦</li><li><code>Math.acosh()</code>：返回n的反双曲余弦</li><li><code>Math.atanh()</code>：返回n的反双曲正切</li></ul><h3 id="对象扩展"><a href="#对象扩展" class="headerlink" title="对象扩展"></a>对象扩展</h3><ul><li>简洁表示法：直接写入变量和函数作为对象的属性和方法<code>({ prop, method() {} })</code></li><li>属性名表达式：字面量定义对象时使用[]定义键(<code>[prop]</code>，不能与上同时使用)</li><li><strong>方法的name属性：返回方法函数名</strong><ul><li>取值函数(<code>getter</code>)和存值函数(<code>setter</code>)：<code>get/set</code>函数名(属性的描述对象在get和set上)</li><li><code>bind</code>返回的函数：<code>bound</code> 函数名</li><li><code>Function</code>构造函数返回的函数实例：<code>anonymous</code></li></ul></li><li>属性的可枚举性和遍历：描述对象的<code>enumerable</code></li><li><code>super</code>关键字：指向当前对象的原型对象(只能用在对象的简写方法中<code>method() {}</code>)</li><li><code>Object.is()</code>：对比两值是否相等</li><li><code>Object.assign()</code>：合并对象(浅拷贝)，返回原对象</li><li><code>Object.getPrototypeOf()</code>：返回对象的原型对象</li><li><code>Object.setPrototypeOf()</code>：设置对象的原型对象</li><li><code>__proto__</code>：返回或设置对象的原型对象</li></ul><p><strong>属性遍历</strong></p><ul><li>描述：自身、可继承、可枚举、非枚举、<code>Symbol</code></li><li><strong>遍历</strong><ul><li><code>for-in</code>：遍历对象自身可继承可枚举属性</li><li><code>Object.keys()</code>：返回对象自身可枚举属性的键组成的数组</li><li><code>Object.getOwnPropertyNames()</code>：返回对象自身可继承可枚举非枚举属性的键组成的数组</li><li><code>Object.getOwnPropertySymbols()</code>：返回对象<code>Symbol</code>属性的键组成的数组</li><li><code>Reflect.ownKeys()</code>：返回对象自身可继承可枚举非枚举Symbol属性的键组成的数组</li></ul></li><li><strong>规则</strong><ul><li>首先遍历所有数值键，按照数值升序排列</li><li>其次遍历所有字符串键，按照加入时间升序排列</li><li>最后遍历所有<code>Symbol</code>键，按照加入时间升序排列</li></ul></li></ul><h3 id="数组扩展"><a href="#数组扩展" class="headerlink" title="数组扩展"></a>数组扩展</h3><ul><li>扩展运算符(<code>...</code>)：转换数组为用逗号分隔的参数序列(<code>[...arr]</code>，相当于<code>rest/spread</code>参数的逆运算)</li><li><code>Array.from()</code>：转换具有<code>Iterator</code>接口的数据结构为真正数组，返回新数组<ul><li>类数组对象：包含<code>length</code>的对象、<code>Arguments</code>对象、<code>NodeList</code>对象</li><li>可遍历对象：<code>String</code>、<code>Set</code>结构、<code>Map</code>结构、<code>Generator</code>函数</li></ul></li><li><code>Array.of()</code>：转换一组值为真正数组，返回新数组</li><li><code>copyWithin()</code>：把指定位置的成员复制到其他位置，返回原数组</li><li><code>find()</code>：返回第一个符合条件的成员</li><li><code>findIndex()</code>：返回第一个符合条件的成员索引值</li><li><code>fill()</code>：根据指定值填充整个数组，返回原数组</li><li><code>keys()</code>：返回以索引值为遍历器的对象</li><li><code>values()</code>：返回以属性值为遍历器的对象</li><li><code>entries()</code>：返回以索引值和属性值为遍历器的对象</li><li>数组空位：ES6明确将数组空位转为<code>undefined</code>(空位处理规不一，建议避免出现)</li></ul><p><strong>扩展应用</strong></p><ul><li>克隆数组：<code>const arr = [...arr1]</code></li><li>合并数组：<code>const arr = [...arr1, ...arr2]</code></li><li>拼接数组：<code>arr.push(...arr1)</code></li><li>代替<code>apply</code>：<code>Math.max.apply(null, [x, y]) =&gt; Math.max(...[x, y])</code></li><li>转换字符串为数组：<code>[...&quot;hello&quot;]</code></li><li>转换类数组对象为数组：<code>[...Arguments, ...NodeList]</code></li><li>转换可遍历对象为数组：<code>[...String, ...Set, ...Map, ...Generator]</code></li><li>与数组解构赋值结合：<code>const [x, ...rest/spread] = [1, 2, 3]</code></li><li>计算<code>Unicode</code>字符长度：<code>Array.from(&quot;hello&quot;).length =&gt; [...&quot;hello&quot;].length</code></li></ul><p><strong>重点难点</strong></p><ul><li>使用<code>keys()</code>、<code>values()</code>、<code>entries()</code>返回的遍历器对象，可用<code>for-of</code>自动遍历或<code>next()</code>手动遍历</li></ul><h3 id="函数扩展"><a href="#函数扩展" class="headerlink" title="函数扩展"></a>函数扩展</h3><ul><li><strong>参数默认值：为函数参数指定默认值</strong><ul><li>形式：<code>function Func(x = 1, y = 2) {}</code></li><li>参数赋值：惰性求值(函数调用后才求值)</li><li>参数位置：尾参数</li><li>参数作用域：函数作用域</li><li>声明方式：默认声明，不能用<code>const</code>或<code>let</code>再次声明</li><li><code>length</code>：返回没有指定默认值的参数个数</li><li>与解构赋值默认值结合：<code>function Func({ x = 1, y = 2 } = {}) {}</code>  </li><li><strong>应用</strong><ul><li>指定某个参数不得省略，省略即抛出错误：<code>function Func(x = throwMissing()) {}</code></li><li>将参数默认值设为<code>undefined</code>，表明此参数可省略：<code>Func(undefined, 1)</code></li></ul></li></ul></li><li><strong>rest/spread参数(…)：返回函数多余参数</strong><ul><li>形式：以数组的形式存在，之后不能再有其他参数</li><li>作用：代替<code>Arguments</code>对象</li><li><code>length</code>：返回没有指定默认值的参数个数但不包括<code>rest/spread</code>参数</li></ul></li><li><strong>严格模式：在严格条件下运行JS</strong><ul><li>应用：只要函数参数使用默认值、解构赋值、扩展运算符，那么函数内部就不能显式设定为严格模式</li></ul></li><li><strong>name属性</strong>：返回函数的函数名<ul><li>将匿名函数赋值给变量：空字符串(ES5)、变量名(ES6)</li><li>将具名函数赋值给变量：函数名(ES5和ES6)</li><li><code>bind</code>返回的函数：<code>bound</code> 函数名(ES5和ES6)</li><li><code>Function</code>构造函数返回的函数实例：<code>anonymous</code>(ES5和ES6)</li></ul></li><li><strong>箭头函数(=&gt;)：函数简写</strong><ul><li>无参数：<code>() =&gt; {}</code></li><li>单个参数：<code>x =&gt; {}</code></li><li>多个参数：<code>(x, y) =&gt; {}</code></li><li>解构参数：<code>({x, y}) =&gt; {}</code></li><li>嵌套使用：部署管道机制</li><li><code>this</code>指向固定化<ul><li>并非因为内部有绑定<code>this</code>的机制，而是根本没有自己的<code>this</code>，导致内部的<code>this</code>就是外层代码块的<code>this</code></li><li>因为没有<code>this</code>，因此不能用作构造函数</li></ul></li></ul></li><li><strong>尾调用优化：只保留内层函数的调用帧</strong><ul><li><strong>尾调用</strong><ul><li>定义：某个函数的最后一步是调用另一个函数</li><li>形式：<code>function f(x) { return g(x); }</code></li></ul></li><li><strong>尾递归</strong><ul><li>定义：函数尾调用自身</li><li>作用：只要使用尾递归就不会发生栈溢出，相对节省内存</li><li>实现：把所有用到的内部变量改写成函数的参数并使用参数默认值</li></ul></li></ul></li></ul><p><strong>箭头函数误区</strong></p><ul><li>函数体内的<code>this</code>是定义时所在的对象而不是使用时所在的对象</li><li>可让<code>this</code>指向固定化，这种特性很有利于封装回调函数</li><li>不可当作构造函数，因此箭头函数不可使用<code>new</code>命令</li><li>不可使用<code>yield</code>命令，因此箭头函数不能用作<code>Generator</code>函数</li><li>不可使用<code>Arguments</code>对象，此对象在函数体内不存在(可用<code>rest/spread</code>参数代替)</li><li>返回对象时必须在对象外面加上括号</li></ul><h3 id="正则扩展"><a href="#正则扩展" class="headerlink" title="正则扩展"></a>正则扩展</h3><ul><li><strong>变更<code>RegExp</code>构造函数入参</strong>：允许首参数为正则对象，尾参数为正则修饰符(返回的正则表达式会忽略原正则表达式的修饰符)</li><li><strong>正则方法调用变更</strong>：字符串对象的<code>match()</code>、<code>replace()</code>、<code>search()</code>、<code>split()</code>内部调用转为调用<code>RegExp</code>实例对应的<code>RegExp.prototype[Symbol.方法]</code></li><li><strong>u修饰符</strong>：<code>Unicode</code>模式修饰符，正确处理大于<code>\uFFFF</code>的<code>Unicode</code>字符<ul><li>点字符(<code>.</code>)</li><li><code>Unicode</code>表示法</li><li>量词</li><li>预定义模式</li><li><code>i</code>修饰符</li><li>转义</li></ul></li><li><strong>y修饰符</strong>：粘连修饰符，确保匹配必须从剩余的第一个位置开始全局匹配(与g修饰符作用类似)</li><li><strong>unicode</strong>：是否设置<code>u</code>修饰符</li><li><strong>sticky</strong>：是否设置<code>y</code>修饰符</li><li><strong>flags</strong>：正则表达式的修饰符</li></ul><p><strong>重点难点</strong></p><ul><li><code>y</code>修饰符隐含头部匹配标志<code>^</code></li><li>单单一个y修饰符对<code>match()</code>只能返回第一个匹配，必须与g修饰符联用才能返回所有匹配</li></ul><h3 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h3><ul><li>定义：独一无二的值</li><li>声明：<code>const set = Symbol(str)</code></li><li>入参：字符串(可选)</li></ul><p><strong>方法</strong></p><ul><li><code>Symbol()</code>：创建以参数作为描述的Symbol值(不登记在全局环境)</li><li><code>Symbol.for()</code>：创建以参数作为描述的Symbol值，如存在此参数则返回原有的Symbol值(先搜索后创建，登记在全局环境)</li><li><code>Symbol.keyFor()</code>：返回已登记的<code>Symbol</code>值的描述(只能返回<code>Symbol.for()</code>的<code>key</code>)</li><li><code>Object.getOwnPropertySymbols()</code>：返回对象中所有用作属性名的<code>Symbol</code>值的数组</li></ul><p><strong>内置</strong></p><ul><li><code>Symbol.hasInstance</code>：指向一个内部方法，当其他对象使用<code>instanceof</code>运算符判断是否为此对象的实例时会调用此方法</li><li><code>Symbol.isConcatSpreadable</code>：指向一个布尔值，定义对象用于<code>Array.prototype.concat()</code>时是否可展开</li><li><code>Symbol.species</code>：指向一个构造函数，当实例对象使用自身构造函数时会调用指定的构造函数</li><li><code>Symbol.match</code>：指向一个函数，当实例对象被<code>String.prototype.match()</code>调用时会重新定义<code>match()</code>的行为</li><li><code>Symbol.replace</code>：指向一个函数，当实例对象被<code>String.prototype.replace()</code>调用时会重新定义<code>replace()</code>的行为</li><li><code>Symbol.search</code>：指向一个函数，当实例对象被<code>String.prototype.search()</code>调用时会重新定义<code>search()</code>的行为</li><li><code>Symbol.split</code>：指向一个函数，当实例对象被<code>String.prototype.split()</code>调用时会重新定义<code>split()</code>的行为</li><li><code>Symbol.iterator</code>：指向一个默认遍历器方法，当实例对象执行<code>for-of</code>时会调用指定的默认遍历器</li><li><code>Symbol.toPrimitive</code>：指向一个函数，当实例对象被转为原始类型的值时会返回此对象对应的原始类型值</li><li><code>Symbol.toStringTag</code>：指向一个函数，当实例对象被<code>Object.prototype.toString()</code>调用时其返回值会出现在<code>toString()</code>返回的字符串之中表示对象的类型</li><li><code>Symbol.unscopables</code>：指向一个对象，指定使用<code>with</code>时哪些属性会被<code>with</code>环境排除</li></ul><p><strong>数据类型</strong></p><ul><li><code>Undefined</code></li><li><code>Null</code></li><li><code>String</code></li><li><code>Number</code></li><li><code>Boolean</code></li><li><code>Object</code>(包含<code>Array</code>、<code>Function</code>、<code>Date</code>、<code>RegExp</code>、<code>Error</code>)</li><li><code>Symbol</code></li></ul><p><strong>应用场景</strong></p><ul><li>唯一化对象属性名：属性名属于<code>Symbol</code>类型，就都是独一无二的，可保证不会与其他属性名产生冲突</li><li>消除魔术字符串：在代码中多次出现且与代码形成强耦合的某一个具体的字符串或数值</li><li>遍历属性名：无法通过<code>for-in</code>、<code>for-of</code>、<code>Object.keys()</code>、<code>Object.getOwnPropertyNames()</code>、<code>JSON.stringify()</code>返回，只能通过<code>Object.getOwnPropertySymbols</code>返回<br>启用模块的<code>Singleton</code>模式：调用一个类在任何时候返回同一个实例(<code>window</code>和<code>global</code>)，- 使用<code>Symbol.for()</code>来模拟全局的<code>Singleton</code>模式</li></ul><p><strong>重点难点</strong></p><ul><li><code>Symbol()</code>生成一个原始类型的值不是对象，因此<code>Symbol()</code>前不能使用<code>new</code>命令</li><li><code>Symbol()</code>参数表示对当前<code>Symbol</code>值的描述，相同参数的<code>Symbol()</code>返回值不相等</li><li><code>Symbol</code>值不能与其他类型的值进行运算</li><li><code>Symbol</code>值可通过<code>String()</code>或<code>toString()</code>显式转为字符串</li><li><code>Symbol</code>值作为对象属性名时，此属性是公开属性，但不是私有属性</li><li><code>Symbol</code>值作为对象属性名时，只能用方括号运算符(<code>[]</code>)读取，不能用点运算符(<code>.</code>)读取`</li><li><code>Symbol</code>值作为对象属性名时，不会被常规方法遍历得到，可利用此特性为对象定义非私有但又只用于内部的方法</li></ul><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p><strong>Set</strong></p><ul><li>定义：类似于数组的数据结构，成员值都是唯一且没有重复的值</li><li>声明：<code>const set = new Set(arr)</code></li><li>入参：具有<code>Iterator</code>接口的数据结构</li><li>属性<ul><li><code>constructor</code>：构造函数，返回<code>Set</code></li><li><code>size</code>：返回实例成员总数</li></ul></li><li>方法<ul><li><code>add()</code>：添加值，返回实例</li><li><code>delete()</code>：删除值，返回布尔值</li><li><code>has()</code>：检查值，返回布尔值</li><li><code>clear()</code>：清除所有成员</li><li><code>keys()</code>：返回以属性值为遍历器的对象</li><li><code>values()</code>：返回以属性值为遍历器的对象</li><li><code>entries()</code>：返回以属性值和属性值为遍历器的对象</li><li><code>forEach()</code>：使用回调函数遍历每个成员</li></ul></li></ul><p><strong>应用场景</strong></p><ul><li>去重字符串：<code>[...new Set(str)].join(&quot;&quot;)</code></li><li>去重数组：<code>[...new Set(arr)]或Array.from(new Set(arr))</code></li><li>集合数组<ul><li>声明：<code>const a = new Set(arr1)、const b = new Set(arr2)</code></li><li>并集：<code>new Set([...a, ...b])</code></li><li>交集：<code>new Set([...a].filter(v =&gt; b.has(v)))</code></li><li>差集：<code>new Set([...a].filter(v =&gt; !b.has(v)))</code></li></ul></li><li>映射集合<ul><li>声明：<code>let set = new Set(arr)</code></li><li>映射：<code>set = new Set([...set].map(v =&gt; v * 2))</code>或<code>set = new Set(Array.from(set, v =&gt; v * 2))</code></li></ul></li></ul><p><strong>重点难点</strong></p><ul><li>遍历顺序：插入顺序</li><li>没有键只有值，可认为键和值两值相等</li><li>添加多个<code>NaN</code>时，只会存在一个<code>NaN</code></li><li>添加相同的对象时，会认为是不同的对象</li><li>添加值时不会发生类型转换<code>(5 !== &quot;5&quot;)</code></li><li><code>keys()</code>和<code>values()</code>的行为完全一致，<code>entries()</code>返回的遍历器同时包括键和值且两值相等</li></ul><p><strong>WeakSet</strong></p><ul><li>定义：和<code>Set</code>结构类似，成员值只能是对象</li><li>声明：<code>const set = new WeakSet(arr)</code></li><li>入参：具有`Iterator接口的数据结构</li><li>属性<ul><li><code>constructor</code>：构造函数，返回<code>WeakSet</code></li></ul></li><li>方法<ul><li><code>add()</code>：添加值，返回实例</li><li><code>delete()</code>：删除值，返回布尔值</li><li><code>has()</code>：检查值，返回布尔值</li></ul></li></ul><p><strong>应用场景</strong></p><ul><li>储存<code>DOM</code>节点：<code>DOM</code>节点被移除时自动释放此成员，不用担心这些节点从文档移除时会引发内存泄漏</li><li>临时存放一组对象或存放跟对象绑定的信息：只要这些对象在外部消失，它在<code>WeakSe</code>t结构中的引用就会自动消</li></ul><p><strong>重点难点</strong></p><ul><li>成员都是弱引用，垃圾回收机制不考虑<code>WeakSet</code>结构对此成员的引用</li><li>成员不适合引用，它会随时消失，因此ES6规定<code>WeakSet</code>结构不可遍历</li><li>其他对象不再引用成员时，垃圾回收机制会自动回收此成员所占用的内存，不考虑此成员是否还存在于<code>WeakSet</code>结构中</li></ul><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p><strong>Map</strong></p><ul><li>定义：类似于对象的数据结构，成员键可以是任何类型的值</li><li>声明：<code>const set = new Map(arr)</code></li><li>入参：具有<code>Iterator</code>接口且每个成员都是一个双元素数组的数据结构</li><li>属性<ul><li><code>constructor</code>：构造函数，返回<code>Map</code></li><li><code>size</code>：返回实例成员总数</li></ul></li><li>方法<ul><li><code>get()</code>：返回键值对</li><li><code>set()</code>：添加键值对，返回实例</li><li><code>delete()</code>：删除键值对，返回布尔值</li><li><code>has()</code>：检查键值对，返回布尔值</li><li><code>clear()</code>：清除所有成员</li><li><code>keys()</code>：返回以键为遍历器的对象</li><li><code>values()</code>：返回以值为遍历器的对象</li><li><code>entries()</code>：返回以键和值为遍历器的对象</li><li><code>forEach()</code>：使用回调函数遍历每个成员</li></ul></li></ul><p><strong>重点难点</strong></p><ul><li>遍历顺序：插入顺序</li><li>对同一个键多次赋值，后面的值将覆盖前面的值</li><li>对同一个对象的引用，被视为一个键</li><li>对同样值的两个实例，被视为两个键</li><li>键跟内存地址绑定，只要内存地址不一样就视为两个键</li><li>添加多个以<code>NaN</code>作为键时，只会存在一个以<code>NaN</code>作为键的值</li><li><code>Object</code>结构提供字符串—值的对应，<code>Map</code>结构提供值—值的对应</li></ul><p><strong>WeakMap</strong></p><ul><li>定义：和<code>Map</code>结构类似，成员键只能是对象</li><li>声明：<code>const set = new WeakMap(arr)</code></li><li>入参：具有Iterator接口且每个成员都是一个双元素数组的数据结构</li><li>属性<ul><li><code>constructor</code>：构造函数，返回<code>WeakMap</code></li></ul></li><li>方法<ul><li><code>get()</code>：返回键值对</li><li><code>set()</code>：添加键值对，返回实例</li><li><code>delete()</code>：删除键值对，返回布尔值</li><li><code>has()</code>：检查键值对，返回布尔值</li></ul></li></ul><p><strong>应用场景</strong></p><ul><li>储存DOM节点：DOM节点被移除时自动释放此成员键，不用担心这些节点从文档移除时会引发内存泄漏</li><li>部署私有属性：内部属性是实例的弱引用，删除实例时它们也随之消失，不会造成内存泄漏</li></ul><p><strong>重点难点</strong></p><ul><li>成员键都是弱引用，垃圾回收机制不考虑<code>WeakMap</code>结构对此成员键的引用</li><li>成员键不适合引用，它会随时消失，因此ES6规定<code>WeakMap</code>结构不可遍历</li><li>其他对象不再引用成员键时，垃圾回收机制会自动回收此成员所占用的内存，不考虑此成员是否还存在于<code>WeakMap</code>结构中</li><li>一旦不再需要，成员会自动消失，不用手动删除引用</li><li>弱引用的只是键而不是值，值依然是正常引用</li><li>即使在外部消除了成员键的引用，内部的成员值依然存在</li></ul><h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><ul><li>定义：修改某些操作的默认行为</li><li>声明：<code>const proxy = new Proxy(target, handler)</code></li><li>入参<ul><li><code>target</code>：拦截的目标对象</li><li><code>handler</code>：定制拦截行为</li></ul></li><li><p>方法</p><ul><li><code>Proxy.revocable()</code>：返回可取消的<code>Proxy</code>实例(返回<code>{ proxy, revoke }</code>，通过<code>revoke()</code>取消代理)</li></ul></li><li><p>拦截方式</p><ul><li><code>get()</code>：拦截对象属性读取</li><li><code>set()</code>：拦截对象属性设置，返回布尔值</li><li><code>has()</code>：拦截对象属性检查<code>k in obj</code>，返回布尔值</li><li><code>deleteProperty()</code>：拦截对象属性删除<code>delete obj[k]</code>，返回布尔值</li><li><code>defineProperty()</code>：拦截对象属性定义<code>Object.defineProperty()</code>、<code>Object.defineProperties()</code>，返回布尔值</li><li><code>ownKeys()</code>：拦截对象属性遍历<code>for-in</code>、<code>Object.keys()</code>、<code>Object.getOwnPropertyNames()、Object.getOwnPropertySymbols()</code>，返回数组</li><li><code>getOwnPropertyDescriptor()</code>：拦截对象属性描述读取<code>Object.getOwnPropertyDescriptor()</code>，返回对象</li><li><code>getPrototypeOf()</code>：拦截对象原型读取<code>instanceof</code>、<code>Object.getPrototypeOf()</code>、<code>Object.prototype.__proto__</code>、<code>Object.prototype.isPrototypeOf()</code>、<code>Reflect.getPrototypeOf()</code>，返回对象</li><li><code>setPrototypeOf()</code>：拦截对象原型设置<code>Object.setPrototypeOf()</code>，返回布尔值</li><li><code>isExtensible()</code>：拦截对象是否可扩展读取<code>Object.isExtensible()</code>，返回布尔值</li><li><code>preventExtensions()</code>：拦截对象不可扩展设置<code>Object.preventExtensions()</code>，返回布尔值</li><li><code>apply()</code>：拦截<code>Proxy</code>实例作为函数调用<code>proxy()</code>、<code>proxy.apply()</code>、<code>proxy.call()</code></li><li><code>construct()</code>：拦截<code>Proxy</code>实例作为构造函数调用<code>new proxy()</code></li></ul></li></ul><p><strong>应用场景</strong></p><ul><li><code>Proxy.revocable()</code>：不允许直接访问对象，必须通过代理访问，一旦访问结束就收回代理权不允许再次访问</li><li><code>get()</code>：读取未知属性报错、读取数组负数索引的值、封装链式操作、生成DOM嵌套节点</li><li><code>set()</code>：数据绑定(<code>Vue</code>数据绑定实现原理)、确保属性值设置符合要求、防止内部属性被外部读写</li><li><code>has()</code>：隐藏内部属性不被发现、排除不符合属性条件的对象</li><li><code>deleteProperty()</code>：保护内部属性不被删除</li><li><code>defineProperty()</code>：阻止属性被外部定义</li><li><code>ownKeys()</code>：保护内部属性不被遍历</li></ul><p><strong>重点难点</strong></p><ul><li>要使<code>Proxy</code>起作用，必须针对实例进行操作，而不是针对目标对象进行操作</li><li>没有设置任何拦截时，等同于直接通向原对象</li><li>属性被定义为不可读写/扩展/配置/枚举时，使用拦截方法会报错</li><li>代理下的目标对象，内部<code>this</code>指向<code>Proxy</code>代理</li></ul><h3 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h3><ul><li>定义：保持<code>Object</code>方法的默认行为</li><li>方法<ul><li><code>get()</code>：返回对象属性</li><li><code>set()</code>：设置对象属性，返回布尔值</li><li><code>has()</code>：检查对象属性，返回布尔值</li><li><code>deleteProperty()</code>：删除对象属性，返回布尔值</li><li><code>defineProperty()</code>：定义对象属性，返回布尔值</li><li><code>ownKeys()</code>：遍历对象属性，返回数<code>组(Object.getOwnPropertyNames()+Object.getOwnPropertySymbols())</code></li><li><code>getOwnPropertyDescriptor()</code>：返回对象属性描述，返回对象</li><li><code>getPrototypeOf()</code>：返回对象原型，返回对象</li><li><code>setPrototypeOf()</code>：设置对象原型，返回布尔值</li><li><code>isExtensible()</code>：返回对象是否可扩展，返回布尔值</li><li><code>preventExtensions()</code>：设置对象不可扩展，返回布尔值</li><li><code>apply()</code>：绑定<code>this</code>后执行指定函数</li><li><code>construct()</code>：调用构造函数创建实例</li></ul></li></ul><p><strong>设计目的</strong></p><ul><li><code>Object</code>属于语言内部的方法放到<code>Reflect</code>上</li><li>将某些<code>Object</code>方法报错情况改成返回<code>false</code></li><li>让<code>Object</code>操作变成函数行为</li><li><code>Proxy</code>与<code>Reflect</code>相辅相成</li></ul><p><strong>废弃方法</strong></p><ul><li><code>Object.defineProperty()</code> =&gt; <code>Reflect.defineProperty()</code></li><li><code>Object.getOwnPropertyDescriptor()</code> =&gt; <code>Reflect.getOwnPropertyDescriptor()</code></li></ul><blockquote><p>数据绑定：观察者模式</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> observerQueue = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line"><span class="keyword">const</span> observe = <span class="function"><span class="params">fn</span> =&gt;</span> observerQueue.add(fn);</span><br><span class="line"><span class="keyword">const</span> observable = <span class="function"><span class="params">obj</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="keyword">set</span>(tgt, key, val, receiver) &#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="built_in">Reflect</span>.set(tgt, key, val, receiver);</span><br><span class="line">        observerQueue.forEach(<span class="function"><span class="params">v</span> =&gt;</span> v());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = observable(&#123; <span class="attr">age</span>: <span class="number">25</span>, <span class="attr">name</span>: <span class="string">"Yajun"</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> print = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;person.name&#125;</span> is <span class="subst">$&#123;person.age&#125;</span> years old`</span>);</span><br><span class="line">observe(print);</span><br><span class="line">person.name = <span class="string">"Joway"</span>;</span><br></pre></td></tr></table></figure><h3 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h3><ul><li>定义：对一类具有共同特征的事物的抽象(构造函数语法糖)</li><li>原理：类本身指向构造函数，所有方法定义在<code>prototype</code>上，可看作构造函数的另一种写法(<code>Class === Class.prototype.constructor</code>)</li><li><strong>方法和关键字</strong><ul><li><code>constructor()</code>：构造函数，<code>new</code>命令生成实例时自动调用</li><li><code>extends</code>：继承父类</li><li><code>super</code>：新建父类的this</li><li><code>static</code>：定义静态属性方法</li><li><code>get</code>：取值函数，拦截属性的取值行为</li><li><code>set</code>：存值函数，拦截属性的存值行为</li></ul></li><li><strong>属性</strong><ul><li><code>__proto__</code>：构造函数的继承(总是指向父类)</li><li><code>__proto__.__proto__</code>：子类的原型的原型，即父类的原型(总是指向父类的<code>__proto__</code>)</li><li><code>prototype.__proto__</code>：属性方法的继承(总是指向父类的<code>prototype</code>)</li></ul></li><li><strong>静态属性</strong>：定义类完成后赋值属性，该属性不会被实例继承，只能通过类来调用</li><li><strong>静态方法</strong>：使用static定义方法，该方法不会被实例继承，只能通过类来调用(方法中的this指向类，而不是实例)</li><li><strong>继承</strong><ul><li>实质<ul><li>ES5实质：先创造子类实例的<code>this</code>，再将父类的属性方法添加到<code>this</code>上(<code>Parent.apply(this)</code>)</li><li><code>ES6</code>实质：先将父类实例的属性方法加到<code>this</code>上(调用<code>super()</code>)，再用子类构造函数修改<code>this</code></li><li><code>super</code><ul><li>作为函数调用：只能在构造函数中调用<code>super()</code>，内部<code>this</code>指向继承的当前子类(<code>super()</code>调用后才可在构造函数中使用<code>this</code>)</li><li>作为对象调用：在普通方法中指向父类的原型对象，在静态方法中指向父类</li></ul></li><li>显示定义：使用<code>constructor() { super(); }</code>定义继承父类，没有书写则显示定义</li><li>子类继承父类：子类使用父类的属性方法时，必须在构造函数中调用<code>super()</code>，否则得不到父类的<code>this</code><ul><li>父类静态属性方法可被子类继承</li><li>类继承父类后，可从<code>super</code>上调用父类静态属性方法</li></ul></li></ul></li></ul></li><li><strong>实例</strong>：类相当于实例的原型，所有在类中定义的属性方法都会被实例继承<ul><li>显式指定属性方法：使用<code>this</code>指定到自身上(使用<code>Class.hasOwnProperty()</code>可检测到)</li><li>隐式指定属性方法：直接声明定义在对象原型上(使用<code>Class.__proto__.hasOwnProperty()</code>可检测到)</li></ul></li><li><strong>表达式</strong><ul><li>类表达式：<code>const Class = class {}</code></li><li><code>name</code>属性：返回紧跟<code>class</code>后的类名</li><li>属性表达式：<code>[prop]</code></li><li><code>Generator</code>方法：<code>* mothod() {}</code></li><li><code>Async</code>方法：<code>async mothod() {}</code></li></ul></li><li><strong>this指向</strong>：解构实例属性或方法时会报错<ul><li>绑定<code>this</code>：<code>this.mothod = this.mothod.bind(this)</code></li><li>箭头函数：<code>this.mothod = () =&gt; this.mothod()</code></li></ul></li><li><strong>属性定义位置</strong><ul><li>定义在构造函数中并使用<code>this</code>指向</li><li>定义在类最顶层</li></ul></li><li><strong><code>new.target</code>：确定构造函数是如何调用</strong></li></ul><p><strong>原生构造函数</strong></p><ul><li><code>String()</code></li><li><code>Number()</code></li><li><code>Boolean()</code></li><li><code>Array()</code></li><li><code>Object()</code></li><li><code>Function()</code></li><li><code>Date()</code></li><li><code>RegExp()</code></li><li><code>Error()</code></li></ul><p><strong>重点难点</strong></p><ul><li>在实例上调用方法，实质是调用原型上的方法</li><li><code>Object.assign()</code>可方便地一次向类添加多个方法<code>(Object.assign(Class.prototype, { ... }))</code></li><li>类内部所有定义的方法是不可枚举的(<code>non-enumerable</code>)</li><li>构造函数默认返回实例对象(<code>this</code>)，可指定返回另一个对象</li><li>取值函数和存值函数设置在属性的<code>Descriptor</code>对象上</li><li>类不存在变量提升</li><li>利用<code>new.target === Class</code>写出不能独立使用必须继承后才能使用的类</li><li>子类继承父类后，<code>this</code>指向子类实例，通过<code>super</code>对某个属性赋值，赋值的属性会变成子类实例的属性</li><li>使用<code>super</code>时，必须显式指定是作为函数还是作为对象使用</li><li><code>extends</code>不仅可继承类还可继承原生的构造函数</li></ul><p><strong>私有属性方法</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="built_in">Symbol</span>(<span class="string">"name"</span>);</span><br><span class="line"><span class="keyword">const</span> print = <span class="built_in">Symbol</span>(<span class="string">"print"</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(age) &#123;</span><br><span class="line">        <span class="keyword">this</span>[name] = <span class="string">"Bruce"</span>;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    [print]() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>[name]&#125;</span> is <span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span> years old`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>继承混合类</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CopyProperties</span>(<span class="params">target, source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> <span class="built_in">Reflect</span>.ownKeys(source)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key !== <span class="string">"constructor"</span> &amp;&amp; key !== <span class="string">"prototype"</span> &amp;&amp; key !== <span class="string">"name"</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> desc = <span class="built_in">Object</span>.getOwnPropertyDescriptor(source, key);</span><br><span class="line">            <span class="built_in">Object</span>.defineProperty(target, key, desc);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MixClass</span>(<span class="params">...mixins</span>) </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Mix</span> </span>&#123;</span><br><span class="line">        <span class="keyword">constructor</span>() &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> mixin <span class="keyword">of</span> mixins) &#123;</span><br><span class="line">                CopyProperties(<span class="keyword">this</span>, <span class="keyword">new</span> mixin());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> mixin <span class="keyword">of</span> mixins) &#123;</span><br><span class="line">        CopyProperties(Mix, mixin);</span><br><span class="line">        CopyProperties(Mix.prototype, mixin.prototype);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Mix;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">MixClass</span>(<span class="title">Person</span>, <span class="title">Kid</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h3><p><strong>命令</strong></p><ul><li><code>export</code>：规定模块对外接口<ul><li>默认导出：<code>export default Person</code>(导入时可指定模块任意名称，无需知晓内部真实名称)</li><li>单独导出：<code>export const name = &quot;Bruce&quot;</code></li><li>按需导出：<code>export { age, name, sex }(推荐)</code></li><li>改名导出：<code>export { name as newName }</code></li></ul></li><li><code>import</code>：导入模块内部功能<ul><li>默认导入：<code>import Person from &quot;person&quot;</code></li><li>整体导入：<code>import * as Person from &quot;person&quot;</code></li><li>按需导入：<code>import { age, name, sex } from &quot;person&quot;</code></li><li>改名导入：<code>import { name as newName } from &quot;person&quot;</code></li><li>自执导入：<code>import &quot;person&quot;</code></li><li>复合导入：<code>import Person, { name } from &quot;person&quot;</code></li></ul></li><li>复合模式：<code>export</code>命令和<code>import</code>命令结合在一起写成一行，变量实质没有被导入 当前模块，相当于对外转发接口，导致当前模块无法直接使用其导入变量<ul><li>默认导入导出：<code>export { default } from &quot;person&quot;</code></li><li>整体导入导出：<code>export * from &quot;person&quot;</code></li><li>按需导入导出：<code>export { age, name, sex } from &quot;person&quot;</code></li><li>改名导入导出：<code>export { name as newName } from &quot;person&quot;</code></li><li>具名改默认导入导出：<code>export { name as default } from &quot;person&quot;</code></li><li>默认改具名导入导出：<code>export { default as name } from &quot;person&quot;</code></li></ul></li><li>继承：默认导出和改名导出结合使用可使模块具备继承性</li><li>设计思想：尽量地静态化，使得编译时就能确定模块的依赖关系，以及输入和输出的变量</li><li>严格模式：ES6模块自动采用严格模式(不管模块头部是否添加<code>use strict</code>)</li></ul><p><strong>模块方案</strong></p><ul><li><strong>CommonJS</strong>：用于服务器(动态化依赖)</li><li><strong>AMD</strong>：用于浏览器(动态化依赖)</li><li><strong>CMD</strong>：用于浏览器(动态化依赖)</li><li><strong>UMD</strong>：用于浏览器和服务器(动态化依赖)</li><li><strong>ESM</strong>：用于浏览器和服务器(静态化依赖)</li></ul><p><strong>加载方式</strong></p><ul><li><strong>运行时加载</strong><ul><li>定义：整体加载模块生成一个对象，再从对象上获取需要的属性和方法进行加载(全部加载)</li><li>影响：只有运行时才能得到这个对象，导致无法在编译时做静态优化</li></ul></li><li><strong>编译时加载</strong></li><li>定义：直接从模块中获取需要的属性和方法进行加载(按需加载)</li><li>影响：在编译时就完成模块加载，效率比其他方案高，但无法引用模块本身(本身不是对象)，可拓展JS高级语法(宏和类型校验)</li></ul><p><strong>加载实现</strong></p><ul><li><strong>传统加载</strong>：通过<code>&lt;script&gt;</code>进行同步或异步加载脚本<ul><li>同步加载：<code>&lt;script src=&quot;&quot;&gt;&lt;/script&gt;</code></li><li><code>Defer</code>异步加载：<code>&lt;script src=&quot;&quot; defer&gt;&lt;/script&gt;</code>(顺序加载，渲染完再执行)</li><li><code>Async</code>异步加载：<code>&lt;script src=&quot;&quot; async&gt;&lt;/script&gt;</code>(乱序加载，下载完就执行)</li></ul></li><li><strong>模块加载</strong>：<code>&lt;script type=&quot;module&quot; src=&quot;&quot;&gt;&lt;/script&gt;</code>(默认是<code>Defer</code>异步加载)</li></ul><p><strong>CommonJS和ESM的区别</strong></p><ul><li><code>CommonJS</code>输出值的拷贝，<code>ESM</code>输出值的引用<ul><li><code>CommonJS</code>一旦输出一个值，模块内部的变化就影响不到这个值</li><li><code>ESM</code>是动态引用且不会缓存值，模块里的变量绑定其所在的模块，等到脚本真正执行时，再根据这个只读引用到被加载的那个模块里去取值</li></ul></li><li><code>CommonJS</code>是运行时加载，<code>ESM</code>是编译时加载<ul><li><code>CommonJS</code>加载模块是对象(即<code>module.exports</code>)，该对象只有在脚本运行完才会生成</li><li><code>ESM</code>加载模块不是对象，它的对外接口只是一种静态定义，在代码静态解析阶段就会生成</li></ul></li></ul><p><strong>Node加载</strong></p><ul><li>背景：<code>CommonJS</code>和<code>ESM</code>互不兼容，目前解决方案是将两者分开，采用各自的加载方案</li><li>区分：要求<code>ESM</code>采用<code>.mjs</code>后缀文件名<ul><li><code>require()</code>不能加载<code>.mjs</code>文件，只有<code>import</code>命令才可加载<code>.mjs</code>文件</li><li><code>.mjs</code>文件里不能使用<code>require()</code>，必须使用<code>import</code>命令加载文件</li></ul></li><li>驱动：<code>node --experimental-modules file.mjs</code></li><li>限制：<code>Node</code>的<code>import</code>命令目前只支持加载本地模块(<code>file:协</code>议)，不支持加载远程模块</li><li>加载优先级<ul><li>脚本文件省略后缀名：依次尝试加载四个后缀名文件(<code>.mjs</code>、<code>.js</code>、<code>.json</code>、<code>node</code>)</li><li>以上不存在：尝试加载<code>package.json</code>的<code>main</code>字段指定的脚本</li><li>以上不存在：依次尝试加载名称为<code>index</code>四个后缀名文件(<code>.mjs</code>、<code>.js</code>、<code>.json</code>、<code>node</code>)</li><li>以上不存在：报错</li></ul></li><li>不存在的内部变量：<code>arguments</code>、<code>exports</code>、<code>module</code>、<code>require</code>、<code>this</code>、<code>__dirname</code>、<code>__filename</code></li><li><code>CommonJS</code>加载<code>ESM</code><ul><li>不能使用<code>require()</code>，只能使用<code>import()</code></li></ul></li><li><code>ESM</code>加载<code>CommonJS</code><ul><li>自动将<code>module.exports</code>转化成<code>export default</code></li><li><code>CommonJS</code>输出缓存机制在ESM加载方式下依然有效</li><li>采用<code>import</code>命令加载<code>CommonJS</code>模块时，不允许采用按需导入，应使用默认导入或整体导入</li></ul></li></ul><p><strong>循环加载</strong></p><ul><li>定义：脚本<code>A</code>的执行依赖脚本<code>B</code>，而脚本<code>A</code>的执行又依赖脚本B</li><li><strong>加载原理</strong><ul><li><code>CommonJS</code>：<code>require()</code>首次加载脚本就会执行整个脚本，在内存里生成一个对象缓存下来，二次加载脚本时直接从缓存中获取</li><li><code>ESM</code>：<code>import</code>命令加载变量不会被缓存，而是成为一个指向被加载模块的引用</li></ul></li><li><strong>循环加载</strong><ul><li><code>CommonJS</code>：只输出已经执行的部分，还未执行的部分不会输出</li><li><code>ESM</code>：需开发者自己保证真正取值时能够取到值(可把变量写成函数形式，函数具有提升作用)</li></ul></li></ul><p><strong>重点难点</strong></p><ul><li><code>ES6</code>模块中，顶层<code>this</code>指向<code>undefined</code>，不应该在顶层代码使用<code>this</code></li><li>`一个模块就是一个独立的文件，该文件内部的所有变量，外部无法获取</li><li><code>export</code>命令输出的接口与其对应的值是动态绑定关系，即通过该接口可获取模块内部实时的值</li><li><code>import</code>命令大括号里的变量名必须与被导入模块对外接口的名称相同</li><li><code>import</code>命令输入的变量只读(本质是输入接口)，不允许在加载模块的脚本里改写接口</li><li><code>import</code>命令命令具有提升效果，会提升到整个模块的头部，首先执行<br>重复执行同一句import语句，只会执行一次</li><li><code>export default</code>命令只能使用一次</li><li><code>export default</code>命令导出的整体模块，在执行<code>import</code>命令时其后不能跟大括号</li><li><code>export default</code>命令本质是输出一个名为<code>default</code>的变量，后面不能跟变量声明语句</li><li><code>export default</code>命令本质是将后面的值赋给名为<code>default</code>的变量，可直接将值写在其后</li><li><code>export default</code>命令和<code>export {}</code>命令可同时存在，对应复合导入</li><li><code>export</code>命令和<code>import</code>命令可出现在模块任何位置，只要处于模块顶层即可，不能处于块级作用域</li><li><code>import()</code>加载模块成功后，此模块会作为一个对象，当作<code>then()</code>的参数，可使用对象解构赋值来获取输出接口</li><li>同时动态加载多个模块时，可使用<code>Promise.all()</code>和<code>import()</code>相结合来实现</li><li><code>import()</code>和结<code>合async/await</code>来书写同步操作的代码</li></ul><p><strong>单例模式：跨模块常量</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 常量跨文件共享</span></span><br><span class="line"><span class="comment">// person.js</span></span><br><span class="line"><span class="keyword">const</span> NAME = <span class="string">"Bruce"</span>;</span><br><span class="line"><span class="keyword">const</span> AGE = <span class="number">25</span>;</span><br><span class="line"><span class="keyword">const</span> SEX = <span class="string">"male"</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; AGE, NAME, SEX &#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// file1.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; AGE &#125; <span class="keyword">from</span> <span class="string">"person"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(AGE);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// file2.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; AGE, NAME, SEX &#125; <span class="keyword">from</span> <span class="string">"person"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(AGE, NAME, SEX);</span><br></pre></td></tr></table></figure><blockquote><p>默认导入互换整体导入</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import Person from &quot;person&quot;;</span><br><span class="line">console.log(Person.AGE);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import * as Person from &quot;person&quot;;</span><br><span class="line">console.log(Person.default.AGE);</span><br></pre></td></tr></table></figure><h3 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h3><ul><li>定义：为各种不同的数据结构提供统一的访问机制</li><li>原理：创建一个指针指向首个成员，按照次序使用<code>next()</code>指向下一个成员，直接到结束位置(数据结构只要部署<code>Iterator</code>接口就可完成遍历操作)</li><li><strong>作用</strong><ul><li>为各种数据结构提供一个统一的简便的访问接口</li><li>使得数据结构成员能够按某种次序排列</li><li><code>ES6</code>创造了新的遍历命令<code>for-of</code>，<code>Iterator</code>接口主要供<code>for-of</code>消费</li></ul></li><li>形式：<code>for-of</code>(自动去寻找<code>Iterator</code>接口)</li><li>数据结构<ul><li>集合：<code>Array</code>、<code>Object</code>、<code>Set</code>、<code>Map</code></li><li>原生具备接口的数据结构：<code>String</code>、<code>Array</code>、<code>Set</code>、<code>Map</code>、<code>TypedArray</code>、<code>Arguments、NodeList</code></li></ul></li><li>部署：默认部署在<code>Symbol.iterator</code>(具备此属性被认为可遍历的<code>iterable</code>)</li><li>遍历器对象<ul><li><code>next()</code>：下一步操作，返回<code>{ done, value }</code>(必须部署)</li><li><code>return()</code>：<code>for-of</code>提前退出调用，返回<code>{ done: true }</code></li><li><code>throw()</code>：不使用，配合<code>Generator</code>函数使用</li></ul></li></ul><p><strong>ForOf循环</strong></p><ul><li>定义：调用<code>Iterator</code>接口产生遍历器对象(<code>for-of</code>内部调用数据结构的<code>Symbol.iterator()</code>)</li><li>遍历字符串：<code>for-in</code>获取索引，<code>for-of</code>获取值(可识别32位UTF-16字符)</li><li>遍历数组：<code>for-in</code>获取索引，<code>for-of</code>获取值</li><li>遍历对象：<code>for-in</code>获取键，<code>for-of</code>需自行部署</li><li>遍历<code>Set</code>：<code>for-of</code>获取值 =&gt; <code>for (const v of set)</code></li><li>遍历<code>Map</code>：<code>for-of</code>获取键值对 =&gt;  <code>for (const [k, v] of map)</code></li><li>遍历类数组：包含<code>length</code>的对象、<code>Arguments</code>对象、<code>NodeList</code>对象(无<code>Iterator</code>接口的类数组可用<code>Array.from()</code>转换)</li><li>计算生成数据结构：<code>Array</code>、<code>Set</code>、<code>Map</code><ul><li><code>keys()</code>：返回遍历器对象，遍历所有的键</li><li><code>values()</code>：返回遍历器对象，遍历所有的值</li><li><code>entries()</code>：返回遍历器对象，遍历所有的键值对</li></ul></li><li><strong>与for-in区别</strong><ul><li>有着同<code>for-in</code>一样的简洁语法，但没有<code>for-in</code>那些缺点、</li><li>不同于<code>forEach()</code>，它可与<code>break</code>、<code>continue</code>和<code>return</code>配合使用</li><li>提供遍历所有数据结构的统一操作接口</li></ul></li></ul><p><strong>应用场景</strong></p><ul><li>改写具有<code>Iterator</code>接口的数据结构的<code>Symbol.iterator</code></li><li>解构赋值：对<code>Set</code>进行结构</li><li>扩展运算符：将部署Iterator接口的数据结构转为数组</li><li><code>yield*</code>：<code>yield*</code>后跟一个可遍历的数据结构，会调用其遍历器接口</li><li>接受数组作为参数的函数：<code>for-of</code>、<code>Array.from()</code>、<code>new Set()</code>、<code>new WeakSet()</code>、<code>new Map()</code>、<code>new WeakMap()</code>、<code>Promise.all()</code>、<code>Promise.race()</code></li></ul><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><ul><li>定义：包含异步操作结果的对象</li><li>状态<ul><li>进行中：<code>pending</code></li><li>已成功：<code>resolved</code></li><li>已失败：<code>rejected</code></li></ul></li><li>特点<ul><li>对象的状态不受外界影响</li><li>一旦状态改变就不会再变，任何时候都可得到这个结果</li></ul></li><li>声明：<code>new Promise((resolve, reject) =&gt; {})</code></li><li>出参<ul><li><code>resolve</code>：将状态从未完成变为成功，在异步操作成功时调用，并将异步操作的结果作为参数传递出去</li><li><code>reject</code>：将状态从未完成变为失败，在异步操作失败时调用，并将异步操作的错误作为参数传递出去</li></ul></li><li>方法<ul><li><code>then()</code>：分别指定<code>resolved</code>状态和<code>rejected</code>状态的回调函数<ul><li>第一参数：状态变为<code>resolved</code>时调用</li><li>第二参数：状态变为<code>rejected</code>时调用(可选)</li></ul></li><li><code>catch()</code>：指定发生错误时的回调函数</li><li><code>Promise.all()</code>：将多个实例包装成一个新实例，返回全部实例状态变更后的结果数组(齐变更再返回)<ul><li>入参：具有<code>Iterator</code>接口的数据结构</li><li>成功：只有全部实例状态变成<code>resolved</code>，最终状态才会变成<code>resolved</code></li><li>失败：其中一个实例状态变成<code>rejected</code>，最终状态就会变成<code>rejected</code></li></ul></li><li><code>Promise.race()</code>：将多个实例包装成一个新实例，返回全部实例状态优先变更后的结果(先变更先返回)</li><li><code>Promise.resolve()</code>：将对象转为Promise对象(等价于<code>new Promise(resolve =&gt; resolve())</code>)<ul><li><code>Promise</code>实例：原封不动地返回入参</li><li><code>Thenable</code>对象：将此对象转为<code>Promise</code>对象并返回(<code>Thenable</code>为包含<code>then()</code>的对象，执行<code>then()</code>相当于执行此对象的<code>then()</code>)</li><li>不具有<code>then()</code>的对象：将此对象转为<code>Promise</code>对象并返回，状态为<code>resolved</code></li><li>不带参数：返回<code>Promise</code>对象，状态为<code>resolved</code></li></ul></li><li><code>Promise.reject()</code>：将对象转为状态为<code>rejected</code>的<code>Promise</code>对象(等价于<code>new Promise((resolve, reject) =&gt; reject())</code>)</li></ul></li></ul><p><strong>应用场景</strong></p><ul><li>加载图片</li><li><code>AJAX</code>转<code>Promise</code>对象</li></ul><p><strong>重点难点</strong></p><ul><li>只有异步操作的结果可决定当前状态是哪一种，其他操作都无法改变这个状态</li><li>状态改变只有两种可能：从<code>pending</code>变为<code>resolved</code>、从<code>pending</code>变为<code>rejected</code></li><li>一旦新建<code>Promise</code>对象就会立即执行，无法中途取消</li><li>不设置回调函数，内部抛错不会反应到外部</li><li>当处于<code>pending</code>时，无法得知目前进展到哪一个阶段</li><li>实例状态变为<code>resolved</code>或<code>rejected</code>时，会触发<code>then()</code>绑定的回调函数</li><li><code>resolve()</code>和<code>reject()</code>的执行总是晚于本轮循环的同步任务</li><li><code>then()</code>返回新实例，其后可再调用另一个<code>then()</code></li><li><code>then()</code>运行中抛出错误会被<code>catch()</code>捕获</li><li><code>reject()</code>的作用等同于抛出错误</li><li>实例状态已变成<code>resolved</code>时，再抛出错误是无效的，不会被捕获，等于没有抛出</li><li>实例状态的错误具有冒泡性质，会一直向后传递直到被捕获为止，错误总是会被下一个<code>catch()</code>捕获</li><li>不要在<code>then()</code>里定义<code>rejected</code>状态的回调函数(不使用其第二参数)</li><li>建议使用<code>catch()</code>捕获错误，不要使用<code>then()</code>第二个参数捕获</li><li>没有使用<code>catch()</code>捕获错误，实例抛错不会传递到外层代码，即不会有任何反应</li><li>作为参数的实例定义了<code>catch()</code>，一旦被<code>rejected</code>并不会触发<code>Promise.all()</code>的<code>catch()</code></li><li><code>Promise.reject()</code>的参数会原封不动地作为<code>rejected</code>的理由，变成后续方法的参数</li></ul><h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><ul><li>定义：封装多个内部状态的异步编程解决方案</li><li>形式：调用<code>Generator</code>函数(该函数不执行)返回指向内部状态的指针对象(不是运行结果)</li><li>声明：<code>function* Func() {}</code></li><li>方法<ul><li><code>next()</code>：使指针移向下一个状态，返回<code>{ done, value }</code>(入参会被当作上一个<code>yield</code>命令表达式的返回值)</li><li><code>return()</code>：返回指定值且终结遍历<code>Generator</code>函数，返回<code>{ done: true, value: 入参 }</code></li><li><code>throw()</code>：在<code>Generator</code>函数体外抛出错误，在<code>Generator</code>函数体内捕获错误，返回自定义的<code>new Errow()</code></li></ul></li><li><code>yield</code>命令：声明内部状态的值(<code>return</code>声明结束返回的值)<ul><li>遇到<code>yield</code>命令就暂停执行后面的操作，并将其后表达式的值作为返回对象的<code>value</code></li><li>下次调用<code>next()</code>时，再继续往下执行直到遇到下一个<code>yield</code>命令</li><li>没有再遇到<code>yield</code>命令就一直运行到<code>Generator</code>函数结束，直到遇到<code>return</code>语句为止并将其后表达式的值作为返回对象的<code>value</code></li><li><code>Generator</code>函数没有<code>return</code>语句则返回对象的<code>value</code>为<code>undefined</code></li></ul></li><li><code>yield*</code>命令：在一个<code>Generator</code>函数里执行另一个<code>Generator</code>函数(后随具有<code>Iterator</code>接口的数据结构)</li><li>遍历：通过<code>for-of</code>自动调用<code>next()</code></li><li>作为对象属性<ul><li>全写：<code>const obj = { method: function*() {} }</code></li><li>简写：<code>const obj = { * method() {} }</code></li></ul></li><li>上下文：执行产生的上下文环境一旦遇到<code>yield</code>命令就会暂时退出堆栈(但并不消失)，所有变量和对象会冻结在当前状态，等到对它执行<code>next()</code>时，这个上下文环境又会重新加入调用栈，冻结的变量和对象恢复执行</li></ul><p><strong>方法异同</strong></p><ul><li><strong>相同点</strong>：<ul><li><code>next()</code>、<code>throw()</code>、<code>return()</code>本质上是同一件事，作用都是让函数恢复执行且使用不同的语句替换yield命令</li></ul></li><li><strong>不同点</strong><ul><li><code>next()</code>：将<code>yield</code>命令替换成一个值</li><li><code>return()</code>：将<code>yield</code>命令替换成一个<code>return</code>语句</li><li><code>throw()</code>：将<code>yield</code>命令替换成一个<code>throw</code>语句</li></ul></li></ul><p><strong>应用场景</strong></p><ul><li>异步操作同步化表达</li><li>控制流管理</li><li>为对象部署<code>Iterator</code>接口：把<code>Generator</code>函数赋值给对象的<code>Symbol.iterator</code>，从而使该对象具有<code>Iterator</code>接口</li><li>作为具有<code>Iterator</code>接口的数据结构</li></ul><p><strong>重点难点</strong></p><ul><li>每次调用<code>next()</code>，指针就从函数头部或上次停下的位置开始执行，直到遇到下一个<code>yield</code>命令或<code>return</code>语句为止</li><li>函数内部可不用<code>yield</code>命令，但会变成单纯的暂缓执行函数(还是需要<code>next()</code>触发)</li><li><code>yield</code>命令是暂停执行的标记，<code>next()</code>是恢复执行的操作</li><li><code>yield</code>命令用在另一个表达式中必须放在圆括号里</li><li><code>yield</code>命令用作函数参数或放在赋值表达式的右边，可不加圆括号</li><li><code>yield</code>命令本身没有返回值，可认为是返回<code>undefined</code></li><li><code>yield</code>命令表达式为惰性求值，等<code>next()</code>执行到此才求值</li><li>函数调用后生成遍历器对象，此对象的<code>Symbol.iterator</code>是此对象本身</li><li>在函数运行的不同阶段，通过<code>next()</code>从外部向内部注入不同的值，从而调整函数行为</li><li>首个<code>next()</code>用来启动遍历器对象，后续才可传递参数</li><li>想首次调用<code>next()</code>时就能输入值，可在函数外面再包一层</li><li>一旦<code>next()</code>返回对象的<code>done</code>为<code>true</code>，<code>for-of</code>遍历会中止且不包含该返回对象</li><li>函数内部部署<code>try-finally</code>且正在执行<code>try</code>，那么<code>return()</code>会导致立刻进入<code>finally</code>，执行完<code>finally</code>以后整个函数才会结束</li><li>函数内部没有部署<code>try-catch</code>，<code>throw()</code>抛错将被外部<code>try-catch</code>捕获</li><li><code>throw()</code>抛错要被内部捕获，前提是必须至少执行过一次<code>next()</code></li><li><code>throw()</code>被捕获以后，会附带执行下一条<code>yield</code>命令</li><li>函数还未开始执行，这时<code>throw()</code>抛错只可能抛出在函数外部</li></ul><blockquote><p>首次next()可传值</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Wrapper</span>(<span class="params">func</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> generator = func(...args);</span><br><span class="line">        generator.next();</span><br><span class="line">        <span class="keyword">return</span> generator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> print = Wrapper(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`First Input: <span class="subst">$&#123;<span class="keyword">yield</span>&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"done"</span>;</span><br><span class="line">&#125;);</span><br><span class="line">print().next(<span class="string">"hello"</span>);</span><br></pre></td></tr></table></figure><h2 id="ES2016"><a href="#ES2016" class="headerlink" title="ES2016"></a>ES2016</h2><p><img src="http://blog.poetries.top/img-repo/2019/11/126.png" alt></p><h3 id="数值扩展-1"><a href="#数值扩展-1" class="headerlink" title="数值扩展"></a>数值扩展</h3><ul><li>指数运算符(<code>**</code>)：数值求幂(相当于<code>Math.pow()</code>)</li></ul><h3 id="数组扩展-1"><a href="#数组扩展-1" class="headerlink" title="数组扩展"></a>数组扩展</h3><ul><li><code>includes()</code>：是否存在指定成员</li></ul><h2 id="ES2017"><a href="#ES2017" class="headerlink" title="ES2017"></a>ES2017</h2><p><img src="http://blog.poetries.top/img-repo/2019/11/127.png" alt></p><p><strong>声明</strong></p><ul><li>共享内存和原子操作：由全局对象<code>SharedArrayBuffer</code>和<code>Atomics</code>实现，将数据存储在一块共享内存空间中，这些数据可在<code>JS</code>主线程和<code>web-worker</code>线程之间共享</li></ul><h3 id="字符串扩展-1"><a href="#字符串扩展-1" class="headerlink" title="字符串扩展"></a>字符串扩展</h3><ul><li><code>padStart()</code>：把指定字符串填充到字符串头部，返回新字符串</li><li><code>padEnd()</code>：把指定字符串填充到字符串尾部，返回新字符串</li></ul><p><strong>对象扩展</strong></p><ul><li><code>Object.getOwnPropertyDescriptors()</code>：返回对象所有自身属性(非继承属性)的描述对象</li><li><code>Object.values()</code>：返回以值组成的数组</li><li><code>Object.entries()</code>：返回以键和值组成的数组</li></ul><h3 id="函数扩展-1"><a href="#函数扩展-1" class="headerlink" title="函数扩展"></a>函数扩展</h3><ul><li>函数参数尾逗号：允许函数最后一个参数有尾逗号</li></ul><p><strong>Async</strong></p><ul><li>定义：使异步函数以同步函数的形式书写(<code>Generator</code>函数语法糖)</li><li>原理：将<code>Generator</code>函数和自动执行器<code>spawn</code>包装在一个函数里</li><li>形式：将<code>Generator</code>函数的<code>*</code>替换成<code>async</code>，将<code>yield</code>替换成<code>await</code></li><li><strong>声明</strong><ul><li>具名函数：<code>async function Func() {}</code></li><li>函数表达式：<code>const func = async function() {}</code></li><li>箭头函数：<code>const func = async() =&gt; {}</code></li><li>对象方法：<code>const obj = { async func() {} }</code></li><li>类方法：<code>class Cla { async Func() {} }</code></li></ul></li><li><strong>await命令</strong>：等待当前<code>Promise</code>对象状态变更完毕<ul><li>正常情况：后面是<code>Promise</code>对象则返回其结果，否则返回对应的值</li><li>后随<code>Thenable</code>对象：将其等同于<code>Promise</code>对象返回其结果</li></ul></li><li><strong>错误处理</strong>：将<code>await</code>命令<code>Promise</code>对象放到<code>try-catch</code>中(可放多个)</li></ul><p><strong>Async对Generator改进</strong></p><ul><li>内置执行器</li><li>更好的语义</li><li>更广的适用性</li><li>返回值是<code>Promise</code>对象</li></ul><p><strong>应用场景</strong></p><ul><li>按顺序完成异步操作</li></ul><p><strong>重点难点</strong></p><ul><li><code>Async</code>函数返回<code>Promise</code>对象，可使用<code>then()</code>添加回调函数</li><li>内部<code>return</code>返回值会成为后续<code>then()</code>的出参</li><li>内部抛出错误会导致返回的<code>Promise</code>对象变为<code>rejected</code>状态，被<code>catch()</code>接收到</li><li>返回的<code>Promise</code>对象必须等到内部所有<code>await</code>命令<code>Promise</code>对象执行完才会发生状态改变，除非遇到<code>return</code>语句或抛出错误</li><li>任何一个<code>await</code>命令<code>Promise</code>对象变为<code>rejected</code>状态，整个<code>Async</code>函数都会中断执行</li><li>希望即使前一个异步操作失败也不要中断后面的异步操作<ul><li>将<code>await</code>命令<code>Promise</code>对象放到<code>try-catch</code>中</li><li><code>await</code>命令<code>Promise</code>对象跟一个<code>catch()</code></li></ul></li><li><code>await</code>命令<code>Promise</code>对象可能变为<code>rejected</code>状态，最好把其放到<code>try-catch</code>中</li><li>多个<code>await</code>命令<code>Promise</code>对象若不存在继发关系，最好让它们同时触发</li><li><code>await</code>命令只能用在<code>Async</code>函数之中，否则会报错</li><li>数组使用<code>forEach()</code>执行<code>async/await</code>会失效，可使用<code>for-of</code>和P<code>romise.all()</code>代替</li><li>可保留运行堆栈，函数上下文随着<code>Async</code>函数的执行而存在，执行完成就消失</li></ul><h2 id="ES2018"><a href="#ES2018" class="headerlink" title="ES2018"></a>ES2018</h2><p><img src="http://blog.poetries.top/img-repo/2019/11/128.png" alt></p><h3 id="字符串扩展-2"><a href="#字符串扩展-2" class="headerlink" title="字符串扩展"></a>字符串扩展</h3><ul><li>放松对标签模板里字符串转义的限制：遇到不合法的字符串转义返回<code>undefined</code>，并且从<code>raw</code>上可获取原字符串</li></ul><p><strong>对象扩展</strong></p><ul><li>扩展运算符(<code>...</code>)：转换对象为用逗号分隔的参数序列(<code>{ ...obj }</code>，相当于<code>rest/spread</code>参数的逆运算)</li></ul><blockquote><p>扩展应用</p></blockquote><ul><li>克隆对象：<code>const obj = { __proto__: Object.getPrototypeOf(obj1), ...obj1 }</code></li><li>合并对象：<code>const obj = { ...obj1, ...obj2 }</code></li><li>转换字符串为对象：<code>{ ...&quot;hello&quot; }</code></li><li>转换数组为对象：<code>{ ...[1, 2] }</code></li><li>与对象解构赋值结合：<code>const { x, ...rest/spread } = { x: 1, y: 2, z: 3 }</code>(不能复制继承自原型对象的属性)</li><li>修改现有对象部分属性：<code>const obj = { x: 1, ...{ x: 2 } }</code></li></ul><h3 id="正则扩展-1"><a href="#正则扩展-1" class="headerlink" title="正则扩展"></a>正则扩展</h3><ul><li><code>s</code>修饰符：<code>dotAll</code>模式修饰符，使<code>.</code>匹配任意单个字符(<code>dotAll</code>模式)</li><li><code>dotAll</code>：是否设置<code>s</code>修饰符</li><li>后行断言：<code>x</code>只有在<code>y</code>后才匹配</li><li>后行否定断言：<code>x</code>只有不在<code>y</code>后才匹配</li><li><strong><code>Unicode</code>属性转义</strong>：匹配符合<code>Unicode</code>某种属性的所有字符<ul><li>正向匹配：<code>\p{PropRule}</code></li><li>反向匹配：<code>\P{PropRule}</code></li><li>限制：<code>\p{...}</code>和<code>\P{...}</code>只对<code>Unicode</code>字符有效，使用时需加上u修饰符</li></ul></li><li><strong>具名组匹配</strong>：为每组匹配指定名字(<code>?&lt;GroupName&gt;</code>)<ul><li>形式：<code>str.exec().groups.GroupName</code></li><li>解构赋值替换<ul><li>声明：<code>const time = &quot;2017-09-11&quot;、const regexp = /(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})/u</code></li><li>匹配：<code>time.replace(regexp, &quot;$&lt;day&gt;/$&lt;month&gt;/$&lt;year&gt;&quot;)</code></li></ul></li></ul></li></ul><h3 id="Promise-1"><a href="#Promise-1" class="headerlink" title="Promise"></a>Promise</h3><ul><li><code>finally()</code>：指定不管最后状态如何都会执行的回调函数</li></ul><h3 id="Async"><a href="#Async" class="headerlink" title="Async"></a>Async</h3><ul><li>异步迭代器(<code>for-await-of</code>)：，循环等待每个<code>Promise</code>对象变为<code>resolved</code>状态才进入下一步</li></ul><h2 id="ES2019"><a href="#ES2019" class="headerlink" title="ES2019"></a>ES2019</h2><p><img src="http://blog.poetries.top/img-repo/2019/11/129.png" alt></p><h3 id="字符串扩展-3"><a href="#字符串扩展-3" class="headerlink" title="字符串扩展"></a>字符串扩展</h3><ul><li>直接输入<code>U+2028</code>和<code>U+2029</code>：字符串可直接输入行分隔符和段分隔符</li><li><code>JSON.stringify()</code>改造：可返回不符合<code>UTF-8</code>标准的字符串</li><li><code>trimStart()</code>：消除字符串头部空格，返回新字符串</li><li><code>trimEnd()</code>：消除字符串尾部空格，返回新字符串</li></ul><h3 id="对象扩展-1"><a href="#对象扩展-1" class="headerlink" title="对象扩展"></a>对象扩展</h3><ul><li><code>Object.fromEntries()</code>：返回以键和值组成的对象(<code>Object.entries()</code>的逆操作)</li></ul><h3 id="数组扩展-2"><a href="#数组扩展-2" class="headerlink" title="数组扩展"></a>数组扩展</h3><ul><li><code>flat()</code>：扁平化数组，返回新数组</li><li><code>flatMap()</code>：映射且扁平化数组，返回新数组(只能展开一层数组)</li></ul><h3 id="函数扩展-2"><a href="#函数扩展-2" class="headerlink" title="函数扩展"></a>函数扩展</h3><ul><li><code>toString()</code>改造：返回函数原始代码(与编码一致)</li><li><code>catch()</code>参数可省略：<code>catch()</code>中的参数可省略</li></ul><h3 id="Symbol-1"><a href="#Symbol-1" class="headerlink" title="Symbol"></a>Symbol</h3><ul><li><code>description</code>：返回<code>Symbol</code>值的描述</li></ul><h2 id="ES提案"><a href="#ES提案" class="headerlink" title="ES提案"></a>ES提案</h2><p><img src="http://blog.poetries.top/img-repo/2019/11/130.png" alt></p><h3 id="声明-1"><a href="#声明-1" class="headerlink" title="声明"></a>声明</h3><ul><li><code>globalThis</code>对象：作为顶层对象，指向全局环境下的<code>this</code></li><li><code>do</code>表达式：封装块级作用域的操作，返回内部最后执行表达式的值(<code>do{}</code>)</li><li><code>throw</code>表达式：直接使用<code>throw new Error()</code>，无需<code>()</code>或<code>{}</code>包括</li><li><code>!#</code>命令：指定脚本执行器(写在文件首行)</li></ul><h3 id="数值扩展-2"><a href="#数值扩展-2" class="headerlink" title="数值扩展"></a>数值扩展</h3><ul><li>数值分隔符(<code>_</code>)：使用<code>_</code>作为千分位分隔符(增加数值的可读性)</li><li><code>BigInt()</code>：创建任何位数的整数(新增的数据类型，使用<code>n</code>结尾)</li></ul><h3 id="对象扩展-2"><a href="#对象扩展-2" class="headerlink" title="对象扩展"></a>对象扩展</h3><ul><li>链判断操作符(<code>?.</code>)：是否存在对象属性(不存在返回<code>undefined</code>且不再往下执行)</li><li>空判断操作符(<code>??</code>)：是否值为<code>undefined</code>或<code>null</code>，是则使用默认值</li></ul><h3 id="函数扩展-3"><a href="#函数扩展-3" class="headerlink" title="函数扩展"></a>函数扩展</h3><ul><li>函数部分执行：复用函数功能(<code>?</code>表示单个参数占位符，<code>...</code>表示多个参数占位符)</li><li>管道操作符(<code>|&gt;</code>)：把左边表达式的值传入右边的函数进行求值(<code>f(x) =&gt; x |&gt; f</code>)</li><li>绑定运算符(<code>::</code>)：函数绑定(左边是对象右边是函数，取代<code>bind</code>、<code>apply</code>、<code>call</code>调用)<ul><li><code>bind：bar.bind(foo)</code> =&gt; <code>foo::bar</code></li><li><code>apply</code>：bar.apply(foo, arguments)<code>=&gt;</code>foo::bar(…arguments)`</li></ul></li></ul><h3 id="Proxy-1"><a href="#Proxy-1" class="headerlink" title="Proxy"></a>Proxy</h3><ul><li><code>Promise.try()</code>：不想区分是否同步异步函数，包装函数为实例，使用<code>then()</code>指定下一步流程，使用<code>catch()</code>捕获错误</li></ul><h3 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a>Realm</h3><ul><li>定义：提供沙箱功能，允许隔离代码，防止被隔离的代码拿到全局对象</li><li>声明：<code>new Realm().global</code></li></ul><h3 id="Class-1"><a href="#Class-1" class="headerlink" title="Class"></a>Class</h3><ul><li>静态属性：使用<code>static</code>定义属性，该属性不会被实例继承，只能通过类来调用</li><li>私有属性：使用<code>#</code>定义属性，该属性只能在类内部访问</li><li>私有方法：使用<code>#</code>定义方法，该方法只能在类内部访问</li><li>装饰器：使用<code>@</code>注释或修改类和类方法</li></ul><h3 id="Module-1"><a href="#Module-1" class="headerlink" title="Module"></a>Module</h3><ul><li><strong>import()：动态导入(返回Promise)</strong><ul><li>背景：<code>import</code>命令被JS引擎静态分析，先于模块内的其他语句执行，无法取代<code>require()</code>的动态加载功能，提案建议引入<code>import()</code>来代替<code>require()</code></li><li>位置：可在任何地方使用</li><li>区别：<code>require()</code>是同步加载，<code>import()</code>是异步加载</li><li>场景：按需加载、条件加载、模块路径动态化</li></ul></li><li><strong>import.meta：返回脚本元信息</strong></li></ul><h3 id="Async-1"><a href="#Async-1" class="headerlink" title="Async"></a>Async</h3><ul><li>顶层<code>Await</code>：允许在模块的顶层独立使用<code>await</code>命令(借用<code>await</code>解决模块异步加载的问题)</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;http://blog.poetries.top/img-repo/2019/11/123.png&quot; alt&gt;&lt;/p&gt;
&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="JavaScript" scheme="http://blog.poetries.top/tags/JavaScript/"/>
    
      <category term="ES6" scheme="http://blog.poetries.top/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>初探Cordova结合Vue</title>
    <link href="http://blog.poetries.top/2019/10/07/cordova-for-vue/"/>
    <id>http://blog.poetries.top/2019/10/07/cordova-for-vue/</id>
    <published>2019-10-07T10:10:24.000Z</published>
    <updated>2019-12-16T02:35:06.807Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><blockquote><p>我们可以使用<code>cordova</code>来打包现有的<code>vue</code>、<code>react</code>、<code>angular</code>应用为<code>app</code>，可以借助<code>cordova</code>来调用手机设备的原生能力，比如拍照、扫码、定位等</p></blockquote><h3 id="1-1-ionic3"><a href="#1-1-ionic3" class="headerlink" title="1.1 ionic3"></a>1.1 ionic3</h3><blockquote><p><code>ionic3=cordova+angular+ionicUI</code>（Ionic UI组件+ Javascript API+Ionic Native） </p></blockquote><ul><li><strong>优点</strong>：它提供了漂亮的<code>UI</code>组件库、强大的<code>JS APi</code>以及基于调用原生的的<code>Native APi</code>,可以让我们快速开发跨平台的混合<code>APP</code>以及移动<code>web</code>页面。（推荐*）</li><li><strong>缺点</strong>：<code>angular</code> <code>react</code> <code>vue</code>开发的移动端应用要打包成<code>app</code>的时候得重新再学习<code>ionic</code></li></ul><h3 id="1-2-cordova"><a href="#1-2-cordova" class="headerlink" title="1.2 cordova"></a>1.2 cordova</h3><blockquote><p><code>cordova</code>: 可以把<code>html css js</code>写的代码打包成<code>app</code>，还可以让<code>js</code>调用原生的<code>api</code>。<code>cordova</code>非常成熟、插件也非常多、扩展性也强，10年的历史</p></blockquote><p><strong>打包App有几个方案</strong></p><ul><li><code>ionic</code></li><li><code>reactNative</code></li><li><code>weex</code></li><li><code>flutter</code></li><li><code>cordova+vue</code></li><li><code>cordova+react</code></li><li><code>cordova+angular</code></li></ul><h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><h3 id="2-1-用cordova开发android-应用"><a href="#2-1-用cordova开发android-应用" class="headerlink" title="2.1 用cordova开发android 应用"></a>2.1 用cordova开发android 应用</h3><ul><li>安装jdk 、配置jdk</li><li>安装android studio</li><li>安装nodejs</li><li>安装cordova</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 淘宝源安装</span></span><br><span class="line">npm install -g cordova --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cnpm install -g cordova</span><br></pre></td></tr></table></figure><p><strong>创建项目cordova create 项目名称</strong></p><blockquote><p><code>cordova create 项目名</code>  <code>com.公司名.项目名  类名</code> （建议）</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova create cordovademo02  com.baidu.cordova  Cordovademo</span><br></pre></td></tr></table></figure><blockquote><p>创建项目的时候注意包名称：发布上线打包的时候用到包名称，注意</p></blockquote><blockquote><p>修改应用包名名称参考：<a href="http://www.ionic.wang/article-index-id-91.html" target="_blank" rel="noopener">http://www.ionic.wang/article-index-id-91.html</a></p></blockquote><p><strong>修改应用包名名称：</strong></p><ul><li>修改<code>config.xml</code>里面的包名称</li><li>修改完成以后重新执行<code>cordova platform add android</code></li></ul><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/2.png" alt></p><blockquote><p>cd 到项目里面 <code>cd cordovademo02</code></p></blockquote><ul><li>把<code>android</code>的平台添加到项目里面 <code>cordova platform add android</code></li><li>把项目导入到 <code>android studio</code> 进行运行调试  （或者运行   <code>cordova  run  android</code>）   注意可能遇到的问题参考（安装遇到问题图文解决方案文件夹</li></ul><blockquote><p>导入<code>platform</code>下的<code>Android</code>文件</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/3.png" alt></p><p><strong>导入android studio可能遇到的错误解决方法</strong></p><ol><li>导入后提示：<code>Android Studio Error:Connection timed out: connect</code></li></ol><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/4.png" alt></p><blockquote><p>解决方案参考：<a href="https://blog.csdn.net/u013020000/article/details/73159754" target="_blank" rel="noopener">https://blog.csdn.net/u013020000/article/details/73159754</a></p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/5.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/cordova/6.png" alt></p><ol start="2"><li>遇到错误 <code>failed  to  find with hash string  &#39;android-26&#39;</code></li></ol><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/7.png" alt></p><blockquote><p>解决方案点击 图上蓝色链接进行安装</p></blockquote><ol start="3"><li><code>Gradle build</code> 没有反应如</li></ol><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/8.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/cordova/9.png" alt></p><blockquote><p>解决方案 ：点击<code>build</code>见图箭头。如果有下载内容 耐心等待 （30分钟-2小时）</p></blockquote><ol start="4"><li>提示 <code>please configure Android SDK</code></li></ol><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/10.png" alt></p><blockquote><p>解决方案：点击蓝色 <code>configure</code>，然后选择对应的sdk   （前提是sdk已经安装）</p></blockquote><ol start="5"><li>真机调试,手机连上没有反应</li></ol><ul><li>关闭或者卸载自己电脑上面的360手机助手或者其他连手机的软件</li><li>安装你手机对应的<code>sdk</code></li></ul><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/11.png" alt></p><blockquote><p>建议 <code>android 5-到android8</code> sdk都安装 （安装sdk  ： Tools-&gt;SDK Manager）</p></blockquote><ul><li>点击右上角对应箭头按钮配置</li></ul><blockquote><p>查看当前连接上的手机</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/12.png" alt></p><ul><li>手机必须开启调试模式（百度搜 xxx手机开启调试模式）</li><li>手机拔下来重启<code>android studio</code>，重新插入手机重试</li><li>百度搜（<code>android studio</code> 连不上手机…）</li></ul><p><strong>运行项目 ：注意</strong></p><ul><li><code>android</code>手机要连上电脑，并且 <code>android</code>手机必须开启调试模式</li><li><code>android studio</code> 必须得安装手机对应的<code>sdk</code></li><li>关闭360手机助手、xxx手机助手</li><li>修改项目:  运行<code>cordova prepare</code></li></ul><h3 id="2-2-iOS平台搭建cordova环境"><a href="#2-2-iOS平台搭建cordova环境" class="headerlink" title="2.2 iOS平台搭建cordova环境"></a>2.2 iOS平台搭建cordova环境</h3><ul><li>安装<code>nodejs</code> 安装<code>xcode</code></li><li>安装<code>cordova</code>    </li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cnpm install -g cordova</span><br></pre></td></tr></table></figure><ol><li>创建项目</li></ol><blockquote><p><code>cordova create 项目名  com.公司名.项目名  类名</code> （建议）</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova create cordovademo02  com.baidu.cordova  Cordovademo</span><br></pre></td></tr></table></figure><ul><li><ol start="2"><li><code>cd  cordovademo02</code></li></ol></li><li>3.把ios的平台添加到项目里面  <code>cordova platform add ios</code></li><li><ol start="4"><li>用xcode打开项目运行</li></ol></li></ul><h2 id="三、cordova插件的使用"><a href="#三、cordova插件的使用" class="headerlink" title="三、cordova插件的使用"></a>三、cordova插件的使用</h2><blockquote><p>cordova插件拍照插件 、定位插件、文件上传插件 以及vconsole开启真机（手机）调试模式</p></blockquote><p><strong>cordova安装插件</strong></p><blockquote><p>如果我们要在自己的<code>html</code>里面调用手机原生的功能（拍照、扫描二维码、获取地理位置…）,借助<code>cordova</code>的插件</p></blockquote><blockquote><p><code>cordova</code> 官网：<a href="https://cordova.apache.org/" target="_blank" rel="noopener">https://cordova.apache.org/</a></p></blockquote><p><strong>如何使用插件：</strong></p><ul><li>安装插件 <code>cordova plugin  add  插件名称</code></li><li>复制文档使用</li></ul><p><strong>查看已经安装的插件：</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova plugin list</span><br></pre></td></tr></table></figure><p><strong>卸载插件：</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova plugin rm  cordova-plugin-network-information</span><br></pre></td></tr></table></figure><blockquote><p>插件使用</p></blockquote><p><strong>1. 设备插件的使用</strong></p><blockquote><p><a href="https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-device/index.html" target="_blank" rel="noopener">https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-device/index.html</a></p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 安装 看文档使用</span></span><br><span class="line">cordova plugin add cordova-plugin-device</span><br></pre></td></tr></table></figure><p><strong>2. 使用网络相关的插件</strong></p><blockquote><p><a href="https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-network-information/index.html" target="_blank" rel="noopener">https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-network-information/index.html</a></p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装 看文档使用</span></span><br><span class="line">cordova plugin add cordova-plugin-network-information</span><br></pre></td></tr></table></figure><p><strong>3. 定位插件</strong></p><blockquote><p><a href="https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-geolocation/index.html" target="_blank" rel="noopener">https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-geolocation/index.html</a></p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova plugin add cordova-plugin-geolocation</span><br></pre></td></tr></table></figure><ul><li>注意改代码以后要运行：<code>cordova prepare</code></li><li>注意：要引入<code>cordova.js</code></li><li>注意：项目里面不要有中文文件夹、不要有<code>zip</code>包 、不要有中文文件</li></ul><p><strong>4. 拍照插件</strong></p><blockquote><p><a href="https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-camera/index.html" target="_blank" rel="noopener">https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-camera/index.html</a></p></blockquote><blockquote><p>注意：<code>ios</code>拍照完成以后调用 <code>navigator.camera.cleanup(onSuccess, onFail)</code></p></blockquote><p><strong>5. 文件上传 或者下载</strong></p><ul><li>文件插件: <a href="https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-file/index.html" target="_blank" rel="noopener">https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-file/index.html</a></li><li>文件传输插件：<a href="https://www.npmjs.com/package/cordova-plugin-file-transfer" target="_blank" rel="noopener">https://www.npmjs.com/package/cordova-plugin-file-transfer</a></li></ul><h2 id="四、cordova结合vue"><a href="#四、cordova结合vue" class="headerlink" title="四、cordova结合vue"></a>四、cordova结合vue</h2><h3 id="4-1-cordova结合vue开发跨平台app"><a href="#4-1-cordova结合vue开发跨平台app" class="headerlink" title="4.1 cordova结合vue开发跨平台app"></a>4.1 cordova结合vue开发跨平台app</h3><blockquote><p><code>cordova</code>结合<code>vue</code>开发跨平台混合app之<code>Cordova</code>打包Vue项目</p></blockquote><p><strong>cordova打包vue项目：</strong></p><ul><li><code>cordova</code>: 可以把<code>html css js</code>写的代码打包成<code>app</code>，还可以让<code>js</code>调用原生的 <code>api</code></li></ul><blockquote><p><code>cordova+vue</code>、<code>cordova+react</code> 、<code>cordova+angular</code> 、 <code>cordova+jquery</code></p></blockquote><p><strong>创建vue项目的时候有两种方式：</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vue init webpack 项目名称</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vue init webpack-simple  项目名称</span><br></pre></td></tr></table></figure><blockquote><p>正式发布<code>vue</code>的项目：（把<code>vue</code>项目打包成浏览器能解析的代码）</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm run build <span class="comment"># 把vue打包成浏览器能解析的代码</span></span><br></pre></td></tr></table></figure><p><strong>把vue项目用cordova打包成app：</strong></p><ul><li><code>npm run build</code> （注意：图片目录的路径）</li><li>把<code>vue</code>打包后的静态资源复制到<code>cordova</code>项目里面</li><li>运行 <code>cordova prepare</code></li></ul><p><strong>注意：</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vue init webpack-simple  <span class="comment">#项目名称</span></span><br></pre></td></tr></table></figure><ul><li>修改：<code>webpack.config.js</code> 里面  <code>publicPath</code></li><li>把<code>publicPath: &#39;/dist/&#39;</code>    改为  <code>publicPath: &#39;dist/&#39;</code></li><li>修改<code>index</code>里面引入<code>dist</code>的路径,去掉前面的<code>/</code> (重要)</li></ul><p><strong>vue init webpack 项目名称</strong></p><ul><li>修改：<code>config/index.js</code> 把 <code>assetsPublicPath: &#39;/&#39;</code>,    </li><li>修改成 <code>assetsPublicPath: &#39;./&#39;</code></li></ul><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/14.png" alt></p><blockquote><p>ios下打开效果。这样很方便打包原有的项目为app</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/cordova/16.png" alt></p><h3 id="4-2-vue调用cordova插件"><a href="#4-2-vue调用cordova插件" class="headerlink" title="4.2 vue调用cordova插件"></a>4.2 vue调用cordova插件</h3><blockquote><p><code>cordova</code>打包<code>vue</code>项目并在<code>Vue</code>中调用原生的<code>api</code>：</p></blockquote><p><strong>使用vue-cordova 插件（不推荐使用）</strong></p><blockquote><p><a href="https://github.com/kartsims/vue-cordova" target="_blank" rel="noopener">https://github.com/kartsims/vue-cordova</a>        </p></blockquote><ol><li><code>vue</code>项目安装 <code>npm install --save vue-cordova</code></li><li>在 <code>main.js</code> 引入插件并<code>use</code>插件</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import VueCordova from &apos;vue-cordova&apos;</span><br><span class="line">Vue.use(VueCordova)</span><br></pre></td></tr></table></figure><ol start="3"><li>调用插件注意在对应的组件需要引入 </li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Vue = <span class="built_in">require</span>(<span class="string">'vue'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.cordova.camera.getPicture(<span class="function">(<span class="params">imageURI</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.alert(<span class="string">'Photo URI : '</span> + imageURI)</span><br><span class="line">&#125;, (message) =&gt; &#123;</span><br><span class="line">    <span class="built_in">window</span>.alert(<span class="string">'FAILED : '</span> + message)</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    quality: <span class="number">50</span>,</span><br><span class="line">    destinationType: Vue.cordova.camera.DestinationType.FILE_URI</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>注意需要在<code>vue</code>项目 <code>index.html</code>引入 <code>cordova.js</code></li></ol><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"cordova.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>index.html</code> 引入<code>cordova.js</code>  并定义全局变量让<code>vue</code>组件里面直接使用<code>cordova</code>插件(推荐的使用方法）</p></blockquote><ul><li>在vue <code>index.html</code>引入<code>cordova.js</code> （注意顺序<code>cordova.js</code>放在<code>build.js</code>上面）</li><li>直接可以在组件里面使用<code>cordova</code>的<code>api</code>（注意<code>cordova</code>里面要安装<code>api</code>的插件）</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一、前言&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;我们可以使用&lt;code&gt;cordova&lt;/code&gt;来打包现有的&lt;code&gt;vue&lt;/code&gt;、
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="Cordova" scheme="http://blog.poetries.top/tags/Cordova/"/>
    
      <category term="Vue" scheme="http://blog.poetries.top/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Ionic之调用原生模块相机</title>
    <link href="http://blog.poetries.top/2019/10/07/ionic-ios-camera/"/>
    <id>http://blog.poetries.top/2019/10/07/ionic-ios-camera/</id>
    <published>2019-10-07T06:10:24.000Z</published>
    <updated>2019-12-16T02:35:06.827Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、Ionic-Native-的使用"><a href="#一、Ionic-Native-的使用" class="headerlink" title="一、Ionic Native 的使用"></a>一、Ionic Native 的使用</h2><blockquote><p>Ionic 在 <code>cordova</code> 的基础上面又进行了封装，可以让我们更方便的在 ionic 中使用 <code>cordova</code> 插件</p></blockquote><p><strong>使用方法:</strong></p><ol><li>找到对应的Api:</li></ol><blockquote><p><a href="https://ionicframework.com/docs/native/device/" target="_blank" rel="noopener">https://ionicframework.com/docs/native/device/</a></p></blockquote><ol start="2"><li>安装相关的设备插件</li></ol><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ionic cordova plugin add cordova-plugin-device </span><br><span class="line"></span><br><span class="line">npm install @ionic-native/device --save</span><br></pre></td></tr></table></figure><blockquote><ul><li>注意: 安装 <code>ionic</code> 调用原生 api 的插件的时候在模块加上 <code>--save</code> </li><li>注意: <code>ios</code> 安装插件的时候命令签名加 <code>sudo</code></li></ul></blockquote><ol start="3"><li>在<code>app.module.ts</code>中引入注册相应模块</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; Device &#125; from &apos;@ionic-native/device/ngx&apos;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">providers: [</span><br><span class="line">    StatusBar,</span><br><span class="line">    SplashScreen,</span><br><span class="line">    Device,</span><br><span class="line">    &#123; </span><br><span class="line">        provide: RouteReuseStrategy, <span class="attr">useClass</span>: IonicRouteStrategy </span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ol start="4"><li>在用到的页面引入看文档使用</li></ol><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Device &#125; <span class="keyword">from</span> <span class="string">'@ionic-native/device/ngx'</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>(private device: Device) &#123; &#125;</span><br><span class="line">...</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Device UUID is: '</span> + <span class="keyword">this</span>.device.uuid);</span><br></pre></td></tr></table></figure><h2 id="二、Cordova-常用命令以及插件的使用"><a href="#二、Cordova-常用命令以及插件的使用" class="headerlink" title="二、Cordova 常用命令以及插件的使用"></a>二、Cordova 常用命令以及插件的使用</h2><p><strong>1、增加平台</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova platform add android</span><br><span class="line">cordova platform add ios</span><br><span class="line"></span><br><span class="line">ionic cordova platform add android</span><br><span class="line">ionic cordova platform add ios</span><br></pre></td></tr></table></figure><p><strong>2、移除平台</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova platform rm android </span><br><span class="line">cordova platform rm ios</span><br><span class="line"></span><br><span class="line">ionic cordova platform rm android </span><br><span class="line">ionic cordova platform rm ios</span><br></pre></td></tr></table></figure><p><strong>3、修改代码后让代码生效</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova prepare</span><br><span class="line"></span><br><span class="line">ionic cordova prepare</span><br></pre></td></tr></table></figure><p><strong>4、真机运行</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova run android</span><br><span class="line"></span><br><span class="line">ionic cordova run android</span><br></pre></td></tr></table></figure><p><strong>5、安装插件–建议看 ionic 官方文档</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//设备 API</span></span><br><span class="line">cordova plugin add org.apache.cordova.device</span><br><span class="line"></span><br><span class="line"><span class="comment">//网络(事件)</span></span><br><span class="line">cordova plugin add org.apache.cordova.network-information </span><br><span class="line"></span><br><span class="line"><span class="comment">//电池(事件)</span></span><br><span class="line">cordova plugin </span><br><span class="line">add org.apache.cordova.battery-status </span><br><span class="line"></span><br><span class="line"><span class="comment">//加速器</span></span><br><span class="line">cordova plugin add org.apache.cordova.device-motion </span><br><span class="line"></span><br><span class="line"><span class="comment">//罗盘</span></span><br><span class="line">cordova plugin add org.apache.cordova.device-orientation </span><br><span class="line"></span><br><span class="line"><span class="comment">//定位</span></span><br><span class="line">cordova plugin add org.apache.cordova.geolocation</span><br><span class="line"></span><br><span class="line"><span class="comment">//摄像头</span></span><br><span class="line">cordova plugin add org.apache.cordova.camera</span><br><span class="line"></span><br><span class="line"><span class="comment">//媒体文件处理</span></span><br><span class="line">cordova plugin add org.apache.cordova.media-capture cordova plugin add org.apache.cordova.media</span><br><span class="line"></span><br><span class="line"><span class="comment">//文件访问</span></span><br><span class="line">cordova plugin add org.apache.cordova.file</span><br><span class="line"></span><br><span class="line"><span class="comment">//文件传输</span></span><br><span class="line">cordova plugin add org.apache.cordova.file-transfer</span><br><span class="line"></span><br><span class="line"><span class="comment">//对话框</span></span><br><span class="line">cordova plugin add org.apache.cordova.dialogs</span><br><span class="line"></span><br><span class="line"><span class="comment">//震动</span></span><br><span class="line">cordova plugin add org.apache.cordova.vibration</span><br><span class="line"></span><br><span class="line"><span class="comment">//联系人</span></span><br><span class="line">cordova plugin add org.apache.cordova.contacts</span><br><span class="line"></span><br><span class="line"><span class="comment">//全球化</span></span><br><span class="line">cordova plugin add org.apache.cordova.globalization </span><br><span class="line"></span><br><span class="line"><span class="comment">//闪屏</span></span><br><span class="line">cordova plugin add org.apache.cordova.splashscreen </span><br><span class="line"></span><br><span class="line"><span class="comment">//打开新的浏览器窗口</span></span><br><span class="line">cordova plugin add org.apache.cordova.inappbrowser </span><br><span class="line"></span><br><span class="line"><span class="comment">//调试控制台</span></span><br><span class="line">cordova plugin add org.apache.cordova.console</span><br></pre></td></tr></table></figure><p><strong>6、查看已经安装的插件</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova plugin list</span><br></pre></td></tr></table></figure><p><strong>7、删除插件</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cordova plugin rm org.apache.cordova.console</span><br><span class="line"></span><br><span class="line">cordova plugin rm org.apache.cordova.geolocation</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、Ionic-Native-的使用&quot;&gt;&lt;a href=&quot;#一、Ionic-Native-的使用&quot; class=&quot;headerlink&quot; title=&quot;一、Ionic Native 的使用&quot;&gt;&lt;/a&gt;一、Ionic Native 的使用&lt;/h2&gt;&lt;blockquo
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="Ionic" scheme="http://blog.poetries.top/tags/Ionic/"/>
    
      <category term="Angular" scheme="http://blog.poetries.top/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>Ionic之iOS打包流程</title>
    <link href="http://blog.poetries.top/2019/10/07/Ionic-ios-build/"/>
    <id>http://blog.poetries.top/2019/10/07/Ionic-ios-build/</id>
    <published>2019-10-07T00:10:24.000Z</published>
    <updated>2019-12-16T02:35:06.803Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、模拟器运行iOS项目"><a href="#一、模拟器运行iOS项目" class="headerlink" title="一、模拟器运行iOS项目"></a>一、模拟器运行iOS项目</h2><p><strong>安装 Ionic Cordova</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo cnpm install -g cordova ionic</span><br></pre></td></tr></table></figure><p><strong>Ionic 创建浏览器运行的项目</strong></p><ul><li>创建项目: <code>sudo ionic start myApp tabs</code></li><li>cd 到刚才创建的项目</li><li><code>sudo ionic serve</code> 浏览器运行项目</li></ul><p><strong>Ionic 借助 cordova 创建 ios 手机上可以安装的应用</strong></p><ul><li>创建项目: <code>sudo ionic start myApp tabs</code></li><li>cd 到刚才创建的项目</li><li><code>sudo ionic cordova platform add ios</code> 把 ios 环境添加到我们的项目</li><li><code>sudo yarn install</code></li><li>修改代码后运行 <code>sudo ionic build --prod</code>(打包) 以及 <code>sudo ionic cordova prepare</code> (这个是拷贝<code>www</code>目录资源到ios工程下)。必须运行，否则调试会卡死</li></ul><p><strong>可能遇到的错误以及解决方案</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/1.png" alt></p><ul><li>使用软件中的提供的翻墙工具重试，如果不行继续看第二步骤</li><li>手机开启热点，让电脑连接手机用手机的网络下载</li></ul><p><strong>找到对应目录下面的文件双击用 Xcode 打开</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/2.png" alt></p><blockquote><p>注意:xcode 用最新的版本</p></blockquote><p><strong>如果双击遇到权限问题如下</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/3.png" alt></p><blockquote><p>可以用命令修改权限，cd 到要修改权限的目录执行下面命令</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo chmod -R 777 *</span><br></pre></td></tr></table></figure><p><strong>在 xcode 中选择对应模拟器运行</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/4.png" alt></p><blockquote><p>注意:调整模拟器大小只需要拉动模拟器边缘即可</p></blockquote><h2 id="二、真机调试"><a href="#二、真机调试" class="headerlink" title="二、真机调试"></a>二、真机调试</h2><h3 id="2-1-真机调试之前的准备工作"><a href="#2-1-真机调试之前的准备工作" class="headerlink" title="2.1 真机调试之前的准备工作"></a>2.1 真机调试之前的准备工作</h3><ul><li>你得有苹果开发者账号个人($99)、公司($99)、企业($299)账号均可</li><li>能上网的苹果电脑 macos(苹果虚拟机也可以)、Xcode、iOS 设备(iPhone、ipad 均 可)</li></ul><h3 id="2-2-开发者中心配置调试设备的-uuid"><a href="#2-2-开发者中心配置调试设备的-uuid" class="headerlink" title="2.2 开发者中心配置调试设备的 uuid"></a>2.2 开发者中心配置调试设备的 uuid</h3><p><strong>1. 获取iPhone手机的uuid，手机连接电脑，打开iTunes软件，点击序列号字母处</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/5.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/6.png" alt></p><p><strong>2. 配置iPhone手机的uuid，打开平台开发者中心进行配置</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/7.png" alt></p><h3 id="2-3-xcode-自动管理证书文件"><a href="#2-3-xcode-自动管理证书文件" class="headerlink" title="2.3 xcode 自动管理证书文件"></a>2.3 xcode 自动管理证书文件</h3><p><strong>手动创建证书文件参考下面地址:</strong></p><blockquote><p><a href="https://jingyan.baidu.com/article/d3b74d640735c71f77e609f0.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/d3b74d640735c71f77e609f0.html</a></p></blockquote><blockquote><p>现在用 xcode 开发项目我们可以自动适配我们的证书，选择自动化配置证书意味着你不会 在证书设置和编译的时候浪费更多的时间,并且你可以更好的设置适合你的 Xcode</p></blockquote><p><strong>1、点击 xcode 选择 Preference，如下图</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/8.png" alt></p><p><strong>2、弹出下面界面输入自己的账户名和密码</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/9.png" alt></p><p><strong>3、选择对应的项目 选择 General-&gt;勾选自动管理签名-&gt;设置 Team 开发者账户-&gt;选择开发的 设备</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/10.png" alt></p><p><strong>4、设置所有工程的 Build settings 为 Automatic (默认可以不用管)</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/11.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/12.png" alt></p><h3 id="2-4-真机调试"><a href="#2-4-真机调试" class="headerlink" title="2.4 真机调试"></a>2.4 真机调试</h3><ul><li>连上手机，然后在手机上面选择信任此电脑</li><li>选择调试设备为自己的手机</li></ul><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/13.png" alt></p><ul><li>点击运行</li></ul><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/14.png" alt></p><ul><li>点击允许</li></ul><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/15.png" alt></p><blockquote><p>注意：每次修改代码后，都需要重新执行 <code>sudo ionic build --prod</code> 以及 <code>sudo ionic cordova prepare</code>。这样比较麻烦，建议在浏览器端调试好了在调试ios、安卓端的</p></blockquote><h2 id="三、创建测试包ipa"><a href="#三、创建测试包ipa" class="headerlink" title="三、创建测试包ipa"></a>三、创建测试包ipa</h2><ul><li>进入苹果开发者中心，配置需要测试项目的人员手机的 <code>uuid</code> 以及调试设备的 <code>uuid</code></li><li>配置应用包名称</li><li>打包测试证书需要连接 <code>iphone</code> 手机，不然 Archive 会是灰色的</li><li>选择 <code>product – Archive</code> 进行打包–(具体步骤如下)</li></ul><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/20.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/21.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/22.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/23.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/24.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/25.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/26.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/27.png" alt></p><p><strong>可能遇到的错误</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/28.png" alt></p><blockquote><p>如果是 code sign 相关的错误</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/29.png" alt></p><h2 id="四、发布到-appstore"><a href="#四、发布到-appstore" class="headerlink" title="四、发布到 appstore"></a>四、发布到 appstore</h2><p><strong>1. 需要登录到苹果开发者中心<code>Itunes connect</code> 创建应用</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/37.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/38.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/39.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/40.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/41.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/42.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/43.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/44.png" alt></p><p><strong>2. 配置好开发者证书以打包正式包</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/30.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/31.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/45.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/46.png" alt></p><blockquote><p>这里选择直接导出上传</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/47.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/48.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/49.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/50.png" alt></p><p><strong>3. 使用 <code>Application Loader</code> 把本地的正式包发布到 <code>App Store Connect</code>，也可以使用 Xcode把应用发布到 App Store</strong></p><blockquote><p>打开application loader上传应用包</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/33.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/34.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/51.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/52.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/53.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/54.png" alt></p><blockquote><p>应用升级需要修改版本号，然后build上传<br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/55.png" alt></p></blockquote><blockquote><p>然后在这里可以有多个版本，选择一个提交审核即可</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/56.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/57.png" alt></p><blockquote><p>保存之后提交审核</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/58.png" alt></p><p><strong>登录 Application Loader 报错</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/35.png" alt></p><blockquote><p>登录:<a href="https://appleid.apple.com/account/manage" target="_blank" rel="noopener">https://appleid.apple.com/account/manage</a></p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/36.png" alt></p><blockquote><p>然后用生成的密码作为登录密码</p></blockquote><p><strong>4. 在xcode中上传应用</strong></p><blockquote><p>修改版本后，选择achieve</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/59.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/60.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/61.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/62.png" alt></p><blockquote><p>然后可以在开发者中心选择上传的版本</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/63.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/64.png" alt></p><blockquote><p>提交审核后一般七个工作日左右</p></blockquote><h2 id="五、打包上传前，在-info-plist-添加权限"><a href="#五、打包上传前，在-info-plist-添加权限" class="headerlink" title="五、打包上传前，在 info.plist 添加权限"></a>五、打包上传前，在 info.plist 添加权限</h2><blockquote><p>Xcode 打包上传 app store 提示 Missing info.plist key NSPhotoLibraryUsageDescription 错误</p></blockquote><p><strong>Info.plist 添加权限</strong></p><blockquote><p>项目调用了摄像机，需要配置一下权限</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/65.png" alt></p><blockquote><p>为了保护隐私，最终用户必须明确的允许应用程序访问提醒信号、照片、位置、联系人、和日历数 据。为了说服用户接受，它有助于解释应用程序可以怎样使用这类数据，并且说明访问他的原因。给 位于 <code>Info.plist</code> 文件顶层的以下键分配字符串值。当 iOS 提示用户有关特定资源的权限时，他将显示 这些字符串，作为他的标准对话框的一部分。</p></blockquote><ul><li>相册 <code>NSPhotoLibraryUsageDescription</code></li><li>相机  <code>NSCameraUsageDescription</code></li><li>麦克风 <code>NSMicrophoneUsageDescription</code></li><li>位置 <code>NSLocationUsageDescription</code></li><li>在使用期间访问位置 <code>NSLocationWhenInUseUsageDescription</code></li><li>始终访问位置 <code>NSLocationAlwaysUsageDescription</code></li><li>日历 <code>NSCalendarsUsageDescription</code></li><li>提醒事项 <code>NSRemindersUsageDescription</code></li><li>运动与健身 <code>NSMotionUsageDescription</code></li><li>健康更新 <code>NSHealthUpdateUsageDescription</code></li><li>健康分享 <code>NSHealthShareUsageDescription</code></li><li>蓝牙 <code>NSBluetoothPeripheralUsageDescription</code></li><li>媒体资料库 <code>NSAppleMusicUsageDescription</code></li></ul><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/66.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、模拟器运行iOS项目&quot;&gt;&lt;a href=&quot;#一、模拟器运行iOS项目&quot; class=&quot;headerlink&quot; title=&quot;一、模拟器运行iOS项目&quot;&gt;&lt;/a&gt;一、模拟器运行iOS项目&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;安装 Ionic Cordova&lt;/stro
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="Ionic" scheme="http://blog.poetries.top/tags/Ionic/"/>
    
      <category term="Angular" scheme="http://blog.poetries.top/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>Vue核心梳理</title>
    <link href="http://blog.poetries.top/2019/10/06/vue-review/"/>
    <id>http://blog.poetries.top/2019/10/06/vue-review/</id>
    <published>2019-10-06T10:10:32.000Z</published>
    <updated>2019-12-16T02:35:06.847Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、组件的核心概念-属性props几种写法"><a href="#一、组件的核心概念-属性props几种写法" class="headerlink" title="一、组件的核心概念-属性props几种写法"></a>一、组件的核心概念-属性props几种写法</h2><blockquote><p>我们的开发都是围绕着<code>options</code>来的</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/1.png" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/2.png" alt></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    name: &#123;&#123; name &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    type: &#123;&#123; type &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    list: &#123;&#123; list &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    isVisible: &#123;&#123; isVisible &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"handleClick"</span>&gt;</span>change type<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">"PropsDemo"</span>,</span></span><br><span class="line"><span class="javascript">  <span class="comment">// inheritAttrs: false,</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// 这种写法不利于后期维护</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// props: ['name', 'type', 'list', 'isVisible'],</span></span></span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    name: <span class="built_in">String</span>,</span></span><br><span class="line">    type: &#123;</span><br><span class="line"><span class="javascript">      validator: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 这个值必须匹配下列字符串中的一个</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> [<span class="string">"success"</span>, <span class="string">"warning"</span>, <span class="string">"danger"</span>].includes(value);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    list: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Array</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 对象或数组默认值必须从一个工厂函数获取</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> []</span></span><br><span class="line">    &#125;,</span><br><span class="line">    isVisible: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Boolean</span>,</span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>: <span class="literal">false</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">    onChange: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Function</span>,</span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick() &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 不要这么做、不要这么做、不要这么做</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// this.type = "warning";</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 可以，还可以更好</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.onChange(<span class="keyword">this</span>.type === <span class="string">"success"</span> ? <span class="string">"warning"</span> : <span class="string">"success"</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// 用法</span><br><span class="line">&lt;Props</span><br><span class="line">  name=&quot;Hello Vue！&quot; // 原生属性</span><br><span class="line">  :type=&quot;type&quot;</span><br><span class="line">  :is-visible=&quot;false&quot;</span><br><span class="line">  :on-change=&quot;handlePropChange&quot;</span><br><span class="line">  title=&quot;属性Demo&quot; // 原生属性</span><br><span class="line">  class=&quot;test1&quot; // 原生属性</span><br><span class="line">  :class=&quot;[&apos;test2&apos;]&quot;</span><br><span class="line">  :style=&quot;&#123; marginTop: &apos;20px&apos; &#125;&quot;</span><br><span class="line">  style=&quot;margin-top: 10px&quot; // 原生属性</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><h2 id="二、组件的核心概念-事件"><a href="#二、组件的核心概念-事件" class="headerlink" title="二、组件的核心概念-事件"></a>二、组件的核心概念-事件</h2><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/3.png" alt></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    name: &#123;&#123; name || "--" &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">:value</span>=<span class="string">"name"</span> @<span class="attr">change</span>=<span class="string">"handleChange"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">"handleDivClick"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"handleClick"</span>&gt;</span>重置成功<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.stop</span>=<span class="string">"handleClick"</span>&gt;</span>重置失败<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">"EventDemo"</span>,</span></span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    name: <span class="built_in">String</span></span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleChange(e) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$emit(<span class="string">"change"</span>, e.target.value);</span></span><br><span class="line">    &#125;,</span><br><span class="line">    handleDivClick() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$emit(<span class="string">"change"</span>, <span class="string">""</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line">    handleClick(e) &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 都会失败</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//e.stopPropagation();</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="三、组件的核心概念-插槽"><a href="#三、组件的核心概念-插槽" class="headerlink" title="三、组件的核心概念-插槽"></a>三、组件的核心概念-插槽</h2><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/4.png" alt></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">a-tab-pane</span> <span class="attr">key</span>=<span class="string">"slot"</span> <span class="attr">tab</span>=<span class="string">"插槽"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>2.6 新语法<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SlotDemo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>default slot<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>title slot1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>title slot2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:item</span>=<span class="string">"props"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>item slot-scope &#123;&#123; props &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">SlotDemo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>老语法<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SlotDemo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>default slot<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">slot</span>=<span class="string">"title"</span>&gt;</span>title slot1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">slot</span>=<span class="string">"title"</span>&gt;</span>title slot2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">slot</span>=<span class="string">"item"</span> <span class="attr">slot-scope</span>=<span class="string">"props"</span>&gt;</span>item slot-scope &#123;&#123; props &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">SlotDemo</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a-tab-pane</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Slot <span class="keyword">from</span> <span class="string">"./Slot"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    SlotDemo: Slot</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="javascript">  data: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      name: <span class="string">""</span>,</span></span><br><span class="line"><span class="javascript">      type: <span class="string">"success"</span>,</span></span><br><span class="line"><span class="javascript">      bigPropsName: <span class="string">"Hello world!"</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Slot.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"title"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"item"</span> <span class="attr">v-bind</span>=<span class="string">"&#123; value: 'vue' &#125;"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">"SlotDemo"</span></span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/5.png" alt></p><p><strong>大属性例子</strong></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--子组件 bigProps.vue--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123; name &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"handleChange"</span>&gt;</span>change name<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &#123;&#123; slotDefault &#125;&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">VNodes</span> <span class="attr">:vnodes</span>=<span class="string">"slotDefault"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">VNodes</span> <span class="attr">:vnodes</span>=<span class="string">"slotTitle"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">VNodes</span> <span class="attr">:vnodes</span>=<span class="string">"slotScopeItem(&#123; value: 'vue' &#125;)"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">"BigProps"</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    VNodes: &#123;</span><br><span class="line"><span class="javascript">      functional: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">      render: <span class="function">(<span class="params">h, ctx</span>) =&gt;</span> ctx.props.vnodes</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    name: <span class="built_in">String</span>,</span></span><br><span class="line">    onChange: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Function</span>,</span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    slotDefault: <span class="built_in">Array</span>,</span></span><br><span class="line"><span class="javascript">    slotTitle: <span class="built_in">Array</span>,</span></span><br><span class="line">    slotScopeItem: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Function</span>,</span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleChange() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.onChange(<span class="string">"Hello vue!"</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--父组件调用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a-tab-pane</span> <span class="attr">key</span>=<span class="string">"bigProps"</span> <span class="attr">tab</span>=<span class="string">"大属性"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">BigProps</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:name</span>=<span class="string">"bigPropsName"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:on-change</span>=<span class="string">"handleBigPropChange"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:slot-default</span>=<span class="string">"getDefault()"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:slot-title</span>=<span class="string">"getTitle()"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:slot-scope-item</span>=<span class="string">"getItem"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a-tab-pane</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="四、双向绑定和单项数据流并不冲突"><a href="#四、双向绑定和单项数据流并不冲突" class="headerlink" title="四、双向绑定和单项数据流并不冲突"></a>四、双向绑定和单项数据流并不冲突</h2><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/6.png" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/7.png" alt></p><h2 id="五、如何触发组件的更新"><a href="#五、如何触发组件的更新" class="headerlink" title="五、如何触发组件的更新"></a>五、如何触发组件的更新</h2><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/8.png" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/9.png" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/11.png" alt></p><h2 id="六、合理应用计算属性和监听器"><a href="#六、合理应用计算属性和监听器" class="headerlink" title="六、合理应用计算属性和监听器"></a>六、合理应用计算属性和监听器</h2><h3 id="6-1-计算属性Computed"><a href="#6-1-计算属性Computed" class="headerlink" title="6.1 计算属性Computed"></a>6.1 计算属性Computed</h3><ul><li>减少模板中的计算逻辑</li><li>数据缓存</li><li>依赖固定的数据类型（响应式数据）</li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Reversed message1: "&#123;&#123; reversedMessage1 &#125;&#125;"<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Reversed message2: "&#123;&#123; reversedMessage2() &#125;&#125;"<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; now &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"() =&gt; $forceUpdate()"</span>&gt;</span>forceUpdate<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"message"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      message: <span class="string">"hello vue"</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line"><span class="javascript">    <span class="comment">// 计算属性的 getter</span></span></span><br><span class="line"><span class="javascript">    reversedMessage1: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"执行reversedMessage1"</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="keyword">this</span>.message</span></span><br><span class="line"><span class="javascript">        .split(<span class="string">""</span>)</span></span><br><span class="line">        .reverse()</span><br><span class="line"><span class="javascript">        .join(<span class="string">""</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    now: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">Date</span>.now();</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    reversedMessage2: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"执行reversedMessage2"</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="keyword">this</span>.message</span></span><br><span class="line"><span class="javascript">        .split(<span class="string">""</span>)</span></span><br><span class="line">        .reverse()</span><br><span class="line"><span class="javascript">        .join(<span class="string">""</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-2-监听watcher"><a href="#6-2-监听watcher" class="headerlink" title="6.2 监听watcher"></a>6.2 监听watcher</h3><ul><li>更加灵活通用</li><li><code>watcher</code>可以执行任何逻辑，包括函数节流、ajax异步获取数据</li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123; $data &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"() =&gt; (a += 1)"</span>&gt;</span>a+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      a: 1,</span><br><span class="line">      b: &#123; c: 2, d: 3 &#125;,</span><br><span class="line">      e: &#123;</span><br><span class="line">        f: &#123;</span><br><span class="line">          g: 4</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      h: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line"><span class="javascript">    a: <span class="function"><span class="keyword">function</span>(<span class="params">val, oldVal</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.b.c += <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"new: %s, old: %s"</span>, val, oldVal);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="string">"b.c"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">val, oldVal</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.b.d += <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"new: %s, old: %s"</span>, val, oldVal);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="string">"b.d"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">val, oldVal</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.e.f.g += <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"new: %s, old: %s"</span>, val, oldVal);</span></span><br><span class="line">    &#125;,</span><br><span class="line">    e: &#123;</span><br><span class="line"><span class="javascript">      handler: <span class="function"><span class="keyword">function</span>(<span class="params">val, oldVal</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.h.push(<span class="string">"😄"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"new: %s, old: %s"</span>, val, oldVal);</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      deep: <span class="literal">true</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">    h(val, oldVal) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"new: %s, old: %s"</span>, val, oldVal);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>watcher中使用节流</strong></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123; fullName &#125;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>firstName: <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"firstName"</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>lastName: <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"lastName"</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      firstName: <span class="string">"Foo"</span>,</span></span><br><span class="line"><span class="javascript">      lastName: <span class="string">"Bar"</span>,</span></span><br><span class="line"><span class="javascript">      fullName: <span class="string">"Foo Bar"</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line"><span class="javascript">    firstName: <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      clearTimeout(<span class="keyword">this</span>.firstTimeout);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.firstTimeout = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.fullName = val + <span class="string">" "</span> + <span class="keyword">this</span>.lastName;</span></span><br><span class="line">      &#125;, 500);</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    lastName: <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      clearTimeout(<span class="keyword">this</span>.lastTimeout);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.lastTimeout = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.fullName = <span class="keyword">this</span>.firstName + <span class="string">" "</span> + val;</span></span><br><span class="line">      &#125;, 500);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-3-computed-vs-watcher"><a href="#6-3-computed-vs-watcher" class="headerlink" title="6.3 computed vs watcher"></a>6.3 computed vs watcher</h3><ul><li><code>computed</code> 能做的，<code>watcher</code> 都可以做，反之不行</li><li>能用computed的尽量使用<code>computed</code></li></ul><h2 id="七、生命周期的应用场景和函数式组件"><a href="#七、生命周期的应用场景和函数式组件" class="headerlink" title="七、生命周期的应用场景和函数式组件"></a>七、生命周期的应用场景和函数式组件</h2><h3 id="7-1-生命周期"><a href="#7-1-生命周期" class="headerlink" title="7.1 生命周期"></a>7.1 生命周期</h3><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/12.png" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/13.png" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/14.png" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/15.png" alt></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123; log("render") &#125;&#125;</span><br><span class="line">    &#123;&#123; now &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"start = !start"</span>&gt;</span>&#123;&#123; start ? "停止" : "开始" &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">"moment"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"data"</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>.moment = moment;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>.log = <span class="built_in">window</span>.console.log;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      now: moment(<span class="keyword">new</span> <span class="built_in">Date</span>()).format(<span class="string">"YYYY-MM-DD HH:mm:ss"</span>),</span></span><br><span class="line"><span class="javascript">      start: <span class="literal">false</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    start() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.startClock();</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeCreate() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"beforeCreate"</span>);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"created"</span>);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  beforeMount() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"beforeMount"</span>);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"mounted"</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>.startClock();</span></span><br><span class="line">  &#125;,</span><br><span class="line">  beforeUpdate() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"beforeUpdate"</span>);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  updated() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"updated"</span>);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  beforeDestroy() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"beforeDestroy"</span>);</span></span><br><span class="line"><span class="javascript">    clearInterval(<span class="keyword">this</span>.clockInterval);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  destroyed() &#123;</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"destroyed"</span>);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    startClock() &#123;</span><br><span class="line"><span class="javascript">      clearInterval(<span class="keyword">this</span>.clockInterval);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="keyword">this</span>.start) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.clockInterval = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.now = moment(<span class="keyword">new</span> <span class="built_in">Date</span>()).format(<span class="string">"YYYY-MM-DD HH:mm:ss"</span>);</span></span><br><span class="line">        &#125;, 1000);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>打印顺序 <code>beforeCreate - data - created - beforeMount - render - mounted</code></p></blockquote><h3 id="7-2-函数式组件"><a href="#7-2-函数式组件" class="headerlink" title="7.2 函数式组件"></a>7.2 函数式组件</h3><ul><li><code>functional：true</code></li><li>无状态、无实例、没有<code>this</code>上下文、没有生命周期</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// TempVar.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  functional: <span class="literal">true</span>,</span><br><span class="line">  render: <span class="function">(<span class="params">h, ctx</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ctx.scopedSlots.default &amp;&amp; ctx.scopedSlots.default(ctx.props || &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// Functional.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">functional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123; props &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// 使用</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a-tabs</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-tab-pane</span> <span class="attr">key</span>=<span class="string">"Functional"</span> <span class="attr">tab</span>=<span class="string">"函数式组件"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Functional</span> <span class="attr">:name</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TempVar</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:var1</span>=<span class="string">"`hello $&#123;name&#125;`"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:var2</span>=<span class="string">"destroyClock ? 'hello vue' : 'hello world'"</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot</span>=<span class="string">"&#123; var1, var2 &#125;"</span>&gt;</span></span><br><span class="line">            &#123;&#123; var1 &#125;&#125;</span><br><span class="line">            &#123;&#123; var2 &#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">TempVar</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">a-tab-pane</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a-tabs</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Functional <span class="keyword">from</span> <span class="string">"./Functional"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> TempVar <span class="keyword">from</span> <span class="string">"./TempVar"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    Functional,</span><br><span class="line">    TempVar</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      destroyClock: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      name: <span class="string">"vue"</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="八、Vue指令"><a href="#八、Vue指令" class="headerlink" title="八、Vue指令"></a>八、Vue指令</h2><h3 id="8-1-内置指令"><a href="#8-1-内置指令" class="headerlink" title="8.1 内置指令"></a>8.1 内置指令</h3><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/16.png" alt></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>v-text<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-text</span>=<span class="string">"'hello vue'"</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>v-html<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">"'&lt;span style=<span class="symbol">&amp;quot;</span>color: red<span class="symbol">&amp;quot;</span>&gt;hello vue&lt;/span&gt;'"</span>&gt;</span></span><br><span class="line">      hello world</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>v-show<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">"show"</span>&gt;</span>hello vue<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"show = !show"</span>&gt;</span>change show<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>v-if v-esle-if v-else<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"number === 1"</span>&gt;</span>hello vue &#123;&#123; number &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">"number === 2"</span>&gt;</span>hello world &#123;&#123; number &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span>hello geektime &#123;&#123; number &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>v-for v-bind<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"num in [1, 2, 3]"</span> <span class="attr">v-bind:key</span>=<span class="string">"num"</span>&gt;</span>hello vue &#123;&#123; num &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>v-on<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">"number = number + 1"</span>&gt;</span>number++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>v-model<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"message"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>v-pre<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-pre</span>&gt;</span>&#123;&#123; this will not be compiled &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>v-once<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-once</span>&gt;</span></span><br><span class="line">      &#123;&#123; number &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>.log = <span class="built_in">window</span>.console.log;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      show: <span class="literal">true</span>,</span></span><br><span class="line">      number: 1,</span><br><span class="line"><span class="javascript">      message: <span class="string">"hello"</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="8-2-自定义指令"><a href="#8-2-自定义指令" class="headerlink" title="8.2 自定义指令"></a>8.2 自定义指令</h3><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/17.png" alt></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"show = !show"</span>&gt;</span></span><br><span class="line">      销毁</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-if</span>=<span class="string">"show"</span> <span class="attr">v-append-text</span>=<span class="string">"`hello $&#123;number&#125;`"</span> @<span class="attr">click</span>=<span class="string">"number++"</span>&gt;</span></span><br><span class="line">      按钮</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  directives: &#123;</span><br><span class="line">    appendText: &#123;</span><br><span class="line">      bind() &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"bind"</span>);</span></span><br><span class="line">      &#125;,</span><br><span class="line">      inserted(el, binding) &#123;</span><br><span class="line"><span class="javascript">        el.appendChild(<span class="built_in">document</span>.createTextNode(binding.value));</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"inserted"</span>, el, binding);</span></span><br><span class="line">      &#125;,</span><br><span class="line">      update() &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"update"</span>);</span></span><br><span class="line">      &#125;,</span><br><span class="line">      componentUpdated(el, binding) &#123;</span><br><span class="line">        el.removeChild(el.childNodes[el.childNodes.length - 1]);</span><br><span class="line"><span class="javascript">        el.appendChild(<span class="built_in">document</span>.createTextNode(binding.value));</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"componentUpdated"</span>);</span></span><br><span class="line">      &#125;,</span><br><span class="line">      unbind() &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"unbind"</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      number: 1,</span><br><span class="line"><span class="javascript">      show: <span class="literal">true</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="九、template和jsx"><a href="#九、template和jsx" class="headerlink" title="九、template和jsx"></a>九、template和jsx</h2><h3 id="9-1-JSX-VS-template"><a href="#9-1-JSX-VS-template" class="headerlink" title="9.1 JSX VS template"></a>9.1 JSX VS template</h3><p><strong>Template</strong></p><ul><li>学习成本低</li><li>大量内置指令简化开发</li><li>组件作用域css</li><li>但灵活性低</li></ul><p><strong>JSX</strong></p><ul><li>总体上很灵活</li></ul><h3 id="9-2-以下是jsx写法"><a href="#9-2-以下是jsx写法" class="headerlink" title="9.2 以下是jsx写法"></a>9.2 以下是jsx写法</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// index.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Props <span class="keyword">from</span> <span class="string">"./Props"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Event <span class="keyword">from</span> <span class="string">"./Event"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Slot <span class="keyword">from</span> <span class="string">"./Slot"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> BigProps <span class="keyword">from</span> <span class="string">"./BigProps"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    Props,</span><br><span class="line">    Event,</span><br><span class="line">    SlotDemo: Slot,</span><br><span class="line">    BigProps</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="javascript">  data: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      name: <span class="string">""</span>,</span></span><br><span class="line"><span class="javascript">      type: <span class="string">"success"</span>,</span></span><br><span class="line"><span class="javascript">      bigPropsName: <span class="string">"Hello world!"</span></span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handlePropChange(val) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.type = val;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    handleEventChange(val) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.name = val;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    handleBigPropChange(val) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.bigPropsName = val;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getDefault() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> [<span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>default slot<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>];</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getTitle() &#123;</span><br><span class="line"><span class="xml">      return [<span class="tag">&lt;<span class="name">p</span>&gt;</span>title slot1<span class="tag">&lt;/<span class="name">p</span>&gt;</span>, <span class="tag">&lt;<span class="name">p</span>&gt;</span>title slot2<span class="tag">&lt;/<span class="name">p</span>&gt;</span>];</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getItem(props) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> [<span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;`item slot-scope $&#123;JSON.stringify(props)&#125;`&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>];</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> &#123;</span></span><br><span class="line">      type,</span><br><span class="line">      handlePropChange,</span><br><span class="line">      name,</span><br><span class="line">      handleEventChange,</span><br><span class="line">      bigPropsName,</span><br><span class="line">      getDefault,</span><br><span class="line">      getTitle,</span><br><span class="line">      getItem,</span><br><span class="line">      handleBigPropChange</span><br><span class="line"><span class="javascript">    &#125; = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> slotDemoProps = &#123;</span></span><br><span class="line">      scopedSlots: &#123;</span><br><span class="line">        item(props) &#123;</span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="string">`item slot-scope <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(props)&#125;</span>`</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      props: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> bigProps = &#123;</span></span><br><span class="line">      props: &#123;</span><br><span class="line">        onChange: handleBigPropChange</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> (</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">a-tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">a-tab-pane</span> <span class="attr">key</span>=<span class="string">"props"</span> <span class="attr">tab</span>=<span class="string">"属性"</span>&gt;</span></span></span><br><span class="line">            &lt;Props</span><br><span class="line"><span class="javascript">              name=<span class="string">"Hello Vue！"</span></span></span><br><span class="line">              type=&#123;type&#125;</span><br><span class="line"><span class="javascript">              isVisible=&#123;<span class="literal">false</span>&#125;</span></span><br><span class="line">              &#123;...&#123; props: &#123; onChange: handlePropChange &#125; &#125;&#125;</span><br><span class="line"><span class="javascript">              title=<span class="string">"属性Demo"</span></span></span><br><span class="line"><span class="javascript">              <span class="class"><span class="keyword">class</span></span>=<span class="string">"test1"</span></span></span><br><span class="line"><span class="javascript">              <span class="class"><span class="keyword">class</span></span>=&#123;[<span class="string">"test1"</span>, <span class="string">"test2"</span>]&#125;</span></span><br><span class="line"><span class="javascript">              style=&#123;&#123; <span class="attr">marginTop</span>: <span class="string">"10px"</span> &#125;&#125;</span></span><br><span class="line">            /&gt;</span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">a-tab-pane</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">a-tab-pane</span> <span class="attr">key</span>=<span class="string">"event"</span> <span class="attr">tab</span>=<span class="string">"事件"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Event</span> <span class="attr">name</span>=<span class="string">&#123;name&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleEventChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">a-tab-pane</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">a-tab-pane</span> <span class="attr">key</span>=<span class="string">"slot"</span> <span class="attr">tab</span>=<span class="string">"插槽"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">SlotDemo</span> &#123;<span class="attr">...slotDemoProps</span>&#125;&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">p</span>&gt;</span>default slot<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">p</span> <span class="attr">slot</span>=<span class="string">"title"</span>&gt;</span>title slot1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">p</span> <span class="attr">slot</span>=<span class="string">"title"</span>&gt;</span>title slot2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">SlotDemo</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">a-tab-pane</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">a-tab-pane</span> <span class="attr">key</span>=<span class="string">"bigProps"</span> <span class="attr">tab</span>=<span class="string">"大属性"</span>&gt;</span></span></span><br><span class="line">            &lt;BigProps</span><br><span class="line">              name=&#123;bigPropsName&#125;</span><br><span class="line">              &#123;...bigProps&#125;</span><br><span class="line">              slotDefault=&#123;getDefault()&#125;</span><br><span class="line">              slotTitle=&#123;getTitle()&#125;</span><br><span class="line">              slotScopeItem=&#123;getItem&#125;</span><br><span class="line">            /&gt;</span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">a-tab-pane</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">a-tabs</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// bigProps</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">"BigProps"</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    VNodes: &#123;</span><br><span class="line"><span class="javascript">      functional: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">      render: <span class="function">(<span class="params">h, ctx</span>) =&gt;</span> ctx.props.vnodes</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    name: <span class="built_in">String</span>,</span></span><br><span class="line">    onChange: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Function</span>,</span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    slotDefault: <span class="built_in">Array</span>,</span></span><br><span class="line"><span class="javascript">    slotTitle: <span class="built_in">Array</span>,</span></span><br><span class="line">    slotScopeItem: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Function</span>,</span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleChange() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.onChange(<span class="string">"Hello vue!"</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> &#123; name, handleChange, slotDefault, slotTitle, slotScopeItem &#125; = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> (</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line">        &#123;name&#125;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleChange&#125;</span>&gt;</span>change name<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line">        &#123;slotDefault&#125;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line">        &#123;slotTitle&#125;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="javascript">        &#123;slotScopeItem(&#123; <span class="attr">value</span>: <span class="string">"vue"</span> &#125;)&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// Events.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">"EventDemo"</span>,</span></span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    name: <span class="built_in">String</span></span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleChange(e) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$emit(<span class="string">"change"</span>, e.target.value);</span></span><br><span class="line">    &#125;,</span><br><span class="line">    handleDivClick() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$emit(<span class="string">"change"</span>, <span class="string">""</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line">    handleClick(e, stop) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"stop"</span>, stop);</span></span><br><span class="line">      if (stop) &#123;</span><br><span class="line">        e.stopPropagation();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> &#123; name, handleChange, handleDivClick, handleClick &#125; = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> (</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="javascript">        name: &#123;name || <span class="string">"--"</span>&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;name&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;handleDivClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>重置成功<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> handleClick(e, true)&#125;&gt;重置失败<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// Props.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">"PropsDemo"</span>,</span></span><br><span class="line"><span class="javascript">  <span class="comment">// inheritAttrs: false,</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// props: ['name', 'type', 'list', 'isVisible'],</span></span></span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    name: <span class="built_in">String</span>,</span></span><br><span class="line">    type: &#123;</span><br><span class="line"><span class="javascript">      validator: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 这个值必须匹配下列字符串中的一个</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> [<span class="string">"success"</span>, <span class="string">"warning"</span>, <span class="string">"danger"</span>].includes(value);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    list: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Array</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 对象或数组默认值必须从一个工厂函数获取</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> []</span></span><br><span class="line">    &#125;,</span><br><span class="line">    isVisible: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Boolean</span>,</span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>: <span class="literal">false</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">    onChange: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Function</span>,</span></span><br><span class="line"><span class="javascript">      <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick() &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 不要这么做、不要这么做、不要这么做</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//this.type = "warning";</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 可以，还可以更好</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.onChange(<span class="keyword">this</span>.type === <span class="string">"success"</span> ? <span class="string">"warning"</span> : <span class="string">"success"</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> &#123; name, type, list, isVisible, handleClick &#125; = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> (</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line">        name: &#123;name&#125;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line">        type: &#123;type&#125;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line">        list: &#123;list&#125;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line">        isVisible: &#123;isVisible&#125;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>change type<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// Slot</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">"SlotDemo"</span>,</span></span><br><span class="line">  render() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> &#123; $scopedSlots &#125; = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> (</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line">        &#123;$scopedSlots.default()&#125;</span><br><span class="line">        &#123;$scopedSlots.title()&#125;</span><br><span class="line"><span class="javascript">        &#123;$scopedSlots.item(&#123; <span class="attr">value</span>: <span class="string">"vue"</span> &#125;)&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="十、为什么需要vuex"><a href="#十、为什么需要vuex" class="headerlink" title="十、为什么需要vuex"></a>十、为什么需要vuex</h2><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/19.png" alt></p><p><strong>Vuex运行机制</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/20.png" alt></p><p><strong>基本例子</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    increment(state) &#123;</span><br><span class="line">      state.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    increment(&#123;commit&#125;) &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// state.count++ // 不要对state进行更改操作，应该通过commit交给mutations去处理</span></span><br><span class="line">        commit(<span class="string">'increment'</span>)</span><br><span class="line">      &#125;, <span class="number">3000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    doubleCount(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.count * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// App.vue</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    &#123;&#123;count&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    &#123;&#123;$store.getters.doubleCount&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"$store.commit('increment')"</span>&gt;</span>count++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"$store.dispatch('increment')"</span>&gt;</span>count++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">'app'</span>,</span></span><br><span class="line">  computed: &#123;</span><br><span class="line">    count() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.state.count</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="十一、vuex核心概念和底层原理"><a href="#十一、vuex核心概念和底层原理" class="headerlink" title="十一、vuex核心概念和底层原理"></a>十一、vuex核心概念和底层原理</h2><h3 id="11-1-核心概念"><a href="#11-1-核心概念" class="headerlink" title="11.1 核心概念"></a>11.1 核心概念</h3><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/23.png" alt></p><h3 id="11-2-底层原理"><a href="#11-2-底层原理" class="headerlink" title="11.2 底层原理"></a>11.2 底层原理</h3><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/22.png" alt></p><p><strong>简化版本的vuex</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">const</span> Store = <span class="function"><span class="keyword">function</span> <span class="title">Store</span> (<span class="params">options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;state = &#123;&#125;, mutations=&#123;&#125;&#125; = options</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 把state进行响应式和vue写法一样</span></span><br><span class="line">  <span class="keyword">this</span>._vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      $$state: state</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">this</span>._mutations = mutations</span><br><span class="line">&#125;</span><br><span class="line">Store.prototype.commit = <span class="function"><span class="keyword">function</span>(<span class="params">type, payload</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>._mutations[type]) &#123;</span><br><span class="line">    <span class="keyword">this</span>._mutations[type](<span class="keyword">this</span>.state, payload)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(Store.prototype, &#123; </span><br><span class="line">  <span class="comment">// 当我们取值 如 $store.getter.count的时候就会触发这里</span></span><br><span class="line">  state: &#123; </span><br><span class="line">    <span class="keyword">get</span>: function()&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._vm._data.$$state</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;Store&#125;</span><br></pre></td></tr></table></figure><h2 id="十二、vuex最佳实践"><a href="#十二、vuex最佳实践" class="headerlink" title="十二、vuex最佳实践"></a>十二、vuex最佳实践</h2><h3 id="12-1-核心概念"><a href="#12-1-核心概念" class="headerlink" title="12.1 核心概念"></a>12.1 核心概念</h3><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/23.png" alt></p><h3 id="12-2-使用常量代替Mutation事件类型"><a href="#12-2-使用常量代替Mutation事件类型" class="headerlink" title="12.2 使用常量代替Mutation事件类型"></a>12.2 使用常量代替Mutation事件类型</h3><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/24.png" alt></p><h3 id="12-3-命名空间"><a href="#12-3-命名空间" class="headerlink" title="12.3 命名空间"></a>12.3 命名空间</h3><blockquote><p>对所有模块开启命名空间</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/25.png" alt></p><h3 id="12-4-实践例子"><a href="#12-4-实践例子" class="headerlink" title="12.4 实践例子"></a>12.4 实践例子</h3><blockquote><p>DEMO地址 <a href="https://github.com/poetries/vuex-demo" target="_blank" rel="noopener">https://github.com/poetries/vuex-demo</a></p></blockquote><h2 id="十三、vue-router使用场景"><a href="#十三、vue-router使用场景" class="headerlink" title="十三、vue-router使用场景"></a>十三、vue-router使用场景</h2><h3 id="13-1-解决的问题"><a href="#13-1-解决的问题" class="headerlink" title="13.1 解决的问题"></a>13.1 解决的问题</h3><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/26.png" alt></p><h3 id="13-2-使用方式"><a href="#13-2-使用方式" class="headerlink" title="13.2 使用方式"></a>13.2 使用方式</h3><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/27.png" alt></p><h3 id="13-3-例子"><a href="#13-3-例子" class="headerlink" title="13.3 例子"></a>13.3 例子</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'./routes'</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  mode: <span class="string">'history'</span>,</span><br><span class="line">  routes,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// App.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>router demo<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">'app'</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-id">#app</span> &#123;</span></span><br><span class="line">  font-family: 'Avenir', Helvetica, Arial, sans-serif;</span><br><span class="line">  -webkit-font-smoothing: antialiased;</span><br><span class="line">  -moz-osx-font-smoothing: grayscale;</span><br><span class="line">  text-align: center;</span><br><span class="line"><span class="css">  <span class="selector-tag">color</span>: <span class="selector-id">#2c3e50</span>;</span></span><br><span class="line">  margin-top: 60px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// routes.js</span></span><br><span class="line"><span class="keyword">import</span> RouterDemo <span class="keyword">from</span> <span class="string">'./components/RouterDemo'</span></span><br><span class="line"><span class="keyword">import</span> RouterChildrenDemo <span class="keyword">from</span> <span class="string">'./components/RouterChildrenDemo'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/foo'</span>, <span class="attr">component</span>: RouterDemo, <span class="attr">name</span>: <span class="string">'1'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/bar'</span>, <span class="attr">component</span>: RouterDemo, <span class="attr">name</span>: <span class="string">'2'</span> &#125;,</span><br><span class="line">  <span class="comment">// 当 /user/:id 匹配成功，</span></span><br><span class="line">  <span class="comment">// RouterDemo 会被渲染在 App 的 &lt;router-view /&gt; 中</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/user/:id'</span>, </span><br><span class="line">    component: RouterDemo, </span><br><span class="line">    name: <span class="string">'3'</span>,</span><br><span class="line">    props: <span class="literal">true</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 当 /user/:id/profile 匹配成功，</span></span><br><span class="line">        <span class="comment">// RouterChildrenDemo 会被渲染在 RouterDemo 的 &lt;router-view/&gt; 中</span></span><br><span class="line">        path: <span class="string">'profile'</span>,</span><br><span class="line">        component: RouterChildrenDemo,</span><br><span class="line">        name: <span class="string">'3-1'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 当 /user/:id/posts 匹配成功</span></span><br><span class="line">        <span class="comment">// RouterChildrenDemo 会被渲染在 RouterDemo 的 &lt;router-view/&gt; 中</span></span><br><span class="line">        path: <span class="string">'posts'</span>,</span><br><span class="line">        component: RouterChildrenDemo</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/a'</span>, <span class="attr">redirect</span>: <span class="string">'/bar'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'*'</span>, <span class="attr">component</span>: RouterDemo, <span class="attr">name</span>: <span class="string">'404'</span> &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> routes</span><br></pre></td></tr></table></figure><blockquote><p>更多详情 <a href="https://github.com/poetries/vue-router-demo" target="_blank" rel="noopener">https://github.com/poetries/vue-router-demo</a></p></blockquote><h2 id="十四、路由的类型及底层原理"><a href="#十四、路由的类型及底层原理" class="headerlink" title="十四、路由的类型及底层原理"></a>十四、路由的类型及底层原理</h2><p><strong>路由的类型</strong></p><ul><li><code>Hash</code>模式：无法使用锚点定位</li><li><code>History</code>模式：需要后端配合，IE9不兼容，可以使用强制刷新处理</li></ul><p><strong>原理</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/vue/28.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、组件的核心概念-属性props几种写法&quot;&gt;&lt;a href=&quot;#一、组件的核心概念-属性props几种写法&quot; class=&quot;headerlink&quot; title=&quot;一、组件的核心概念-属性props几种写法&quot;&gt;&lt;/a&gt;一、组件的核心概念-属性props几种写法&lt;/
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="Vue" scheme="http://blog.poetries.top/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>React Native之Icon/启动图设置</title>
    <link href="http://blog.poetries.top/2019/10/04/rn-icon-spash-setting/"/>
    <id>http://blog.poetries.top/2019/10/04/rn-icon-spash-setting/</id>
    <published>2019-10-04T07:10:12.000Z</published>
    <updated>2019-12-16T02:35:06.843Z</updated>
    
    <content type="html"><![CDATA[<h2 id="生成不同尺寸的启动图和图标"><a href="#生成不同尺寸的启动图和图标" class="headerlink" title="生成不同尺寸的启动图和图标"></a>生成不同尺寸的启动图和图标</h2><p><strong>方式一</strong></p><blockquote><p><a href="http://blog.poetries.top/2019/01/10/ionic3-summary/#12-1-%E5%9B%BE%E6%A0%87%E7%94%9F%E6%88%90">借助Ionic生成不同尺寸的启动图和图标</a></p></blockquote><p><strong>方式二</strong></p><p><strong>各种尺寸Icon图标生成</strong></p><blockquote><p>使用图标工厂生成 <a href="https://icon.wuruihong.com/" target="_blank" rel="noopener">https://icon.wuruihong.com/</a></p></blockquote><ol><li>安卓下替换<code>andriod/app/src/main/res/</code>下的mipmap文件即可</li><li>iOS下替换如下</li></ol><p><img src="http://blog.poetries.top/img-repo/2019/10/750.png" alt></p><p><strong>各种尺寸启动图图标生成</strong></p><blockquote><p>启动图也可以使用图标工厂生产了 <a href="https://icon.wuruihong.com/splash" target="_blank" rel="noopener">https://icon.wuruihong.com/splash</a></p></blockquote><ol><li>安卓下拷贝生成的文件到<code>andriod/app/src/main/res/</code>目录下</li></ol><p><img src="http://blog.poetries.top/img-repo/2019/10/751.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/750.png" alt></p><ol start="2"><li>iOS下拷贝生成的该文件夹替换即可</li></ol><p><img src="http://blog.poetries.top/img-repo/2019/10/752.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/753.png" alt></p><h2 id="安卓端"><a href="#安卓端" class="headerlink" title="安卓端"></a>安卓端</h2><p><strong>修改图标和名称</strong></p><blockquote><p>找到根目录<code>/android/app/src/main/res</code></p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/540.png" alt></p><p><strong>启动页</strong></p><blockquote><ul><li>在<code>react-native</code>的<code>android</code>中的启动图和<code>IOS</code>不相同点在于，<code>android</code>没有默认的启动图，在<code>IOS</code>里面有</li><li>使用插件 <code>import SplashScreen from &#39;react-native-splash-screen&#39;;</code></li><li><a href="https://github.com/crazycodeboy/react-native-splash-screen" target="_blank" rel="noopener">https://github.com/crazycodeboy/react-native-splash-screen</a></li></ul></blockquote><blockquote><p>把生成好的启动页按这个格式处理即可</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/541.png" alt></p><h2 id="iOS端"><a href="#iOS端" class="headerlink" title="iOS端"></a>iOS端</h2><p><strong>修改app名称</strong></p><blockquote><p>编辑 <code>ios/test/Info.plist</code> 文件</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;key&gt;CFBundleDisplayName&lt;/key&gt;</span><br><span class="line">- &lt;string&gt;$(PRODUCT_NAME)&lt;/string&gt;</span><br><span class="line">+ &lt;string&gt;测试程序&lt;/string&gt;</span><br></pre></td></tr></table></figure><p><strong>修改应用图标</strong></p><blockquote><p>应用图标对尺寸有要求，比较简单地方式是准备一张 <code>1024*1024</code> 的图片，然后使用<a href="https://icon.wuruihong.com/" target="_blank" rel="noopener">图标工厂</a>在线生成 </p></blockquote><blockquote><p>这里直接从 Sketch iOS 图标设计模板中选取了一张图片，生成后的结果如下</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/744.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/745.png" alt></p><blockquote><p>我们可以直接用生成好的内容替换默认的图标即可</p></blockquote><blockquote><p>替换 <code>ios/test/Images.xcassets/AppIcon.appiconset</code> 中的内容。如果不需要全部尺寸，可以用 XCode 打开项目，点击 <code>Images.xcassets&gt;AppIcon</code> 拖入相应尺寸的图标</p></blockquote><h2 id="添加启动页"><a href="#添加启动页" class="headerlink" title="添加启动页"></a>添加启动页</h2><blockquote><p>添加启动页可以使用 <a href="https://github.com/crazycodeboy/react-native-splash-screen" target="_blank" rel="noopener">react-native-splash-screen</a> 库，通过它可以控制启动页的显示和隐藏</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ yarn add react-native-splash-screen</span><br><span class="line"></span><br><span class="line">$ react-native link react-native-splash-screen</span><br></pre></td></tr></table></figure><p><strong>Android</strong></p><blockquote><p>编辑 <code>MainActivity.java</code>，添加显示启动页的代码</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Bundle; <span class="comment">// here</span></span><br><span class="line"><span class="keyword">import</span> com.facebook.react.ReactActivity;</span><br><span class="line"><span class="comment">// react-native-splash-screen &gt;= 0.3.1</span></span><br><span class="line"><span class="keyword">import</span> org.devio.rn.splashscreen.SplashScreen; <span class="comment">// here</span></span><br><span class="line"><span class="comment">// react-native-splash-screen &lt; 0.3.1</span></span><br><span class="line"><span class="keyword">import</span> com.cboy.rn.splashscreen.SplashScreen; <span class="comment">// here</span></span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ReactActivity</span> </span>&#123;</span><br><span class="line">   @Override</span><br><span class="line">    protected <span class="keyword">void</span> onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        SplashScreen.show(<span class="keyword">this</span>);  <span class="comment">// here</span></span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...other code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在 <code>android/app/src/main/res/layout</code> 文件夹下创建启动页布局文件 <code>launch_screen.xml</code></p></blockquote><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span> <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"@drawable/launch_image"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>将启动页图片放置在 <code>drawable</code> 文件夹下</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">drawable-ldpi</span><br><span class="line">drawable-mdpi</span><br><span class="line">drawable-hdpi</span><br><span class="line">drawable-xhdpi</span><br><span class="line">drawable-xxhdpi</span><br><span class="line">drawable-xxxhdpi</span><br></pre></td></tr></table></figure><ul><li>Android 会自动缩放 drawable 下的图片，所以我们不必为所有分辨率的设备准备启动图</li><li>完成上述操作后，重新打包应用，再启动时就可以看到启动页了。不过，启动页显示之前会有短暂的白屏，我们可以通过设置透明背景来处理。编辑 <code>android/app/src/main/res/values/styles.xml</code> 文件，修改如下</li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Base application theme. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;</span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- Customize your theme here. --&gt;</span></span></span><br><span class="line"><span class="xml">+        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsTranslucent"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>iOS</strong></p><blockquote><p><a href="https://github.com/phodal/growth/tree/master/ios/growth/Images.xcassets/AppIcon.appiconset" target="_blank" rel="noopener">图标配置参考</a></p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">#import "AppDelegate.h"</span><br><span class="line"></span><br><span class="line">#import &lt;React/RCTBundleURLProvider.h&gt;</span><br><span class="line">#import &lt;React/RCTRootView.h&gt;</span><br><span class="line">#import "RNSplashScreen.h"  // here</span><br><span class="line"></span><br><span class="line">@implementation AppDelegate</span><br><span class="line"></span><br><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...other code</span></span><br><span class="line"></span><br><span class="line">    [RNSplashScreen show];  <span class="comment">// here</span></span><br><span class="line">    <span class="keyword">return</span> YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><blockquote><p>用 XCode 打开项目，选中 <code>LaunchScreen.xib</code> 中的 <code>View</code>，取消选中 <code>Use Launch Screen</code></p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/746.webp" alt></p><blockquote><p>选中项目，在 <code>General</code> 配置中设置 <code>Launch Images Srouce</code>，点击 <code>Use Asset Catalog</code>，弹出对话框中使用默认即可（此操作会在 <code>Images.xcassets</code> 中创建 <code>LaunchImage</code>），然后设置 <code>Launch Screen File</code> 为空</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/747.webp" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/10/754.png" alt></p><p><img src="http://blog.poetries.top/img-repo/2019/10/755.png" alt></p><blockquote><p>点击 <code>Images.xcassets &gt; LaunchImage</code>，在右侧属性栏处选择要支持的设备。接着，添加对应分辨率的图片，分辨率对照如下</p></blockquote><table><thead><tr><th>设备</th><th>分辨率</th></tr></thead><tbody><tr><td><code>iOS 11+</code></td><td><code>1125*2436</code></td></tr><tr><td><code>iOS 8+ Retina HD 5.5</code></td><td><code>1242*2208</code></td></tr><tr><td><code>iOS 8+ Retina HD 4.7</code></td><td><code>750*1334</code></td></tr><tr><td><code>iOS 7+ 2x</code></td><td><code>640*960</code></td></tr><tr><td><code>iOS 7+ Retina 4</code></td><td><code>640*1136</code></td></tr><tr><td><code>iOS 5,6 1x</code></td><td><code>320*480</code></td></tr><tr><td><code>iOS 5,6 2x</code></td><td><code>640*960</code></td></tr><tr><td><code>iOS 5,6 Retina 4</code></td><td><code>640*1136</code></td></tr></tbody></table><p><strong>安卓的尺寸</strong></p><table><thead><tr><th>设备</th><th>分辨率</th></tr></thead><tbody><tr><td><code>mdpi:</code></td><td><code>375*667</code></td></tr><tr><td><code>hdpi:</code></td><td><code>563*1001</code></td></tr><tr><td><code>xhdpi:</code></td><td><code>750*1334</code></td></tr><tr><td><code>xxhdpi:</code></td><td><code>1125*2001</code></td></tr><tr><td><code>xxxhdpi:</code></td><td><code>1500*2668</code></td></tr></tbody></table><p><img src="http://blog.poetries.top/img-repo/2019/10/748.webp" alt></p><p>完成上述操作之后，重新安装 APP 再启动时就可以看到启动页</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;生成不同尺寸的启动图和图标&quot;&gt;&lt;a href=&quot;#生成不同尺寸的启动图和图标&quot; class=&quot;headerlink&quot; title=&quot;生成不同尺寸的启动图和图标&quot;&gt;&lt;/a&gt;生成不同尺寸的启动图和图标&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;方式一&lt;/strong&gt;&lt;/p&gt;
&lt;
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="react" scheme="http://blog.poetries.top/tags/react/"/>
    
      <category term="RN" scheme="http://blog.poetries.top/tags/RN/"/>
    
  </entry>
  
  <entry>
    <title>React Native之iOS打包发布</title>
    <link href="http://blog.poetries.top/2019/10/03/rn-ios-distribute/"/>
    <id>http://blog.poetries.top/2019/10/03/rn-ios-distribute/</id>
    <published>2019-10-03T16:10:12.000Z</published>
    <updated>2019-12-16T02:35:06.843Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>结合这篇文章一起看 <a href="http://blog.poetries.top/2019/10/07/Ionic-ios-build">http://blog.poetries.top/2019/10/07/Ionic-ios-build</a></p></blockquote><blockquote><p><code>React Native</code> 应用程序开发完成后，需要先打包一个测试版，由测试人员安装应用并测试。对于 <code>iOS</code> 应用，一般来说，开发者如果需要将应用安装到某些用户的设备上，就需要将应用导出为这些设备可以直接安装的安装包（<code>.ipa</code> 文件）。本文总结了如何打包 <code>ipa</code> 并发布到应用内测分发平台供安装测试</p></blockquote><h2 id="一、应用程序打包"><a href="#一、应用程序打包" class="headerlink" title="一、应用程序打包"></a>一、应用程序打包</h2><blockquote><p>开发 <code>React Native</code> 应用时，js 代码和图片资源通过 <code>Debug Server</code> 提供，但是当我们需要发布应用时，就需要将 js 等资源和应用一起打包</p></blockquote><h3 id="1-1-打包离线资源"><a href="#1-1-打包离线资源" class="headerlink" title="1.1 打包离线资源"></a>1.1 打包离线资源</h3><blockquote><p>通过 <code>react-native bundle</code> 命令可以打包离线资源。为了日后把打包方便，我们把打包指令填在下<code>package.json</code>下</p></blockquote><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "start": "node node_modules/react-native/local-cli/cli.js start",</span><br><span class="line">    "test": "jest",</span><br><span class="line">    "bundle-ios": "node node_modules/react-native/local-cli/cli.js bundle --entry-file index.js --platform ios --dev false --bundle-output ./ios/bundle/index.jsbundle --assets-dest ./ios/bundle"</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><blockquote><p><code>bundle-ios</code>命令参数含义</p></blockquote><ul><li><code>--entry-file</code>：入口文件。</li><li><code>--platform</code>：平台名称（ios或者android）。</li><li><code>--dev</code>：是否是开发模式，设置为 false 的时候将会对 JavaScript 代码进行优化处理。</li><li><code>--bundle-output</code>：生成的 <code>jsbundle</code> 文件的名称。</li><li><code>--assets-dest</code>：图片以及其他资源存放的目录</li></ul><blockquote><p>这样打包只需要在根目录下输入<code>npm run bundle-ios</code> 即可（切记一定要先在<code>项目--&gt;ios下新建bundle</code>文件夹，不然会报错）</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/711.png" alt></p><blockquote><p>之后你会发现bundle文件下面已经有了内容（如下图）</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/712.png" alt></p><h3 id="1-2-添加离线资源到项目中"><a href="#1-2-添加离线资源到项目中" class="headerlink" title="1.2 添加离线资源到项目中"></a>1.2 添加离线资源到项目中</h3><blockquote><p>在<code>Xcode</code>中添加资源到项目中，必须使用<code>Create folder references</code>的方式(也就是文件夹的方式)添加<code>bundle</code>文件<br>夹</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/713.png" alt></p><blockquote><p>必须使用<code>Create folder references</code>的方式添加：</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/714.png" alt></p><blockquote><p>添加成功后<code>bundle</code>文件夹为蓝色（如下图）</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/715.png" alt></p><h3 id="1-3-修改-AppDelegate-m-文件"><a href="#1-3-修改-AppDelegate-m-文件" class="headerlink" title="1.3 修改 AppDelegate.m 文件"></a>1.3 修改 AppDelegate.m 文件</h3><blockquote><p>在开发的过程中可以在这里配置<code>Debug Server</code>的地址，当发布上线的时候，就需要使用离线的<code>jsbundle</code>文件，因此需要设置<code>jsCodeLocation</code>为本地的离线<code>jsbundle</code>。</p></blockquote><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</span><br><span class="line">&#123;</span><br><span class="line">  NSURL *jsCodeLocation;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  jsCodeLocation = [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@"index" fallbackResource:nil];</span></span><br><span class="line"><span class="comment">//  jsCodeLocation = [NSURL URLWithString:@"http://192.0.0.0:8081/index.bundle?platform=ios&amp;dev=true"];//真机Hot reloading</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">     jsCodeLocation = [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@<span class="string">"index"</span> fallbackResource:nil];<span class="comment">//开发调试</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    jsCodeLocation = [[NSBundle mainBundle] URLForResource:@<span class="string">"bundle/index"</span> withExtension:@<span class="string">"jsbundle"</span>];<span class="comment">//上线打包</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"> ........</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="二、iOS证书配置"><a href="#二、iOS证书配置" class="headerlink" title="二、iOS证书配置"></a>二、iOS证书配置</h2><blockquote><p>建议阅读这篇文章更详细。<a href="http://blog.poetries.top/2019/10/03/rn-ios-cert-config">React Native打包前凑之iOS证书配置</a></p></blockquote><blockquote><p>首先你的有一个开发者账号才可以进行以下步骤</p></blockquote><blockquote><p>在mac上搜索钥匙串打开</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/726.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/727.png" alt></p><blockquote><p>到 <code>https://developer.apple.com</code> 去申请证书</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/728.png" alt></p><blockquote><p>新建证书</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/729.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/730.png" alt></p><blockquote><p>上传之前的钥匙串文件</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/731.png" alt></p><blockquote><p>下载证书。双击即可安装到钥匙串中</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/732.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/733.png" alt></p><blockquote><p>新建<code>Identifiers</code></p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/734.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/735.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/736.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/737.png" alt></p><blockquote><p>新增Profiles 把设备证书以及id关联起来</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/738.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/739.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/740.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/741.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/742.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/743.png" alt></p><blockquote><p>到此证书部分添加完毕。接下来是根据已经配置的证书去打包。xcode会自动同步证书信息过来</p></blockquote><h2 id="三、Xcode-打包-ipa"><a href="#三、Xcode-打包-ipa" class="headerlink" title="三、Xcode 打包 ipa"></a>三、Xcode 打包 ipa</h2><ol><li>在 <code>Xcode</code> 添加前面申请证书的开发者账号（<code>Xcode-&gt;Preferences-&gt;Accounts</code>）</li></ol><p><img src="http://blog.poetries.top/img-repo/2019/10/716.png" alt></p><ol start="2"><li>这里的 <code>Bundle Idetifier</code> 应该为之前在开发者平台上添加的 <code>App ID</code> 如下图</li></ol><p><img src="http://blog.poetries.top/img-repo/2019/10/717.png" alt></p><ol start="3"><li>配置一下<code>code sign</code> 。选择 <code>Code Signing Identity</code> 安装证书</li></ol><blockquote><p>程序会自动选择设置</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/718.png" alt></p><blockquote><p>或者手动选择证书</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/719.png" alt></p><ol start="4"><li>点击设备，选择通用 iOS 设备</li></ol><p><img src="http://blog.poetries.top/img-repo/2019/10/720.png" alt></p><ol start="5"><li>点击 <code>Product-&gt;Archive</code> 开始打包</li></ol><blockquote><p>打包完成后如下</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/721.png" alt></p><blockquote><p>点击<code>distribute App</code></p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/ionic/16.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/17.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/18.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/ionic/19.png" alt></p><blockquote><p>最后打包成<code>ipa</code>文件</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/725.png" alt></p><h2 id="四、发布到内测分发平台"><a href="#四、发布到内测分发平台" class="headerlink" title="四、发布到内测分发平台"></a>四、发布到内测分发平台</h2><blockquote><p>由于新版的 iTunes 没有了应用程序选项，所以无法通过 iTunes 安装 App 到手机中。比较方便的方式是将应用发布到内测分发平台，然后扫码即可下载。目前我听得比较多的平台就是蒲公英和 fir.im，不过这两个平台都需要实名认证，有点蛋疼。具体使用哪个平台自己甄选就行，这里推荐一个不需要认证的国外平台 <a href="https://www.diawi.com" target="_blank" rel="noopener">https://www.diawi.com</a></p></blockquote><h3 id="4-1-ipa安装到手机上"><a href="#4-1-ipa安装到手机上" class="headerlink" title="4.1 ipa安装到手机上"></a>4.1 ipa安装到手机上</h3><blockquote><p>在Xcode的导航栏上选择<code>window-&gt;Devices and Simulators</code>，点击弹出页面里面的+号，选择<code>ipa</code>所在的文件夹,添加<code>ipa</code>，安装成功</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/709.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/710.png" alt></p><blockquote><p>以上只是测试版本打包，打包成<code>disctibute App</code>发布版本同理，这里不再赘述</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;结合这篇文章一起看 &lt;a href=&quot;http://blog.poetries.top/2019/10/07/Ionic-ios-build&quot;&gt;http://blog.poetries.top/2019/10/07/Ionic-ios-build&lt;
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="react" scheme="http://blog.poetries.top/tags/react/"/>
    
      <category term="RN" scheme="http://blog.poetries.top/tags/RN/"/>
    
  </entry>
  
  <entry>
    <title>React Native打包前凑之iOS证书配置</title>
    <link href="http://blog.poetries.top/2019/10/03/rn-ios-cert-config/"/>
    <id>http://blog.poetries.top/2019/10/03/rn-ios-cert-config/</id>
    <published>2019-10-03T11:10:12.000Z</published>
    <updated>2019-12-16T02:35:06.843Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>iOS证书配置</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/693.png" alt></p><h2 id="一、Overview"><a href="#一、Overview" class="headerlink" title="一、Overview"></a>一、Overview</h2><blockquote><p>我们都知道开发一款应用需要配置苹果常用证书、<code>AppId</code>,<code>Provisioning Profiles</code>，如果有推送还需要配置推送证书等</p></blockquote><h2 id="二、App-ID"><a href="#二、App-ID" class="headerlink" title="二、App ID"></a>二、App ID</h2><blockquote><p><code>App ID</code> 是每个应用的独立标识，在设置中可以配置该应用的权限，比如：<code>Push Notifications</code>、<code>Network Extensions</code>等。</p></blockquote><h2 id="三、开发者证书"><a href="#三、开发者证书" class="headerlink" title="三、开发者证书"></a>三、开发者证书</h2><ul><li>iOS证书是用来证明iOS App内容（executable code）的合法性和完整性的数字证书。对于想安装到真机或发布到AppStore的应用程序（App），只有经过签名验证（Signature Validated）才能确保来源可信，并且保证App内容是完整、未经篡改的。</li><li>数字证书是一个经证书授权中心数字签名的包含公开密钥拥有者信息以及公开密钥的文件。具有时效性，只在特定的时间段内有效。</li><li>开发证书类型分为两种，一种开发证书（iOS Development）一种发布证书(iOS Distribution)。开发证书（iOS Development）用于开发和调试应用程序，可用于真机调试；生产证书用于打包上传App Store，用于验证开发者身份</li></ul><h2 id="四、推送证书"><a href="#四、推送证书" class="headerlink" title="四、推送证书"></a>四、推送证书</h2><blockquote><p>如果项目中集成了推送功能，同样需要配置推送证书。推送证书同样也分两种：开发（Apple Development iOS Push Services）、生产（Apple Production iOS Push Services）。推送证书在AppID中创建生成，同时生成的的p12文件需要上传到服务端后台（友盟后台、极光后台或自己服务端后台）</p></blockquote><h2 id="五、配置文件（Provisioning-Profiles）"><a href="#五、配置文件（Provisioning-Profiles）" class="headerlink" title="五、配置文件（Provisioning Profiles）"></a>五、配置文件（Provisioning Profiles）</h2><blockquote><p>配置文件同样也分两种，分为开发（<code>Development</code>）和发布（<code>Distribution</code>），配置文件（<code>Provisioning Profiles</code>）中包含了证书、<code>App ID</code>、设备（Devices），后缀名为<code>.mobileprovision</code>。它在开发者账号体系中扮演着配置和验证的角色，是真机调试和打包上架必须的文件</p></blockquote><ul><li>一个<code>Provisioning Profile</code>对应一个Explicit App ID或Wildcard App ID</li><li><code>Provisioning Profile</code>决定<code>Xcode</code>用哪个证书（公钥）/私钥组合（Key Pair/Signing Identity）来签名应用程序（<code>Signing Product</code>）,将在应用程序打包时嵌入到<code>.ipa</code>包里</li><li><code>Provisioning Profile</code> 把这些信息全部打包在一起，方便我们在调试和发布程序打包时使用。这样，只要在不同的情况下选择不同的<code>Provisioning Profile</code>文件就可以了</li><li><code>Provisioning Profile</code>也分为<code>Development</code>和<code>Distribution</code>两类，有效期同<code>Certificate</code>一样。<code>Development</code>版本的<code>ProvisioningProfile</code>用于开发调试，<code>Distribution</code>版本的<code>ProvisioningProfile</code>主要用于提交<code>App Store</code>审核，其不指定开发测试的<code>Devices</code></li></ul><blockquote><p>ps:打<code>Ad-hoc</code>包的时候，如果遇到刚添加的设备<code>UDID</code>没添加进去，可以将开发模式的配置文件下载下来，打包后直接选中即可</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/694.png" alt></p><p>在配置证书之前我们需要有一个开发账号。个人账号和公司账号类似，每年都需要支付99刀，其中公司账号需要邓白氏编码而个人账号并不需要。</p><p>如果项目需要不通过App Store进行安装，可以申请企业账号。当然了，也可以找一些第三方直接打企业包，比如蒲公英之类的</p><h2 id="六、创建CSR文件（证书请求文件）"><a href="#六、创建CSR文件（证书请求文件）" class="headerlink" title="六、创建CSR文件（证书请求文件）"></a>六、创建CSR文件（证书请求文件）</h2><blockquote><p>CSR（<code>Certificate signing request</code>）即证书请求文件。证书申请者在申请数字证书时由CSP(加密服务提供者)在生成私钥的同时也生成证书请求文件（CSR文件），证书申请者只要把CSR文件提交给证书颁发机构后（创建App ID时上传到苹果后台），证书颁发机构使用其根证书私钥签名生成证书公钥文件（开发者证书）</p></blockquote><ul><li>关于CSR文件的创建，我们可以直接使用Mac上的钥匙串访问直接请求。</li></ul><p><strong>具体步骤为： 钥匙串访问 -&gt; 钥匙串访问 -&gt; 证书助理 -&gt; 从证书颁发机构请求证书</strong></p><p><strong>1、打开电脑上的钥匙串访问，选中证书助理；</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/695.png" alt></p><p><strong>2、用户电子邮件地址填开发者账号的邮箱，名称可以随意填，然后保存到磁盘上。</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/696.png" alt></p><p><strong>3、Keychain将生成一个包含开发者身份信息的CSR（Certificate Signing Request）文件。同时，Keychain Access-&gt;Keys（密钥）中增加一对Public/Private Key Pair</strong></p><h3 id="创建App-ID"><a href="#创建App-ID" class="headerlink" title="创建App ID"></a>创建App ID</h3><p><strong>1、登录苹果开发者中心,或者直接登录Apple Member Center选择Certificates,Identifiers &amp; Profiles</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/697.png" alt></p><p><strong>2、选择Identifiers 中的 App IDs，然后点上方的加号；</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/698.png" alt></p><p><strong>3、添加App ID Description和Bundle ID</strong></p><ul><li>在“Explicit App ID”栏下的“Bundle ID”项中输入App ID（反域名格式，如：com.company.test）</li><li>这里“Bundle ID”对应Xcode中的“Bundle identifier” Explicit App ID：唯一的App ID，用于唯一标识一个应用程序。例如“com.apple.garageband”这个App ID，用于标识Bundle Identifier为“com.apple.garageband”的App</li><li>Wildcard App ID：含有通配符的App ID，用于标识一组应用程序。例如“”（实际上是Application Identifier Prefix）表示所有应用程序；而“com.apple.”可以表示Bundle Identifier以“com.apple.”开头（苹果公司）的所有应用程序。</li><li>在“App Services”栏下选择应用要使用到的服务（如要使用推送功能，勾选“Push Notifications”）</li><li>点击continue-&gt;点击submit-&gt;点击done，申请App IDs完成。点击All IDs可查看申请的ID，点击该ID</li><li>点击 对应名称 可对该App ID进行编辑</li></ul><h2 id="七、创建开发者证书-和-推送证书"><a href="#七、创建开发者证书-和-推送证书" class="headerlink" title="七、创建开发者证书 和 推送证书"></a>七、创建开发者证书 和 推送证书</h2><p><strong>1、选择Certificates,然后选择上方的加号；</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/699.png" alt></p><p><strong>2、选择相应的证书，因为开发调试证书、生产发布证书、开发环境推送证书、生产环境推送证书基本都类似，所以这里只选择开发调试证书为例。</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/699.jpg" alt></p><p><strong>3、一路点击Continue, 到Generate后选择一开始生成的CSR文件上传，然后再继续点击Continue</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/701.png" alt></p><p><strong>4、生成完开发调试、生成调试证书 和 开发环境推送证书、生成环境推送证书，可以在“Certificates”-&gt;“All”中查看该证书，并进行下载或删除</strong></p><p><strong>5、下载到桌面上，然后双击添加到钥匙串中，可在Keychain Access-&gt;“证书”中查看</strong></p><blockquote><p>使用友盟，生成的推送证书（开发环境和生产环境）需要从钥匙串访问中导出p12文件，添加到友盟后台</p></blockquote><h2 id="八、推送证书"><a href="#八、推送证书" class="headerlink" title="八、推送证书"></a>八、推送证书</h2><blockquote><p>导出p12文件上传到友盟（极光）后台</p></blockquote><p><strong>1、由上一步创建了开发环境的推送证书和生成环境的推送证书，下载到电脑上后，直接双击即可安装到钥匙串中。</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/702.png" alt></p><p><strong>2、选中相应证书（开发环境推送证书或生成环境推送证书）右键 导出；</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/703.png" alt></p><p><strong>3、点击存储后需要输入密码，密码要记住，上传到友盟（极光）后台时，需要用到</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/704.png" alt></p><h3 id="创建配置文件（Provisioning-Profiles）"><a href="#创建配置文件（Provisioning-Profiles）" class="headerlink" title="创建配置文件（Provisioning Profiles）"></a>创建配置文件（Provisioning Profiles）</h3><p><strong>1、选中Provisioning Profiles 然后选中上方的加号。</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/705.png" alt></p><p><strong>2、配置文件也分为开发和发布，我们这里以Ad Hoc为例，因为我们打测试包的时候，如果有些设备的UDID未添加进配置文件中，我们需要下载配置文件手动选择。而其他的的配置文件目前的Xcode会自动请求，所以一般不需要我们自己手动创建</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/706.png" alt></p><p><strong>3、选择刚创建的App ID,选择相应证书、选择测试的设备，然后创建名称一直点击Continue即可，最后下载下来</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/707.png" alt><br><img src="http://blog.poetries.top/img-repo/2019/10/708.png" alt></p><p>到此为止证书和配置文件之类的都创建完了~~</p><h2 id="九、总结："><a href="#九、总结：" class="headerlink" title="九、总结："></a>九、总结：</h2><ul><li>导出p12证书的时候需要密码，上传到友盟（极光）后台需要输入密码。</li><li>开发和生成的推送证书创建成功后，到相应App ID 下查看是否有，如果没有可以停段时间刷新下，或下载下来手动上传上去。</li><li>新添加上的测试机的UDID，打包的时候没打包上去，需要重新创建配置文件，下载后将本地的删除，然后双击。不过刚添加UDID，重新创建配置文件后，我一般在打包的时候手动选择配置文件。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;iOS证书配置&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;http://blog.poetries.top/img-repo/2019/10/693.png&quot; alt&gt;&lt;/p&gt;
&lt;h2 id=&quot;一、Overview&quot;&gt;&lt;a hr
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="RN" scheme="http://blog.poetries.top/tags/RN/"/>
    
      <category term="IOS证书" scheme="http://blog.poetries.top/tags/IOS%E8%AF%81%E4%B9%A6/"/>
    
  </entry>
  
  <entry>
    <title>React Native之原理浅析</title>
    <link href="http://blog.poetries.top/2019/10/02/rn-yuanli/"/>
    <id>http://blog.poetries.top/2019/10/02/rn-yuanli/</id>
    <published>2019-10-02T10:30:12.000Z</published>
    <updated>2019-12-16T02:35:06.843Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、JavaScriptCore"><a href="#一、JavaScriptCore" class="headerlink" title="一、JavaScriptCore"></a>一、JavaScriptCore</h2><blockquote><p>讲React Native之前，了解JavaScriptCore会有帮助，也是必要的。React Native的核心驱动力就来自于JS Engine. 你写的所有JS和JSX代码都会被JS Engine来执行, 没有JS Engine的参与，你是无法享受ReactJS给原生应用开发带来的便利的。在iOS上，默认的就是JavaScriptCore， iOS 7之后的设备都支持. iOS 不允许用自己的JS Engine. JavaScriptCore来自于WebKit, 所以，安卓上默认也是用JavaScriptCore</p></blockquote><blockquote><p>你深入了解<code>React Native</code>的第一站应该是 <code>JavaScriptCore</code></p></blockquote><ul><li><code>JavaScriptCore</code>在<code>iOS</code>平台上给<code>React Native</code>提供的接口也仅限于那几个接口，你弄明白了<code>JavaScriptCore</code>那几个接口, React Native 剩下的魔法秘密都可以顺藤摸瓜来分析了。</li><li>接下来要讲解的就是Facebook围绕这几个接口以及用一个React来颠覆整个native开发所做的精妙设计和封装</li></ul><h2 id="二、浏览器工作原理"><a href="#二、浏览器工作原理" class="headerlink" title="二、浏览器工作原理"></a>二、浏览器工作原理</h2><ul><li>浏览器通过<code>Dom Render</code>来渲染所有的元素.</li><li>浏览器有一整套的UI控件，样式和功能都是按照html标准实现的</li><li>浏览器能读懂html和css。</li><li>html告诉浏览器绘制什么控件(html tag)，css告诉浏览器每个类型的控件(html tag)具体长什么样。</li><li>浏览器的主要作用就是通过解析html来形成dom树，然后通过css来点缀和装饰树上的每一个节点</li></ul><p><strong>UI的描述和呈现分离开了</strong></p><ol><li>html文本描述了页面应该有哪些功能，css告诉浏览器该长什么样。</li><li>浏览器引擎通过解析html和css，翻译成一些列的预定义UI控件，</li><li>然后UI控件去调用操作系统绘图指令去绘制图像展现给用户。</li><li>Javascript可有可无，主要用于html里面一些用户事件响应，DOM操作、异步网络请求和一些简单的计算</li></ol><blockquote><p>在react native 里面，1和2是不变的，也是用html语言描述页面有哪些功能，然后stylesheet告诉浏览器引擎每个控件应该长什么样。并且和浏览器用的是同一个引擎</p></blockquote><blockquote><p>在步骤3里面UI控件不再是浏览器内置的控件，而是<code>react native</code>自己实现的一套UI控件（两套，android一套，ios一套），这个切换是在<code>MessageQueque</code>中进行的，并且还可以发现，他们tag也是不一样的</p></blockquote><p><strong>Javascript在react native里面非常重要</strong></p><ul><li>它负责管理UI component的生命周期，管理Virtual DOM</li><li>所有业务逻辑都是用javascript来实现或者衔接</li><li>调用原生的代码来操纵原生组件。</li><li>Javascript本身是无绘图能力的，都是通过给原生组件发指令来完成</li></ul><h2 id="三、React-Native-架构"><a href="#三、React-Native-架构" class="headerlink" title="三、React Native 架构"></a>三、React Native 架构</h2><p><img src="http://blog.poetries.top/img-repo/2019/10/680.jpeg" alt></p><ul><li>绿色的是我们应用开发的部分。我们写的代码基本上都是在这一层</li><li>蓝色代表公用的跨平台的代码和工具引擎，一般我们不会动蓝色部分的代码</li><li>黄色代码平台相关的代码，做定制化的时候会添加修改代码。不跨平台，要针对平台写不同的代码。iOS写OC, android写java，web写js. 每个bridge都有对应的js文件，js部分是可以共享的，写一份就可以了。如果你想做三端融合，你就得理解这一个东西。如果你要自己定制原生控件，你就得写bridge部分</li><li>红色部分是系统平台的东西。红色上面有一个虚线，表示所有平台相关的东西都通过bridge隔离开来了</li><li>大部分情况下我们只用写绿色的部分，少部分情况下会写黄色的部分。你如果对基础架构和开源感兴趣，你可以写蓝色部分，然后尝试给那些大的开源项目提交代码。红色部分是独立于React Native的</li></ul><h2 id="四、React-Native、React和JavascriptCore的关系"><a href="#四、React-Native、React和JavascriptCore的关系" class="headerlink" title="四、React Native、React和JavascriptCore的关系"></a>四、React Native、React和JavascriptCore的关系</h2><blockquote><p>React Native最重要的三个概念应该就是<code>React Native</code>、<code>React</code>和<code>JavascriptCore</code></p></blockquote><ul><li>React是一个纯JS库，所有的React代码和所有其它的js代码都需要JS Engine来解释执行。因为种种原因，浏览器里面的JS代码是不允许调用自定义的原生代码的，而React又是为浏览器JS开发的一套库，所以，比较容易理解的事实是React是一个纯JS库，它封装了一套Virtual Dom的概念，实现了数据驱动编程的模式，为复杂的Web UI实现了一种无状态管理的机制, 标准的HTML/CSS之外的事情，它无能为力。调用原生控件，驱动声卡显卡，读写磁盘文件，自定义网络库等等，这是JS/React无能为力的</li><li>你可以简单理解为React是一个纯JS 函数， 它接受特定格式的字符串数据，输出计算好的字符串数据</li><li>JS Engine负责调用并解析运行这个函数</li><li><code>React Native</code>呢？ 它比较复杂。复杂在哪里？前面我们说了React 是纯JS库，意味着React只能运行JS代码，通过JS Engine提供的接口(Html Tag)绘制html支持的那些元素，驱动有限的声卡显卡。简单点说, React只能做浏览器允许它做的事情, 不能调用原生接口， 很多的事情也只能干瞪眼</li></ul><p><strong>React Native它可不一样</strong></p><ul><li>第一点，驱动关系不一样。前面我们说的是, JS Engine来解析执行React脚本, 所以，React由浏览器(最终还是JS Engine)来驱动. 到了React Native这里，RN的原生代码(Timer和用户事件)驱动JS Engine, 然后JS Engine解析执行React或者相关的JS代码，然后把计算好的结果返回给Native code. 然后, Native code 根据JS计算出来的结果驱动设备上所有能驱动的硬件。重点，所有的硬件。也就是说，在RN这里，JS代码已经摆脱JS Engine(浏览器)的限制，可以调用所有原生接口啦</li><li>第二点, 它利用React的Virtual Dom和数据驱动编程概念，简化了我们原生应用的开发, 同时，它不由浏览器去绘制，只计算出绘制指令，最终的绘制还是由原生控件去负责，保证了原生的用户体验</li></ul><p><strong>React Native组件结构</strong></p><blockquote><p>驱动硬件的能力决定能一个软件能做多大的事情，有多大的主控性。研究过操作系统底层东西或者汇编的同学明白，我们大部分时候写的代码是受限的代码，很多特权指令我们是没法使用的，很多设备我们是不允许直接驱动的。我们现在的编程里面几乎已经没有人提中断了，没有中断，硬件的操作几乎会成为一场灾难.</p></blockquote><p>在一定程度上，React Native和NodeJS有异曲同工之妙。它们都是通过扩展JavaScript Engine, 使它具备强大的本地资源和原生接口调用能力，然后结合JavaScript丰富的库和社区和及其稳定的跨平台能力，把javascript的魔力在浏览器之外的地方充分发挥出来</p><p><strong>JavaScriptCore + ReactJS + Bridges 就成了React Native</strong></p><ul><li><code>JavaScriptCore</code>负责JS代码解释执行</li><li><code>ReactJS</code>负责描述和管理<code>VirtualDom</code>,指挥原生组件进行绘制和更新，同时很多计算逻辑也在js里面进行。ReactJS自身是不直接绘制UI的，UI绘制是非常耗时的操作，原生组件最擅长这事情。</li><li><code>Bridges</code>用来翻译ReactJS的绘制指令给原生组件进行绘制，同时把原生组件接收到的用户事件反馈给<code>ReactJS</code>。<br>要在不同的平台实现不同的效果就可以通过定制<code>Bridges</code>来实现</li></ul><blockquote><p>深入 <code>Bridge</code> 前面有提到, RN厉害在于它能打通JS和Native Code, 让JS能够调用丰富的原生接口,充分发挥硬件的能力, 实现非常复杂的效果,同时能保证效率和跨平台性。</p></blockquote><blockquote><p>打通RN任督二脉的关键组件就是<code>Bridge</code>. 在RN中如果没有Bridge, JS还是那个JS，只能调用JS Engine提供的有限接口，绘制标准html提供的那些效果,那些摄像头，指纹，3D加速,声卡, 视频播放定制等等，JS都只能流流口水，原生的、平台相关的、设备相关的效果做不了， 除非对浏览器进行定制</p></blockquote><ul><li>Bridge的作用就是给RN内嵌的JS Engine提供原生接口的扩展供JS调用。所有的本地存储、图片资源访问、图形图像绘制、3D加速、网络访问、震动效果、NFC、原生控件绘制、地图、定位、通知等都是通过Bridge封装成JS接口以后注入JS Engine供JS调用。理论上，任何原生代码能实现的效果都可以通过Bridge封装成JS可以调用的组件和方法, 以JS模块的形式提供给RN使用。</li><li>每一个支持RN的原生功能必须同时有一个原生模块和一个JS模块，JS模块是原生模块的封装，方便Javascript调用其接口。Bridge会负责管理原生模块和对应JS模块之间的沟通, 通过Bridge, JS代码能够驱动所有原生接口，实现各种原生酷炫的效果。</li><li>RN中JS和Native分隔非常清晰，JS不会直接引用Native层的对象实例，Native也不会直接引用JS层的对象实例(所有Native和JS互掉都是通过Bridge层会几个最基础的方法衔接的)。</li><li><code>Bridge</code> 原生代码负责管理原生模块并生成对应的JS模块信息供JS代码调用。每个功能JS层的封装主要是针对ReactJS做适配，让原生模块的功能能够更加容易被用ReactJS调用。<code>MessageQueue.js</code>是<code>Bridge</code>在JS层的代理，所有JS2N和N2JS的调用都会经过<code>MessageQueue.js</code>来转发。JS和Native之间不存在任何指针传递，所有参数都是字符串传递。所有的instance都会被在JS和Native两边分别编号，然后做一个映射,然后那个数字/字符串编号会做为一个查找依据来定位跨界对象。</li></ul><h2 id="五、Bridge各模块简介"><a href="#五、Bridge各模块简介" class="headerlink" title="五、Bridge各模块简介"></a>五、Bridge各模块简介</h2><h3 id="5-1-RCTRootView"><a href="#5-1-RCTRootView" class="headerlink" title="5.1 RCTRootView"></a>5.1 RCTRootView</h3><ul><li><code>RCTRootView</code>是<code>React Native</code>加载的地方,是万物之源。从这里开始，我们有了JS Engine, JS代码被加载进来，对应的原生模块也被加载进来，然后js loop开始运行。 js loop的驱动来源是Timer和Event Loop(用户事件). js loop跑起来以后应用就可以持续不停地跑下去了。</li><li>如果你要通过调试来理解RN底层原理，你也应该是从RCTRootView着手，顺藤摸瓜。</li><li>每个项目的<code>AppDelegate.m</code>的- (BOOL)application:didFinishLaunchingWithOptions:里面都可以看到RCTRootView的初始化代码，RCTRootView初始化完成以后，整个React Native运行环境就已经初始化好了，JS代码也加载完毕，所有React的绘制都会有这个RCTRootView来管理。</li></ul><p><strong>RCTRootView做的事情如下</strong></p><ul><li>创建并且持有<code>RCTBridge</code></li><li>加载<code>JS Bundle</code>并且初始化JS运行环境.</li><li>初始化JS运行环境的时候在App里面显示<code>loadingView</code>, 注意不是屏幕顶部的那个下拉悬浮进度提示条. RN第一次加载之后每次启动非常快，很少能意识到这个加载过程了。loadingView默认情况下为空, 也就是默认是没有效果的。loadingView可以被自定义，直接覆盖RCTRootView.loadingView就可以了.开发模式下RN app第一次启动因为需要完整打包整个js所以可以很明显看到加载的过程，加载第一次以后就看不到很明显的加载过程了，可以执行下面的命令来触发重新打包整个js来观察<code>loadingView</code>的效果 <code>watchman watch-del-all &amp;&amp; rm -rf node_modules/ &amp;&amp; yarn install &amp;&amp; yarn start – –reset-cache</code>, 然后杀掉<code>app</code>重启你就会看到一个很明显的进度提示.</li><li><code>JS</code>运行环境准备好以后把加载视图用<code>RCTRootContentView</code>替换加载视图</li><li>有准备工作就绪以后调用<code>AppRegistry.runApplication</code>正式启动RN JS代码，从<code>Root Component()</code>开始UI绘制</li></ul><blockquote><p>一个App可以有多个<code>RCTRootView</code>, 初始化的时候需要手动传输<code>Bridge</code>做为参数，全局可以有多个<code>RCTRootView</code>, 但是只能有一个<code>Bridge</code></p></blockquote><blockquote><p>如果你做过<code>React Native</code>和原生代码混编，你会发现混编就是把<code>AppDelegate</code>里面那段初始化<code>RCTRootView</code>的代码移动到需要混编的地方，然后把<code>RCTRootView</code>做为一个普通的<code>subview</code>来加载到原生的<code>view</code>里面去，非常简单。不过这地方也要注意处理好单Bridge实例的问题，同时，混编里面要注意<code>RCTRootView</code>如果销毁过早可能会引发JS回调奔溃的问题</p></blockquote><h3 id="5-2-RCTRootContentView"><a href="#5-2-RCTRootContentView" class="headerlink" title="5.2 RCTRootContentView"></a>5.2 RCTRootContentView</h3><ul><li><code>RCTRootContentView reactTag</code>在默认情况下为1. 在<code>Xcode view Hierarchy debugger</code> 下可以看到，最顶层为<code>RCTRootView</code>, 里面嵌套的是<code>RCTRootContentView</code>, 从<code>RCTRootContentView</code>开始，每个View都有一个<code>reactTag</code></li><li><code>RCTRootView</code>继承自UIView, RCTRootView主要负责初始化<code>JS Environment</code>和React代码，然后管理整个运行环境的生命周期。 <code>RCTRootContentView</code>继承自<code>RCTView</code>, <code>RCTView</code>继承自UIView, RCTView封装了React Component Node更新和渲染的逻辑， <code>RCTRootContentView</code>会管理所有react ui components. <code>RCTRootContentView</code>同时负责处理所有touch事件</li></ul><h3 id="5-3-RCTBridge"><a href="#5-3-RCTBridge" class="headerlink" title="5.3 RCTBridge"></a>5.3 RCTBridge</h3><blockquote><p>这是一个加载和初始化专用类，用于前期JS的初始化和原生代码的加载</p></blockquote><ul><li>负责加载各个Bridge模块供JS调用</li><li>找到并注册所有实现了<code>RCTBridgeModule protocol</code>的类, 供JS后期使用.</li><li>创建和持有 <code>RCTBatchedBridge</code></li></ul><h3 id="5-4-RCTBatchedBridge"><a href="#5-4-RCTBatchedBridge" class="headerlink" title="5.4 RCTBatchedBridge"></a>5.4 RCTBatchedBridge</h3><blockquote><p>如果RCTBridge是总裁, 那么RCTBatchedBridge就是副总裁。前者负责发号施令，后者负责实施落地</p></blockquote><ul><li>负责Native和JS之间的相互调用(消息通信)</li><li>持有<code>JSExecutor</code></li><li>实例化所有在RCTBridge里面注册了的<code>native node_modules</code></li><li>创建JS运行环境, 注入<code>native hooks</code> 和<code>modules</code>, 执行 JS bundle script</li><li>管理JS run loop, 批量把所有JS到native的调用翻译成<code>native invocations</code></li><li>批量管理原生代码到JS的调用，把这些调用翻译成JS消息发送给<code>JS executor</code></li></ul><h3 id="5-5-RCTJavaScriptLoader"><a href="#5-5-RCTJavaScriptLoader" class="headerlink" title="5.5 RCTJavaScriptLoader"></a>5.5 RCTJavaScriptLoader</h3><blockquote><p>这是实现远程代码加载的核心。热更新，开发环境代码加载，静态<code>jsbundle</code>加载都离不开这个工具。</p></blockquote><ul><li>从指定的地方(<code>bundle</code>, <code>http server</code>)加载 <code>script bundle</code></li><li>把加载完成的脚本用<code>string</code>的形式返回</li><li>处理所有获取代码、打包代码时遇到的错误</li></ul><h3 id="5-6-RCTContextExecutor"><a href="#5-6-RCTContextExecutor" class="headerlink" title="5.6 RCTContextExecutor"></a>5.6 RCTContextExecutor</h3><ul><li>封装了基础的JS和原生代码互掉和管理逻辑，是JS引擎切换的基础。通过不同的RCTCOntextExecutor来适配不同的JS Engine，让我们的React JS可以在iOS、Android、chrome甚至是自定义的js engine里面执行。这也是为何我们能在chrome里面直接调试js代码的原因</li><li>管理和执行所有N2J调用</li></ul><h3 id="5-7-RCTModuleData"><a href="#5-7-RCTModuleData" class="headerlink" title="5.7 RCTModuleData"></a>5.7 RCTModuleData</h3><ul><li>加载和管理所有和JS有交互的原生代码。把需要和JS交互的代码按照一定的规则自动封装成JS模块</li><li>收集所有桥接模块的信息，供注入到JS运行环境</li></ul><h3 id="5-8-RCTModuleMethod"><a href="#5-8-RCTModuleMethod" class="headerlink" title="5.8 RCTModuleMethod"></a>5.8 RCTModuleMethod</h3><blockquote><p>记录所有原生代码的导出函数地址(JS里面是不能直接持有原生对象的)，同时生成对应的字符串映射到该函数地址。JS调用原生函数的时候会通过message的形式调用过来</p></blockquote><ul><li>记录所有的原生代码的函数地址，并且生成对应的字符串映射到该地址</li><li>记录所有的block的地址并且映射到唯一的一个id</li><li>翻译所有<code>J2N call</code>，然后执行对应的native方法</li></ul><blockquote><ul><li>如果是原生方法的调用则直接通过方法名调用，MessageQueue会帮忙把Method翻译成MethodID, 然后转发消息给原生代码，传递函数签名和参数给原生MessageQueue, 最终给RCTModuleMethod解析调用最终的方法</li><li>如果JS调用的是一个回调block，MessageQueue会把回调对象转化成一个一次性的block id, 然后传递给RCTModuleMethod, 最终由RCTModuleMethod解析调用。基本上和方法调用一样，只不过生命周期会不一样，block是动态生成的，要及时销毁，要不然会导致内存泄漏</li></ul></blockquote><blockquote><p>实际上是不存在原生MessageQueue对象模块的，JS的MessageQueue对应到原生层就是RCTModuleData &amp; RCTModuleMethod的组合, MessageQueue的到原生层的调用先经过RCTModuleData和RCTModuleMethod翻译成原生代码调用，然后执行</p></blockquote><h3 id="5-9-MessageQueue"><a href="#5-9-MessageQueue" class="headerlink" title="5.9 MessageQueue"></a>5.9 MessageQueue</h3><ul><li>这是核心中的核心。整个react native对浏览器内核是未做任何定制的，完全依赖浏览器内核的标准接口在运作。它怎么实现UI的完全定制的呢？它实际上未使用浏览器内核的任何UI绘制功能，注意是未使用UI绘制功能。它利用javascript引擎强大的DOM操作管理能力来管理所有UI节点，每次刷新前把所有节点信息更新完毕以后再给yoga做排版，然后再调用原生组件来绘制。javascript是整个系统的核心语言。</li><li>我们可以把浏览器看成一个盒子，javascript引擎是盒子里面的总管，DOM是javascript引擎内置的，javascript和javascript引擎也是无缝链接的。react native是怎么跳出这个盒子去调用外部原生组件来绘制UI的呢？秘密就在MessageQueue。</li><li>javascript引擎对原生代码的调用都是通过一套固定的接口来实现，这套接口的主要作用就是记录原生接口的地址和对应的javascript的函数名称，然后在javascript调用该函数的时候把调用转发给原生接口</li></ul><h2 id="六、React-Native-初始化"><a href="#六、React-Native-初始化" class="headerlink" title="六、React Native 初始化"></a>六、React Native 初始化</h2><blockquote><p><code>React Native</code>的初始化从<code>RootView</code>开始，默认在<code>AppDelegate.m:- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</code> 里面会有<code>RootViewd</code>的初始化逻辑，调试的时候可以从这里入手</p></blockquote><p><strong>React Native的初始化分为几个步骤</strong></p><ul><li>原生代码加载</li><li><code>JS Engine</code>初始化(生成一个空的JS引擎)</li><li>JS基础设施初始化. 主要是require等基本模块的加载并替换JS默认的实现。自定义<code>require</code>, <code>Warning window</code>, <code>Alert window</code>, <code>fetch</code>等都是在这里进行的。基础设施初始化好以后就可以开始加载js代码了</li><li>遍历加载所有要导出给JS用的原生模块和方法, 生成对应的JS模块信息，打包成json的格式给JS Engine, 准确地说是给MessageQueue. </li></ul><p><strong>这里需要提一下的是</strong></p><blockquote><p>这里的导出是没有对象的，只有方法和模块。JS不是一个标准的面向对象语言，刚从Java转JavaScript的同学都会在面向对象这个概念上栽跟头，这里特别提醒一下</p></blockquote><h3 id="6-1-原生代码初始化"><a href="#6-1-原生代码初始化" class="headerlink" title="6.1 原生代码初始化"></a>6.1 原生代码初始化</h3><blockquote><p>这里讨论的主要是RN相关的原生代码和用户自定义的RN模块的原生代码的加载和初始化。原生代码初始化主要分两步</p></blockquote><ul><li>静态加载。iOS没有动态加载原生代码的接口，所有的代码都在编译的初期就已经编译为静态代码并且链接好，程序启动的时候所有的原生代码都会加载好。这是原生代码的静态加载，iOS里面没有动态加载原生代码的概念，这也是为何没有静态代码热更新的原因</li><li>RN模块解析和注入JS。这是加载的第二步。在RootView初始化的时候会遍历所有被标记为RCTModule的原生模块，生成一个json格式的模块信息，里面包含模块名称和方法名称，然后注入到JS Engine, 由MessageQueue记录下来。原生代码在生成json模块信息的时候同时会在原生代码这边维护一个名称字典，用来把模块和方法的名称映射到原生代码的地址上去，用于JS调用原生代码的翻译</li></ul><h3 id="6-2-Javascript环境初始化"><a href="#6-2-Javascript环境初始化" class="headerlink" title="6.2 Javascript环境初始化"></a>6.2 Javascript环境初始化</h3><ul><li>RN的初始化是从RCRootView开始的，所有的绘制都会在这个RootView里面进行(Alert除外)</li><li>RootView做的第一件事情就是初始化一个空的JS Engine。 这个空的JS Engine里面包含一些最基础的模块和方法(fetch, require, alert等), 没有UI绘制模块。 RN的工作就是替换这些基础的模块和方法，然后把RN的UI绘制模块加载并注入到JS Engine.</li></ul><p><strong>JS Engine不直接管理UI的绘制</strong></p><ul><li>所有的绘制由原生控制的UI事件和Timer触发</li><li>影响界面刷新的事件发生以后一部分直接由原生控件消化掉，直接更新原生控件。剩下的部分会通过<code>Bridge</code>派发给MessageQueue，然后在JS层进行业务逻辑的计算，再由<code>React</code>来进行Virtual Dom的管理和更新。<code>Virtual Dom</code>再通过MessageQueue发送重绘指令给对应的原生组件进行UI更新</li></ul><h3 id="6-3-NativeModules加载"><a href="#6-3-NativeModules加载" class="headerlink" title="6.3 NativeModules加载"></a>6.3 NativeModules加载</h3><ul><li>在OC里面，所有NativeModules要加载进JS Engine都必须遵循一定的协议(protocol)。</li><li>模块(OC里面的类)需要声明为<rctbridgemodule>, 然后在类里面还必须调用宏RCT_EXPORT_MODULE() 用来定义一个接口告诉JS当前模块叫什么名字。这个宏可以接受一个可选的参数，指定模块名，不指定的情况下就取类名。</rctbridgemodule></li><li>对应的JS模块在初始化的时候会调用原生类的[xxx new]方法- 模块声明为<code>&lt;RCTBridgeModule&gt;</code>后只是告诉Native Modules这有一个原生模块，是一个空的模块。要导出任何方法给JS使用都必须手动用宏RCT_EXPORT_METHOD来导出方法给JS用.</li><li>所有的原生模块都会注册到<code>NativeModules</code>这一个JS模块下面去，你如果想要让自己的模块成为一个顶级模块就必须再写一个JS文件封装一遍NativeModules里面的方法。</li><li>你如果想自己的方法导出就默认成为顶级方法，那么你需要一个手动去调用JSC的接口，这个在前面章节有讲解。 不建议这样做，因为这样你会失去跨JS引擎的便利性。</li><li>你可以导出常量到JS里面去, 模块初始化的时候会坚持用户是否有实现<code>constantsToExport</code> 方法, 接受一个常量词典</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- (NSDictionary *)constantsToExport</span><br><span class="line">&#123;</span><br><span class="line">  return @&#123; @&quot;firstDayOfTheWeek&quot;: @&quot;Monday&quot; &#125;;// JS里面可以直接调用 ModuleName.firstDayOfTheWeek获取这个常量</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>常量只会在初始化的时候调用一次，动态修改该方法的返回值无效</li><li>所有标记为RCT_EXPORT_MODULE的模块都会在程序启动的时候自动注册好这些模块，主要是记录模块名和方法名。只是注册，不一定会初始化。</li><li><code>Native Modules</code>导出宏具体使用方法见官方文档<code>Native Modules</code></li></ul><h3 id="6-4-三个线程"><a href="#6-4-三个线程" class="headerlink" title="6.4 三个线程"></a>6.4 三个线程</h3><blockquote><p>React Native有三个重要的线程:</p></blockquote><ul><li>Shadow queue. 布局引擎(yoga)计算布局用的</li><li>Main thread. 主线程。就是操作系统的UI线程。无论是iOS还是android，一个进程都只有一个UI线程，我们常说的主线程. React Native所有UI绘制也是由同一个UI线程来维护</li><li><code>Javascript thread. javascript</code>线程。 大家都知道javascript是单线程模型，event驱动的异步模型。React Native用了JS引擎，所以也必需有一个独立的js 线程. 所有JS和原生代码的交互都发生在这个线程里。死锁，异常也最容易发生在这个线程</li></ul><blockquote><p>可以看到Shadow queue是queue而不是thread, 在iOS里面queue是thread之上的一层抽象,GCD里面的一个概念，创建queue的时候可以指定是并行的还是串行的。也就是说，一个queue可能对应多个thread</p></blockquote><h2 id="七、内部机制"><a href="#七、内部机制" class="headerlink" title="七、内部机制"></a>七、内部机制</h2><p><strong>内部机制</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/681.jpg" alt></p><p><strong>JS用时序</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/682.png" alt></p><h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><h3 id="8-1-React-Native-框架分析"><a href="#8-1-React-Native-框架分析" class="headerlink" title="8.1 React Native 框架分析"></a>8.1 React Native 框架分析</h3><p><img src="http://blog.poetries.top/img-repo/2019/10/683.png" alt></p><h3 id="8-2-层次架构"><a href="#8-2-层次架构" class="headerlink" title="8.2 层次架构"></a>8.2 层次架构</h3><ul><li><strong>Java层</strong>：该层主要提供了Android的UI渲染器<code>UIManager</code>（将JavaScript映射成<code>Android Widget</code>）以及一些其他的功能组件（例如：Fresco、Okhttp）等，在java层均封装为Module，java层核心jar包是react-native.jar，封装了众多上层的interface，如Module，Registry，bridge等</li><li><strong>C++层</strong>：主要处理Java与JavaScript的通信以及执行JavaScript代码工作，该层封装了JavaScriptCore，执行对js的解析。基于<code>JavaScriptCore</code>，<code>Web</code>开发者可以尽情使用ES6的新特性，如class、箭头操作符等，而且 React Native运行在<code>JavaScriptCore</code>中的，完全不存在浏览器兼容的情况。Bridge桥接了java ， js 通信的核心接口。JSLoader主要是将来自assets目录的或本地file加载javascriptCore，再通过<code>JSCExectutor</code>解析js文件</li><li><strong>Js层</strong>：该层提供了各种供开发者使用的组件以及一些工具库。<br><code>Component</code>：Js层通js/jsx编写的<code>Virtual Dom</code>来构建<code>Component</code>或Module，Virtual DOM是DOM在内存中的一种轻量级表达方式，可以通过不同的渲染引擎生成不同平台下的UI。component的使用在 React 里极为重要, 因为component的存在让计算 DOM diff 更高效。<br>ReactReconciler : 用于管理顶层组件或子组件的挂载、卸载、重绘</li></ul><blockquote><p>注：JSCore，即JavaScriptCore，JS解析的核心部分，IOS使用的是内置的<code>JavaScriptCore</code>，Androis上使用的是 <a href="https://webkit.org" target="_blank" rel="noopener">https://webkit.org</a> 家的jsc.so。</p></blockquote><p><strong>Java层核心类及原理，如下所示</strong></p><p><strong>ReactContext</strong></p><ul><li>ReactContext继承于ContextWrapper，是ReactNative应用的上下文，通过getContext()去获得，通过它可以访问ReactNative核心类的实现。</li></ul><p><strong>ReactInstanceManager</strong></p><ul><li><code>ReactInstanceManager</code>是ReactNative应用总的管理类，创建<code>ReactContext</code>、<code>CatalystInstance</code>等类，解析<code>ReactPackage</code>生成映射表，并且配合<code>ReactRootView</code>管理View的创建与生命周期等功能。</li></ul><p><strong>ReactRootView</strong></p><ul><li>为启动入口核心类，负责监听及分发事件并重新渲染元素，App启动后，其将作为App的<code>root view</code>。</li></ul><p><strong>CatalystInstance</strong></p><ul><li><code>CatalystInstance</code>是<code>ReactNative</code>应用Java层、C++层、JS层通信总管理类，总管Java层、JS层核心<code>Module</code>映射表与回调，三端通信的入口与桥梁。</li></ul><p><strong>JavaScriptModule</strong></p><ul><li><code>JavaScriptModule</code>是<code>JS Module</code>，负责JS到Java的映射调用格式声明，由<code>CatalystInstance</code>统一管理。</li></ul><p><strong>NativeModule</strong></p><ul><li><code>NativeModule</code>是<code>java Module</code>，负责Java到Js的映射调用格式声明，由<code>CatalystInstance</code>统一管理。</li></ul><p><strong>JavascriptModuleRegistry</strong></p><ul><li>JS Module映射表,负责将所有JavaScriptModule注册到CatalystInstance，通过Java动态代理调用到Js。</li></ul><p><strong>NativeModuleRegistry</strong></p><ul><li>是Java Module映射表,即暴露给Js的API集合。</li></ul><p><strong>CoreModulePackage</strong></p><ul><li>定义核心框架模块，创建<code>NativeModules&amp;JsModules</code></li></ul><h3 id="8-3-启动过程的解析"><a href="#8-3-启动过程的解析" class="headerlink" title="8.3 启动过程的解析"></a>8.3 启动过程的解析</h3><ol><li>ReactInstanceManager创建时会配置应用所需的java模块与js模块，通过ReactRootView的startReactApplication启动APP。</li><li>在创建ReactInstanceManager同时会创建用于加载JsBundle的JSBundlerLoader，并传递给CatalystInstance。</li><li>CatalystInstance会创建Java模块注册表及Javascript模块注册表，并遍历实例化模块。</li><li>CatalystInstance通过JSBundlerLoader向Node Server请求Js Bundle，并传递给JSCJavaScriptExectutor，最后传递给javascriptCore，再通过ReactBridge通知ReactRootView完成渲染</li></ol><h3 id="8-4-Js与Java通信机制"><a href="#8-4-Js与Java通信机制" class="headerlink" title="8.4 Js与Java通信机制"></a>8.4 Js与Java通信机制</h3><blockquote><p>Java与Js之间的调用，是以两边存在两边存在同一份模块配置表，最终均是将调用转化为{moduleID,methodID，callbackID，args}，处理端在模块配置表里查找注册的模块与方法并调用。</p></blockquote><p><strong>Java 调用Js</strong></p><blockquote><p>Java通过注册表调用到CatalystInstance实例，透过ReactBridge的jni，调用到Onload.cpp中的callFunction，最后通过javascriptCore，调用BatchedBridge.js，根据参数｛moduleID,methodID｝require相应Js模块执行。流程如下图：</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/684.png" alt></p><p><strong>Js 调用Java</strong></p><blockquote><p>如果消息队列中有等待Java 处理的逻辑，而且 Java 超过 5ms 都没有来取走，那么 JavaScript 就会主动调用 Java 的方法,在需要调用调Java模块方法时，会把参数｛moduleID,methodID｝等数据存在MessageQueue中，等待Java的事件触发，把MessageQueue中的｛moduleID,methodID｝返回给Java，再根据模块注册表找到相应模块处理。流程如下图：</p></blockquote><p><img src="http://blog.poetries.top/img-repo/2019/10/685.webp" alt></p><h2 id="九、更多参考"><a href="#九、更多参考" class="headerlink" title="九、更多参考"></a>九、更多参考</h2><ul><li><a href="https://juejin.im/post/5a6460f8f265da3e4f0a446d" target="_blank" rel="noopener">React Native for Android 原理分析与实践：实现原理</a></li><li><a href="https://www.jianshu.com/p/e220e1f34a0b" target="_blank" rel="noopener">深入剖析 JavaScriptCore</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、JavaScriptCore&quot;&gt;&lt;a href=&quot;#一、JavaScriptCore&quot; class=&quot;headerlink&quot; title=&quot;一、JavaScriptCore&quot;&gt;&lt;/a&gt;一、JavaScriptCore&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;讲
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="react" scheme="http://blog.poetries.top/tags/react/"/>
    
      <category term="RN" scheme="http://blog.poetries.top/tags/RN/"/>
    
  </entry>
  
  <entry>
    <title>React Native之启动流程</title>
    <link href="http://blog.poetries.top/2019/10/02/rn-start-progress/"/>
    <id>http://blog.poetries.top/2019/10/02/rn-start-progress/</id>
    <published>2019-10-02T07:40:12.000Z</published>
    <updated>2019-12-16T02:35:06.843Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><code>JS</code>程序的入口，将当前<code>APP</code>对象注册到<code>AppRegistry</code>组件中，<code>AppRegistry</code>组件是<code>js module</code></p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; AppRegistry &#125; <span class="keyword">from</span> <span class="string">'react-native'</span></span><br><span class="line"> ...省略代码</span><br><span class="line"></span><br><span class="line"> AppRegistry.registerComponent(<span class="string">'demo'</span>, () =&gt; Index)</span><br></pre></td></tr></table></figure><h2 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h2><ul><li>我们新建一个RN的项目，在原生代码中会生成<code>MainActivity</code>和<code>MainApplication</code>两个<code>Java</code>类。顾名思义，<code>MainAcitivity</code>就是我们的<code>Native</code>的入口了，</li><li>我们先来看下<code>MainApplication</code>都做了哪些操作</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> <span class="title">implements</span> <span class="title">ReactApplication</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ReactNativeHost：持有ReactInstanceManager实例，做一些初始化操作。</span></span><br><span class="line">  private final ReactNativeHost mReactNativeHost = <span class="keyword">new</span> ReactNativeHost(<span class="keyword">this</span>) &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean getUseDeveloperSupport() &#123;</span><br><span class="line">      <span class="keyword">return</span> BuildConfig.DEBUG;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected List&lt;ReactPackage&gt; getPackages() &#123;</span><br><span class="line">      <span class="keyword">return</span> Arrays.&lt;ReactPackage&gt;asList(</span><br><span class="line">          <span class="keyword">new</span> MainReactPackage()</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public ReactNativeHost getReactNativeHost() &#123;</span><br><span class="line">    <span class="keyword">return</span> mReactNativeHost;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public <span class="keyword">void</span> onCreate() &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    <span class="comment">//SoLoader：加载C++底层库，准备解析JS。</span></span><br><span class="line">    SoLoader.init(<span class="keyword">this</span>, <span class="comment">/* native exopackage */</span> <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们再来看下<code>MainActivity</code>的代码</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ReactActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected <span class="built_in">String</span> getMainComponentName() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"demo"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>可以看到其实是继承了<code>ReactActivity</code>类，只是重写了<code>getMainComponentName</code>方法，有没有看出来，其方法的返回值和我们在<code>JS</code>端的值是一样的。如果不一致会怎么样，你可以自己试一下。</p></blockquote><h2 id="ReactActivity"><a href="#ReactActivity" class="headerlink" title="ReactActivity"></a>ReactActivity</h2><blockquote><p>我们来看下<code>ReactActivity</code>的方法的<code>onCreate</code>方法</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">public abstract <span class="class"><span class="keyword">class</span> <span class="title">ReactActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></span><br><span class="line"><span class="class">    <span class="title">implements</span> <span class="title">DefaultHardwareBackBtnHandler</span>, <span class="title">PermissionAwareActivity</span> </span>&#123;</span><br><span class="line">    private final ReactActivityDelegate mDelegate;</span><br><span class="line"></span><br><span class="line">    ...省略代码</span><br><span class="line"></span><br><span class="line">     @Override</span><br><span class="line">  protected <span class="keyword">void</span> onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    mDelegate.onCreate(savedInstanceState);</span><br><span class="line">  &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>ReactActivity</code>全权委托给<code>ReactActivityDelegate</code>来处理</p></blockquote><p><strong>ReactActivityDelegate</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ReactActivityDelegate</span> </span>&#123;</span><br><span class="line">      protected <span class="keyword">void</span> onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">      <span class="comment">// 弹框权限判断</span></span><br><span class="line">    boolean needsOverlayPermission = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (getReactNativeHost().getUseDeveloperSupport() &amp;&amp; Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;</span><br><span class="line">      <span class="comment">// Get permission to show redbox in dev builds.</span></span><br><span class="line">      <span class="keyword">if</span> (!Settings.canDrawOverlays(getContext())) &#123;</span><br><span class="line">        needsOverlayPermission = <span class="literal">true</span>;</span><br><span class="line">        Intent serviceIntent = <span class="keyword">new</span> Intent(Settings.ACTION_MANAGE_OVERLAY_PERMISSION, Uri.parse(<span class="string">"package:"</span> + getContext().getPackageName()));</span><br><span class="line">        FLog.w(ReactConstants.TAG, REDBOX_PERMISSION_MESSAGE);</span><br><span class="line">        Toast.makeText(getContext(), REDBOX_PERMISSION_MESSAGE, Toast.LENGTH_LONG).show();</span><br><span class="line">        ((Activity) getContext()).startActivityForResult(serviceIntent, REQUEST_OVERLAY_PERMISSION_CODE);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">// 加载组建逻辑 mMainComponentName为getMainComponentName返回的值</span></span><br><span class="line">    <span class="keyword">if</span> (mMainComponentName != <span class="literal">null</span> &amp;&amp; !needsOverlayPermission) &#123;</span><br><span class="line">      loadApp(mMainComponentName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 双击判断工具类</span></span><br><span class="line">    mDoubleTapReloadRecognizer = <span class="keyword">new</span> DoubleTapReloadRecognizer();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  protected <span class="keyword">void</span> loadApp(<span class="built_in">String</span> appKey) &#123;</span><br><span class="line">     <span class="comment">//空判断</span></span><br><span class="line">    <span class="keyword">if</span> (mReactRootView != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Cannot loadApp while app is already running."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建 RN容器根视图</span></span><br><span class="line">    mReactRootView = createRootView();</span><br><span class="line">    mReactRootView.startReactApplication(</span><br><span class="line">      getReactNativeHost().getReactInstanceManager(),</span><br><span class="line">      appKey,</span><br><span class="line">      getLaunchOptions());</span><br><span class="line">      <span class="comment">//将rootview添加入activity</span></span><br><span class="line">    getPlainActivity().setContentView(mReactRootView);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>loadApp</code>做了三件事:创建<code>RootView</code>、创建<code>ReactApplication</code>、创建<code>ReactInstanceManager</code></p></blockquote><h2 id="ReactRootView"><a href="#ReactRootView" class="headerlink" title="ReactRootView"></a>ReactRootView</h2><blockquote><p>ReactRootView是一个自定义的View，其父类是FrameLayout。因此，可以把RN看成是一个特殊的 “自定义View”。</p></blockquote><blockquote><p>我们来看下<code>startReactApplication</code>方法</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">void</span> startReactApplication(</span><br><span class="line">      ReactInstanceManager reactInstanceManager,</span><br><span class="line">      <span class="built_in">String</span> moduleName,</span><br><span class="line">      @Nullable Bundle initialProperties) &#123;</span><br><span class="line">        ...省略代码</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//在UI线程中进行</span></span><br><span class="line">      UiThreadUtil.assertOnUiThread();</span><br><span class="line"></span><br><span class="line">      Assertions.assertCondition(</span><br><span class="line">        mReactInstanceManager == <span class="literal">null</span>,</span><br><span class="line">        <span class="string">"This root view has already been attached to a catalyst instance manager"</span>);</span><br><span class="line">        <span class="comment">// 赋值</span></span><br><span class="line">      mReactInstanceManager = reactInstanceManager;</span><br><span class="line">      mJSModuleName = moduleName;</span><br><span class="line">      mAppProperties = initialProperties;</span><br><span class="line">        <span class="comment">// 判断ReactContext是否初始化，没有就异步进行初始化</span></span><br><span class="line">      <span class="keyword">if</span> (!mReactInstanceManager.hasStartedCreatingInitialContext()) &#123;</span><br><span class="line">        mReactInstanceManager.createReactContextInBackground();</span><br><span class="line">      &#125;</span><br><span class="line">        <span class="comment">//宽高计算完成后添加布局监听</span></span><br><span class="line">      attachToReactInstanceManager();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>startReactApplication</code>中的三个参数</p></blockquote><table><thead><tr><th>形参</th><th>描述</th></tr></thead><tbody><tr><td><code>reactInstanceManager</code></td><td><code>ReactInstanceManager</code>类型，创建和管理<code>CatalyInstance</code>的实例</td></tr><tr><td><code>moduleName</code></td><td>就是之前的组件名</td></tr><tr><td><code>initialProperties</code></td><td>是<code>Native</code>向JS传递的数据，以后可能由POJO代替，默认是<code>null</code>，需要的话要重写<code>createReactActivityDelegate</code> ，并重写其中<code>getLaunchOptions</code>方法</td></tr></tbody></table><blockquote><p><code>startReactApplication</code> 中调用了<code>ReactInstanceManager</code>的<code>createReactContextInBackground</code>方法。</p></blockquote><h2 id="ReactInstanceManager"><a href="#ReactInstanceManager" class="headerlink" title="ReactInstanceManager"></a>ReactInstanceManager</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">void</span> createReactContextInBackground() &#123;</span><br><span class="line">    <span class="comment">//首次执行</span></span><br><span class="line">     mHasStartedCreatingInitialContext = <span class="literal">true</span>;</span><br><span class="line">    recreateReactContextInBackgroundInner();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该方法只会在<code>application</code>中执行一次，JS重载时，会走<code>recreateReactContextInBackground</code>, 这两个方法最终都会调用<code>recreateReactContextInBackgroundInner</code>方法</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">@ThreadConfined(UI)</span><br><span class="line">  private <span class="keyword">void</span> recreateReactContextInBackgroundInner() &#123;</span><br><span class="line">    <span class="comment">// 确保在UI线程中执行</span></span><br><span class="line">    UiThreadUtil.assertOnUiThread();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mUseDeveloperSupport &amp;&amp; mJSMainModuleName != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">      !Systrace.isTracing(TRACE_TAG_REACT_APPS | TRACE_TAG_REACT_JSC_CALLS)) &#123;</span><br><span class="line">        <span class="comment">// 调试模式，加载服务器bundle</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 加载本地bundle</span></span><br><span class="line">    recreateReactContextInBackgroundFromBundleLoader();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @ThreadConfined(UI)</span><br><span class="line">  private <span class="keyword">void</span> recreateReactContextInBackgroundFromBundleLoader() &#123;</span><br><span class="line">    recreateReactContextInBackground(</span><br><span class="line">        <span class="keyword">new</span> JSCJavaScriptExecutor.Factory(mJSCConfig.getConfigMap()),</span><br><span class="line">        mBundleLoader);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>形参</th><th>描述</th></tr></thead><tbody><tr><td><code>jsExecutorFactory</code></td><td>C++和JS双向通信的中转站</td></tr><tr><td><code>jsBundleLoader</code></td><td><code>bundle</code>加载器，根据<code>ReactNativeHost</code>中的配置决定从哪里加载<code>bundle</code>文件</td></tr></tbody></table><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">private <span class="keyword">void</span> recreateReactContextInBackground(</span><br><span class="line">    JavaScriptExecutor.Factory jsExecutorFactory,</span><br><span class="line">    JSBundleLoader jsBundleLoader) &#123;</span><br><span class="line">    UiThreadUtil.assertOnUiThread();</span><br><span class="line"></span><br><span class="line">     <span class="comment">//创建ReactContextInitParams对象</span></span><br><span class="line">    final ReactContextInitParams initParams = <span class="keyword">new</span> ReactContextInitParams(</span><br><span class="line">      jsExecutorFactory,</span><br><span class="line">      jsBundleLoader);</span><br><span class="line">    <span class="keyword">if</span> (mCreateReactContextThread == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 新增线程初始化ReactContext</span></span><br><span class="line">      runCreateReactContextOnNewThread(initParams);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      mPendingReactContextInitParams = initParams;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>runCreateReactContextOnNewThread</code>中有一个核心方法<code>createReactContext</code>来创建<code>ReactContext</code></p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">private ReactApplicationContext createReactContext(</span><br><span class="line">      JavaScriptExecutor jsExecutor,</span><br><span class="line">      JSBundleLoader jsBundleLoader) &#123;</span><br><span class="line">    <span class="comment">// 包装ApplicationContext</span></span><br><span class="line">    final ReactApplicationContext reactContext = <span class="keyword">new</span> ReactApplicationContext(mApplicationContext);</span><br><span class="line">    <span class="comment">//创建JavaModule注册表Builder，用来创建JavaModule注册表，JavaModule注册表将所有的JavaModule注册到CatalystInstance中。</span></span><br><span class="line">    NativeModuleRegistryBuilder nativeModuleRegistryBuilder = <span class="keyword">new</span> NativeModuleRegistryBuilder(</span><br><span class="line">      reactContext,</span><br><span class="line">      <span class="keyword">this</span>,</span><br><span class="line">      mLazyNativeModulesEnabled);</span><br><span class="line">      <span class="comment">// 创建JavaScriptModule注册表Builder</span></span><br><span class="line">    JavaScriptModuleRegistry.Builder jsModulesBuilder = <span class="keyword">new</span> JavaScriptModuleRegistry.Builder();</span><br><span class="line">    <span class="keyword">if</span> (mUseDeveloperSupport) &#123;</span><br><span class="line">      <span class="comment">// 调试模式下，将错误交给DevSupportManager处理</span></span><br><span class="line">      reactContext.setNativeModuleCallExceptionHandler(mDevSupportManager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...省略代码</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//创建CoreModulesPackage，其中封装了RN Framework核心功能，通信、调试等。</span></span><br><span class="line">      CoreModulesPackage coreModulesPackage =</span><br><span class="line">        <span class="keyword">new</span> CoreModulesPackage(</span><br><span class="line">          <span class="keyword">this</span>,</span><br><span class="line">          mBackBtnHandler,</span><br><span class="line">          mUIImplementationProvider,</span><br><span class="line">          mLazyViewManagersEnabled);</span><br><span class="line">          <span class="comment">//把各自的Module添加到对应的注册表中</span></span><br><span class="line">      processPackage(coreModulesPackage, nativeModuleRegistryBuilder, jsModulesBuilder);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将我们Application中的ReactPackage循环处理，加入对应的注册表中。</span></span><br><span class="line">   <span class="keyword">for</span> (ReactPackage reactPackage : mPackages) &#123;</span><br><span class="line">        ...省略代码</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        processPackage(reactPackage, nativeModuleRegistryBuilder, jsModulesBuilder);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...省略代码</span><br><span class="line">    <span class="comment">//生成Java注册表，将Java可调用的API暴露给JS</span></span><br><span class="line">    NativeModuleRegistry nativeModuleRegistry;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">       nativeModuleRegistry = nativeModuleRegistryBuilder.build();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);</span><br><span class="line">      ReactMarker.logMarker(BUILD_NATIVE_MODULE_REGISTRY_END);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    NativeModuleCallExceptionHandler exceptionHandler = mNativeModuleCallExceptionHandler != <span class="literal">null</span></span><br><span class="line">        ? mNativeModuleCallExceptionHandler</span><br><span class="line">        : mDevSupportManager;</span><br><span class="line">     <span class="comment">//构建CatalystInstanceImpl实例</span></span><br><span class="line">    CatalystInstanceImpl.Builder catalystInstanceBuilder = <span class="keyword">new</span> CatalystInstanceImpl.Builder()</span><br><span class="line">      .setReactQueueConfigurationSpec(mUseSeparateUIBackgroundThread ?</span><br><span class="line">        ReactQueueConfigurationSpec.createWithSeparateUIBackgroundThread() :</span><br><span class="line">        ReactQueueConfigurationSpec.createDefault())</span><br><span class="line">        <span class="comment">//JS执行通信类</span></span><br><span class="line">      .setJSExecutor(jsExecutor)</span><br><span class="line">      <span class="comment">//Java模块注册表</span></span><br><span class="line">      .setRegistry(nativeModuleRegistry)</span><br><span class="line">      <span class="comment">// JS注册表</span></span><br><span class="line">      .setJSModuleRegistry(jsModulesBuilder.build())</span><br><span class="line">      <span class="comment">// Bundle加载工具类</span></span><br><span class="line">      .setJSBundleLoader(jsBundleLoader)</span><br><span class="line">      <span class="comment">// 异常处理器</span></span><br><span class="line">      .setNativeModuleCallExceptionHandler(exceptionHandler);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略代码</span></span><br><span class="line"></span><br><span class="line">   final CatalystInstance catalystInstance;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      catalystInstance = catalystInstanceBuilder.build();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//省略代码</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mBridgeIdleDebugListener != <span class="literal">null</span>) &#123;</span><br><span class="line">      catalystInstance.addBridgeIdleDebugListener(mBridgeIdleDebugListener);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (Systrace.isTracing(TRACE_TAG_REACT_APPS | TRACE_TAG_REACT_JSC_CALLS)) &#123;</span><br><span class="line"> <span class="comment">//调用CatalystInstanceImpl的Native方法把Java Registry转换为Json，再由C++层传送到JS层。     catalystInstance.setGlobalVariable("__RCTProfileIsProfiling", "true");</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关联ReacContext与CatalystInstance</span></span><br><span class="line">    reactContext.initializeWithInstance(catalystInstance);</span><br><span class="line">    <span class="comment">//通过CatalystInstance开始加载JS Bundle</span></span><br><span class="line">    catalystInstance.runJSBundle();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> reactContext;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>这段代码比较长，它主要做了这几件事：</p></blockquote><ul><li>创建<code>JavaModule</code>注册表和<code>JavaScriptModule</code>注册表，交给<code>CatalystInstance</code>管理。</li><li>处理<code>ReactPackage</code>，将各自的<code>Module</code>放入对应的注册表中。</li><li>通过上面的各个参数创建<code>CatalystInstance</code>实例。<br><code>CatalystInstance</code>关联<code>ReactContext</code>，开始加载<code>JS Bundle</code></li></ul><h2 id="CatalystInstance"><a href="#CatalystInstance" class="headerlink" title="CatalystInstance"></a>CatalystInstance</h2><blockquote><p>我们来看下<code>CatalystInstance</code>的实现类<code>CatalystInstanceImpl</code>的构造方法</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">private CatalystInstanceImpl(</span><br><span class="line">      final ReactQueueConfigurationSpec reactQueueConfigurationSpec,</span><br><span class="line">      final JavaScriptExecutor jsExecutor,</span><br><span class="line">      final NativeModuleRegistry registry,</span><br><span class="line">      final JavaScriptModuleRegistry jsModuleRegistry,</span><br><span class="line">      final JSBundleLoader jsBundleLoader,</span><br><span class="line">      NativeModuleCallExceptionHandler nativeModuleCallExceptionHandler) &#123;</span><br><span class="line">    <span class="comment">//用来创建JNI相关方法，并返回mHybridData</span></span><br><span class="line">    mHybridData = initHybrid();</span><br><span class="line">    <span class="comment">// Android UI线程、JS线程、NativeMOdulesQueue线程</span></span><br><span class="line">    mReactQueueConfiguration = ReactQueueConfigurationImpl.create(</span><br><span class="line">        reactQueueConfigurationSpec,</span><br><span class="line">        <span class="keyword">new</span> NativeExceptionHandler());</span><br><span class="line">    <span class="comment">// 省略代码</span></span><br><span class="line">    <span class="comment">//调用 C++ 层代码进行初始化Bridge</span></span><br><span class="line">    initializeBridge(</span><br><span class="line">      <span class="keyword">new</span> BridgeCallback(<span class="keyword">this</span>),</span><br><span class="line">      jsExecutor,</span><br><span class="line">      mReactQueueConfiguration.getJSQueueThread(),</span><br><span class="line">      mNativeModulesQueueThread,</span><br><span class="line">      mUIBackgroundQueueThread,</span><br><span class="line">      mJavaRegistry.getJavaModules(<span class="keyword">this</span>),</span><br><span class="line">      mJavaRegistry.getCxxModules());</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">private native <span class="keyword">void</span> initializeBridge(</span><br><span class="line">      ReactCallback callback,</span><br><span class="line">      JavaScriptExecutor jsExecutor,</span><br><span class="line">      MessageQueueThread jsQueue,</span><br><span class="line">      MessageQueueThread moduleQueue,</span><br><span class="line">      MessageQueueThread uiBackgroundQueue,</span><br><span class="line">      Collection&lt;JavaModuleWrapper&gt; javaModules,</span><br><span class="line">      Collection&lt;ModuleHolder&gt; cxxModules);</span><br></pre></td></tr></table></figure><table><thead><tr><th>形参</th><th>描述</th></tr></thead><tbody><tr><td><code>ReactCallback</code></td><td>CatalystInstanceImpl的静态内部类<code>ReactCallback</code>，负责接口回调</td></tr><tr><td><code>JavaScriptExecutor</code></td><td>JS执行器，将JS的调用传给C++层</td></tr><tr><td><code>MessageQueueThread</code></td><td><code>JS</code>线程</td></tr><tr><td><code>MessageQueueThread moduleQueue</code></td><td><code>Java</code>线程</td></tr><tr><td><code>MessageQueueThread uiBackgroundQueue</code></td><td><code>UI</code>背景线程</td></tr><tr><td><code>javaModules</code></td><td><code>java module</code></td></tr><tr><td><code>cxxModules</code></td><td><code>c++ module</code></td></tr></tbody></table><blockquote><p><code>createReactContext</code>方法中用<code>catalystInstance.runJSBundle()</code> 来加载 <code>JS bundle</code></p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">  public <span class="keyword">void</span> runJSBundle() &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    mJSBundleLoader.loadScript(CatalystInstanceImpl.this);</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="JSBundleLoader"><a href="#JSBundleLoader" class="headerlink" title="JSBundleLoader"></a>JSBundleLoader</h2><blockquote><p><code>CatalystInstanceImpl.runJSBundle()</code>会调用<code>JSBundleLoader</code>去加载<code>JS Bundle</code>，由于不同的情况可能会有不同的<code>JSBundleLoader</code>，我们假设其中一种</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">public abstract <span class="class"><span class="keyword">class</span> <span class="title">JSBundleLoader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * This loader is recommended one for release version of your app. In that case local JS executor</span></span><br><span class="line"><span class="comment">   * should be used. JS bundle will be read from assets in native code to save on passing large</span></span><br><span class="line"><span class="comment">   * strings from java to native memory.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  public <span class="keyword">static</span> JSBundleLoader createAssetLoader(</span><br><span class="line">      final Context context,</span><br><span class="line">      final <span class="built_in">String</span> assetUrl,</span><br><span class="line">      final boolean loadSynchronously) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> JSBundleLoader() &#123;</span><br><span class="line">      @Override</span><br><span class="line">      public <span class="built_in">String</span> loadScript(CatalystInstanceImpl instance) &#123;</span><br><span class="line">        instance.loadScriptFromAssets(context.getAssets(), assetUrl, loadSynchronously);</span><br><span class="line">        <span class="keyword">return</span> assetUrl;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>可以看到它会继续调用<code>CatalystInstance</code>中的<code>loadScriptFromAssets</code>方法</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">CatalystInstanceImpl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* package */</span> <span class="keyword">void</span> loadScriptFromAssets(AssetManager assetManager, <span class="built_in">String</span> assetURL) &#123;</span><br><span class="line">    mSourceURL = assetURL;</span><br><span class="line">    jniLoadScriptFromAssets(assetManager, assetURL);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private native <span class="keyword">void</span> jniLoadScriptFromAssets(AssetManager assetManager, <span class="built_in">String</span> assetURL);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>最终呢，还是会调用<code>CatalystInstanceImpl.cpp</code>去加载<code>JS Bundle</code>，我们去<code>C++</code>层看一下实现</p></blockquote><p>我们先看下源码的结构图</p><p><img src="http://blog.poetries.top/img-repo/2019/10/677.png" alt></p><h2 id="CatalystInstanceImpl-cpp"><a href="#CatalystInstanceImpl-cpp" class="headerlink" title="CatalystInstanceImpl.cpp"></a>CatalystInstanceImpl.cpp</h2><blockquote><p>在ReactAndroid的Jni中，我们看下相关代码：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> CatalystInstanceImpl::jniLoadScriptFromAssets(</span><br><span class="line">    jni::alias_ref&lt;JAssetManager::javaobject&gt; assetManager,</span><br><span class="line">    <span class="keyword">const</span> std::string&amp; assetURL,</span><br><span class="line">    bool loadSynchronously) &#123;</span><br><span class="line">  <span class="keyword">const</span> int kAssetsLength = <span class="number">9</span>;  <span class="comment">// strlen("assets://");</span></span><br><span class="line">  <span class="comment">// 获取soure js Bundle的路径名</span></span><br><span class="line">  auto sourceURL = assetURL.substr(kAssetsLength);</span><br><span class="line">  <span class="comment">// 获取AssetManager</span></span><br><span class="line">  auto manager = extractAssetManager(assetManager);</span><br><span class="line">  <span class="comment">// 读取JS Bundle里的内容</span></span><br><span class="line">  auto script = loadScriptFromAssets(manager, sourceURL);</span><br><span class="line">  <span class="comment">// unbundle命令打包判断</span></span><br><span class="line">  <span class="keyword">if</span> (JniJSModulesUnbundle::isUnbundle(manager, sourceURL)) &#123;</span><br><span class="line">    instance_-&gt;loadUnbundle(</span><br><span class="line">      folly::make_unique&lt;JniJSModulesUnbundle&gt;(manager, sourceURL),</span><br><span class="line">      std::move(script),</span><br><span class="line">      sourceURL,</span><br><span class="line">      loadSynchronously);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//bundle命令打包走次流程，instance_是Instan.h中类的实例</span></span><br><span class="line">    instance_-&gt;loadScriptFromString(std::move(script), sourceURL, loadSynchronously);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Instance-cpp"><a href="#Instance-cpp" class="headerlink" title="Instance.cpp"></a>Instance.cpp</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> Instance::loadScriptFromString(std::unique_ptr&lt;<span class="keyword">const</span> JSBigString&gt; string,</span><br><span class="line">                                    std::string sourceURL,</span><br><span class="line">                                    bool loadSynchronously) &#123;</span><br><span class="line">  SystraceSection s(<span class="string">"reactbridge_xplat_loadScriptFromString"</span>, <span class="string">"sourceURL"</span>, sourceURL);</span><br><span class="line">  <span class="keyword">if</span> (loadSynchronously) &#123;</span><br><span class="line">    loadApplicationSync(nullptr, <span class="attr">std</span>::move(string), <span class="attr">std</span>::move(sourceURL));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    loadApplication(nullptr, <span class="attr">std</span>::move(string), <span class="attr">std</span>::move(sourceURL));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Instance::loadApplicationSync(</span><br><span class="line">    std::unique_ptr&lt;JSModulesUnbundle&gt; unbundle,</span><br><span class="line">    std::unique_ptr&lt;<span class="keyword">const</span> JSBigString&gt; string,</span><br><span class="line">    std::string sourceURL) &#123;</span><br><span class="line">  std::unique_lock&lt;std::mutex&gt; lock(m_syncMutex);</span><br><span class="line">  m_syncCV.wait(lock, [<span class="keyword">this</span>] &#123; <span class="keyword">return</span> m_syncReady; &#125;);</span><br><span class="line"></span><br><span class="line">  SystraceSection s(<span class="string">"reactbridge_xplat_loadApplicationSync"</span>, <span class="string">"sourceURL"</span>, sourceURL);</span><br><span class="line">  <span class="comment">//nativeToJsBridge_也是在Instance::initializeBridget()方法里初始化的，具体实现在NativeToJsBridge.cpp里。</span></span><br><span class="line">  nativeToJsBridge_-&gt;loadApplicationSync(std::move(unbundle), <span class="attr">std</span>::move(string), <span class="attr">std</span>::move(sourceURL));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>NativeToJsBridge.cpp</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> NativeToJsBridge::loadApplication(</span><br><span class="line">    std::unique_ptr&lt;JSModulesUnbundle&gt; unbundle,</span><br><span class="line">    std::unique_ptr&lt;<span class="keyword">const</span> JSBigString&gt; startupScript,</span><br><span class="line">    std::string startupScriptSourceURL) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取一个MessageQueueThread，探后在线程中执行一个Task。</span></span><br><span class="line">  runOnExecutorQueue(</span><br><span class="line">      m_mainExecutorToken,</span><br><span class="line">      [unbundleWrap=folly::makeMoveWrapper(std::move(unbundle)),</span><br><span class="line">       startupScript=folly::makeMoveWrapper(std::move(startupScript)),</span><br><span class="line">       startupScriptSourceURL=std::move(startupScriptSourceURL)]</span><br><span class="line">        (JSExecutor* executor) mutable &#123;</span><br><span class="line"></span><br><span class="line">    auto unbundle = unbundleWrap.move();</span><br><span class="line">    <span class="keyword">if</span> (unbundle) &#123;</span><br><span class="line">      executor-&gt;setJSModulesUnbundle(std::move(unbundle));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//executor从runOnExecutorQueue()返回的map中取得，与OnLoad中的JSCJavaScriptExecutorHolder对应，也与</span></span><br><span class="line">    <span class="comment">//Java中的JSCJavaScriptExecutor对应。它的实例在JSExecutor.cpp中实现。</span></span><br><span class="line">    executor-&gt;loadApplicationScript(std::move(*startupScript),</span><br><span class="line">                                    std::move(startupScriptSourceURL));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>unbundle命令，使用方式和bundle命令完全相同。unbundle命令是在bundle命令的基础上增加了一项功能，除了生成整合JS文件index.android.bundle外，还会<br>生成各个单独的未整合JS文件（但会被优化），全部放在js-modules目录下，同时会生成一个名为UNBUNDLE的标识文件，一并放在其中。UNBUNDLE标识文件的前4个字节<br>固定为0xFB0BD1E5，用于加载前的校验。</p></blockquote><ul><li>该函数进一步调用<code>JSExecutor.cpp</code>的<code>loadApplicationScript()</code>方法。</li><li>到了这个方法，就是去真正加载JS文件了。</li></ul><p><strong>JSCExecutor.cpp</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> JSCExecutor::loadApplicationScript(std::unique_ptr&lt;<span class="keyword">const</span> JSBigString&gt; script, <span class="attr">std</span>::string sourceURL) &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//使用Webkit JSC去解释执行JS</span></span><br><span class="line">    evaluateSourceCode(m_context, bcSourceCode, jsSourceURL);</span><br><span class="line">    flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> JSCExecutor::flush() &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//绑定bridge，核心就是通过getGlobalObject()将JS与C++通过Webkit jSC实现绑定</span></span><br><span class="line">      bindBridge();</span><br><span class="line">      <span class="comment">//返回给callNativeModules</span></span><br><span class="line">    callNativeModules(m_flushedQueueJS-&gt;callAsFunction(&#123;&#125;));</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> JSCExecutor::callNativeModules(Value&amp;&amp; value) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//把JS层相关通信数据转换为JSON格式</span></span><br><span class="line">    auto calls = value.toJSONString();</span><br><span class="line">    <span class="comment">//m_delegate为JsToNativeBridge对象。</span></span><br><span class="line">    m_delegate-&gt;callNativeModules(*<span class="keyword">this</span>, <span class="attr">folly</span>::parseJson(calls), <span class="literal">true</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>m_flushedQueueJS</code>支线的是<code>MessageQueue.js</code>的<code>flushedQueue()</code>方法，此时JS已经被加载到队列中，等待Java层来驱动它。</li><li><code>JS Bundle</code>加载并解析完成后，我们回到Java代码中看看后续的流程</li><li>我们在之前的<code>runCreateReactContextOnNewThread</code>方法中，在<code>creatReactContext</code>之后还有一句核心的代码</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">setupReactContext(reactApplicationContext);</span><br></pre></td></tr></table></figure><blockquote><p>这就是加载<code>JS Bundle</code>之后执行的代码</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ReactInstanceManager</span> </span>&#123;</span><br><span class="line">    private <span class="keyword">void</span> setupReactContext(ReactApplicationContext reactContext) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// Native Java module初始化</span></span><br><span class="line">    catalystInstance.initialize();</span><br><span class="line">    <span class="comment">//重置ReactContext </span></span><br><span class="line">    mDevSupportManager.onNewReactContextCreated(reactContext);</span><br><span class="line">   <span class="comment">//内存状态回调设置 mMemoryPressureRouter.addMemoryPressureListener(catalystInstance);</span></span><br><span class="line">    <span class="comment">// 复位生命周期</span></span><br><span class="line">    moveReactContextToCurrentLifecycleState();</span><br><span class="line"></span><br><span class="line">    ReactMarker.logMarker(ATTACH_MEASURED_ROOT_VIEWS_START);</span><br><span class="line">    synchronized (mAttachedRootViews) &#123;</span><br><span class="line">    <span class="comment">//mAttachedRootViews保存的是ReactRootView</span></span><br><span class="line">      <span class="keyword">for</span> (ReactRootView rootView : mAttachedRootViews) &#123;</span><br><span class="line">        attachRootViewToInstance(rootView, catalystInstance);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private <span class="keyword">void</span> attachMeasuredRootViewToInstance (     final ReactRootView rootView,</span><br><span class="line">      CatalystInstance catalystInstance) &#123;</span><br><span class="line">      ...</span><br><span class="line">            <span class="comment">//将ReactRootView作为根布局</span></span><br><span class="line">    UIManagerModule uiManagerModule = catalystInstance.getNativeModule(UIManagerModule.class);</span><br><span class="line">    int rootTag = uiManagerModule.addMeasuredRootView(rootView);</span><br><span class="line">    <span class="comment">//设置相关</span></span><br><span class="line">    rootView.setRootViewTag(rootTag);</span><br><span class="line">    rootView.runApplication();</span><br><span class="line">    ...</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* package */</span> <span class="keyword">void</span> runApplication() &#123;</span><br><span class="line">       ...</span><br><span class="line">     CatalystInstance catalystInstance = reactContext.getCatalystInstance();</span><br><span class="line"></span><br><span class="line">     WritableNativeMap appParams = <span class="keyword">new</span> WritableNativeMap();</span><br><span class="line">     appParams.putDouble(<span class="string">"rootTag"</span>, getRootViewTag());</span><br><span class="line">     @Nullable Bundle appProperties = getAppProperties();</span><br><span class="line">     <span class="keyword">if</span> (appProperties != <span class="literal">null</span>) &#123;</span><br><span class="line">       appParams.putMap(<span class="string">"initialProps"</span>, Arguments.fromBundle(appProperties));</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">String</span> jsAppModuleName = getJSModuleName();</span><br><span class="line">     <span class="comment">//启动流程入口：由Java层调用启动</span></span><br><span class="line">     catalystInstance.getJSModule(AppRegistry.class).runApplication(jsAppModuleName, appParams);</span><br><span class="line">     ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>可以看到，最终调用的是<code>catalystInstance.getJSModule(AppRegistry.class).runApplication(jsAppModuleName, appParams)</code>， <code>AppRegistry.class</code>是JS层暴露给Java层的接口方法。它的真正实现在<code>AppRegistry.js</code>里，<code>AppRegistry.js</code>是运行所有<code>RN</code>应用的<code>JS</code>层入口，我们来看看它的实现：</p></blockquote><ul><li><strong>在<code>Libraries/ReactNative</code>中的<code>AppRegistry.js</code></strong></li></ul><h2 id="AppRegistry-js"><a href="#AppRegistry-js" class="headerlink" title="AppRegistry.js"></a>AppRegistry.js</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">runApplication(appKey: string, <span class="attr">appParameters</span>: any): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> msg =</span><br><span class="line">      <span class="string">'Running application "'</span> + appKey + <span class="string">'" with appParams: '</span> +</span><br><span class="line">      <span class="built_in">JSON</span>.stringify(appParameters) + <span class="string">'. '</span> +</span><br><span class="line">      <span class="string">'__DEV__ === '</span> + <span class="built_in">String</span>(__DEV__) +</span><br><span class="line">      <span class="string">', development-level warning are '</span> + (__DEV__ ? <span class="string">'ON'</span> : <span class="string">'OFF'</span>) +</span><br><span class="line">      <span class="string">', performance optimizations are '</span> + (__DEV__ ? <span class="string">'OFF'</span> : <span class="string">'ON'</span>);</span><br><span class="line">    infoLog(msg);</span><br><span class="line">    BugReporting.addSource(<span class="string">'AppRegistry.runApplication'</span> + runCount++, () =&gt; msg);</span><br><span class="line">    invariant(</span><br><span class="line">      runnables[appKey] &amp;&amp; runnables[appKey].run,</span><br><span class="line">      <span class="string">'Application '</span> + appKey + <span class="string">' has not been registered.\n\n'</span> +</span><br><span class="line">      <span class="string">'Hint: This error often happens when you\'re running the packager '</span> +</span><br><span class="line">      <span class="string">'(local dev server) from a wrong folder. For example you have '</span> +</span><br><span class="line">      <span class="string">'multiple apps and the packager is still running for the app you '</span> +</span><br><span class="line">      <span class="string">'were working on before.\nIf this is the case, simply kill the old '</span> +</span><br><span class="line">      <span class="string">'packager instance (e.g. close the packager terminal window) '</span> +</span><br><span class="line">      <span class="string">'and start the packager in the correct app folder (e.g. cd into app '</span> +</span><br><span class="line">      <span class="string">'folder and run \'npm start\').\n\n'</span> +</span><br><span class="line">      <span class="string">'This error can also happen due to a require() error during '</span> +</span><br><span class="line">      <span class="string">'initialization or failure to call AppRegistry.registerComponent.\n\n'</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    SceneTracker.setActiveScene(&#123;<span class="attr">name</span>: appKey&#125;);</span><br><span class="line">    runnables[appKey].run(appParameters);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li>到这里就会去调用JS进行渲染，在通过<code>UIManagerModule</code>将JS组件转换成Android组件，最终显示在<code>ReactRootView</code>上。</li><li>最后总结一下，就是先在应用终端启动并创建上下文对象，启动<code>JS Runtime</code>，进行布局，将JS端的代码通过C++层，<code>UIManagerMoodule</code>转化成<code>Android</code>组件，再进行渲染，最后将渲染的View添加到<code>ReactRootView</code>上，最终呈现在用户面前。</li></ul><h2 id="系统框架图"><a href="#系统框架图" class="headerlink" title="系统框架图"></a>系统框架图</h2><p><img src="http://blog.poetries.top/img-repo/2019/10/678.png" alt></p><h2 id="启动流程图"><a href="#启动流程图" class="headerlink" title="启动流程图"></a>启动流程图</h2><p><img src="http://blog.poetries.top/img-repo/2019/10/679.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;JS&lt;/code&gt;程序的入口，将当前&lt;code&gt;APP&lt;/code&gt;对象注册到&lt;code&gt;AppRegistry&lt;/code&gt;组件中，&lt;code&gt;AppRegistry&lt;/code&gt;组件是&lt;code&gt;js module&lt;/code&gt;&lt;/
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="react" scheme="http://blog.poetries.top/tags/react/"/>
    
      <category term="RN" scheme="http://blog.poetries.top/tags/RN/"/>
    
  </entry>
  
  <entry>
    <title>React Native之图片/宽高/字体平台适配</title>
    <link href="http://blog.poetries.top/2019/10/02/rn-adapter/"/>
    <id>http://blog.poetries.top/2019/10/02/rn-adapter/</id>
    <published>2019-10-02T04:50:12.000Z</published>
    <updated>2019-12-16T02:35:06.843Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、Platform-OS"><a href="#一、Platform-OS" class="headerlink" title="一、Platform.OS"></a>一、Platform.OS</h2><blockquote><p>为了提高代码的兼容性，我们有时需要判断当前系统的平台，然后做一些适配。比如，我们在使用<code>StatusBar</code>做导航栏的时候，在<code>iOS</code>平台下根视图的位置默认情况下是占据状态栏的位置的，我们通常希望状态栏下面能显示一个导航栏，所以我们需要为<code>StatusBar</code>的外部容器设置一个高度</p></blockquote><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;&#123;height:</span> <span class="attr">Platform.OS</span> === <span class="string">'ios'</span> ? <span class="attr">20:0</span>&#125;&#125;&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">StatusBar</span> &#123;<span class="attr">...this.props.statusBar</span>&#125; /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span>;</span><br></pre></td></tr></table></figure><h2 id="二、留意api-doc的android或ios标识"><a href="#二、留意api-doc的android或ios标识" class="headerlink" title="二、留意api doc的android或ios标识"></a>二、留意api doc的android或ios标识</h2><blockquote><p>并不是所有<code>React Native</code>的一些<code>api</code>或组件的一些属性和方法都兼容<code>Android</code>和<code>iOS</code>，在<code>React Native</code>的<code>api doc</code>中通常会在一些属性或方法的前面加上<code>android</code>或<code>ios</code>的字样来标识该属性或方法所支持的平台，如</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">android renderToHardwareTextureAndroid bool</span><br><span class="line">ios shouldRasterizeIOS bool</span><br></pre></td></tr></table></figure><blockquote><p>在上述代码中，<code>renderToHardwareTextureAndroid bool</code>只支持<code>Android</code>平台，<code>ios shouldRasterizeIOS bool</code>只支持<code>iOS</code>平台，所有我们在使用这些带有标记的属性或方法的时候就需要考虑对于它们不兼容的平台我们是否需要做相应的适配了</p></blockquote><h2 id="三、组件选择"><a href="#三、组件选择" class="headerlink" title="三、组件选择"></a>三、组件选择</h2><blockquote><p>比如，我们要开发一款应用需要用到导航组件，<code>在React Native</code>组件中有<code>NavigatorIOS</code>与<code>Navigator</code>两个导航组件来供我们选择，从<code>api doc</code>中我们可以看出<code>NavigatorIOS</code>只支持<code>iOS</code>平台，<code>Navigator</code>则两个平台都支持。<br>所以如果我们要开发的应用需要适配<code>Android</code>和<code>iOS</code>，那么<code>Navigator</code>才是最佳的选择。</p></blockquote><p>为了提高代码的复用性与兼容性建议大家在选择<code>React Native</code>组件的时候要多留意该组件是不是兼容<code>Android</code>和<code>iOS</code>，尽量选择<code>Android</code>和<code>iOS</code>平台都兼容的组件。</p><h2 id="四、图片适配"><a href="#四、图片适配" class="headerlink" title="四、图片适配"></a>四、图片适配</h2><blockquote><p>开发一款应用少不了的需要用到图标。无论是<code>Android</code>还是<code>iOS</code>，现在不同分辨率的设备越来越多，我们希望这些图标能够适配不同分辨率的设备。为此我们需要为每个图标提供<code>1x</code>、<code>2x</code>、<code>3x</code>三种大小的尺寸<code>，React Native</code>会根据屏幕的分辨率来动态的选择显示不同尺寸的图片。比如：在<code>img</code>目录下有如下三种尺寸的<code>check.png</code></p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">└── img</span><br><span class="line">    ├── check.png</span><br><span class="line">    ├── check@2x.png</span><br><span class="line">    └── check@3x.png</span><br></pre></td></tr></table></figure><p>那么我们就可以通过下面的方式来使用<code>check.png</code></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">source</span>=<span class="string">&#123;require(</span>'<span class="attr">.</span>/<span class="attr">img</span>/<span class="attr">check.png</span>')&#125; /&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>提示：我们在使用具有不同分辨率的图标时，一定要引用标准分辨率的图片如<code>require(&#39;./img/check.png&#39;)</code>，如果我们这样写<code>require(&#39;./img/check@2x.png&#39;)</code>，那么应用在不同分辨率的设备上都只会显示<a href="mailto:`check@2x.png" target="_blank" rel="noopener">`check@2x.png</a>`图片，也就无法达到图片自适配的效果。</p></blockquote><h2 id="五、字体-宽高适配"><a href="#五、字体-宽高适配" class="headerlink" title="五、字体/宽高适配"></a>五、字体/宽高适配</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils/FontSize.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; PixelRatio, Dimensions &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; width, height &#125; = Dimensions.get(<span class="string">'window'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> FontSize = <span class="function">(<span class="params">size</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (PixelRatio === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="comment">// iphone 5s and older Androids</span></span><br><span class="line">    <span class="keyword">if</span> (width &lt; <span class="number">360</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> size * <span class="number">0.95</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// iphone 5</span></span><br><span class="line">    <span class="keyword">if</span> (height &lt; <span class="number">667</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> size;</span><br><span class="line">      <span class="comment">// iphone 6-6s</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (height &gt;= <span class="number">667</span> &amp;&amp; height &lt;= <span class="number">735</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> size * <span class="number">1.15</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// older phablets</span></span><br><span class="line">    <span class="keyword">return</span> size * <span class="number">1.25</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (PixelRatio === <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="comment">// catch Android font scaling on small machines</span></span><br><span class="line">    <span class="comment">// where pixel ratio / font scale ratio =&gt; 3:3</span></span><br><span class="line">    <span class="keyword">if</span> (width &lt;= <span class="number">360</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Catch other weird android width sizings</span></span><br><span class="line">    <span class="keyword">if</span> (height &lt; <span class="number">667</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> size * <span class="number">1.15</span>;</span><br><span class="line">      <span class="comment">// catch in-between size Androids and scale font up</span></span><br><span class="line">      <span class="comment">// a tad but not too much</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (height &gt;= <span class="number">667</span> &amp;&amp; height &lt;= <span class="number">735</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> size * <span class="number">1.2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// catch larger devices</span></span><br><span class="line">    <span class="comment">// ie iphone 6s plus / 7 plus / mi note 等等</span></span><br><span class="line">    <span class="keyword">return</span> size * <span class="number">1.27</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (PixelRatio === <span class="number">3.5</span>) &#123;</span><br><span class="line">    <span class="comment">// catch Android font scaling on small machines</span></span><br><span class="line">    <span class="comment">// where pixel ratio / font scale ratio =&gt; 3:3</span></span><br><span class="line">    <span class="keyword">if</span> (width &lt;= <span class="number">360</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> size;</span><br><span class="line">      <span class="comment">// Catch other smaller android height sizings</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (height &lt; <span class="number">667</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> size * <span class="number">1.2</span>;</span><br><span class="line">      <span class="comment">// catch in-between size Androids and scale font up</span></span><br><span class="line">      <span class="comment">// a tad but not too much</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (height &gt;= <span class="number">667</span> &amp;&amp; height &lt;= <span class="number">735</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> size * <span class="number">1.25</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// catch larger phablet devices</span></span><br><span class="line">    <span class="keyword">return</span> size * <span class="number">1.4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// if older device ie pixelRatio !== 2 || 3 || 3.5</span></span><br><span class="line">  <span class="keyword">return</span> size;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 统一常用工具入口 utils/tool.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; Dimensions, Platform, PixelRatio &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;FontSize&#125; <span class="keyword">from</span> <span class="string">'./FontSize'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; width, height &#125; = Dimensions.get(<span class="string">'window'</span>);</span><br><span class="line"><span class="keyword">let</span> pixelRatio = PixelRatio.get();</span><br><span class="line"><span class="keyword">let</span> screenPxW = PixelRatio.getPixelSizeForLayoutSize(width);</span><br><span class="line"><span class="keyword">let</span> basePx = Platform.OS === <span class="string">'ios'</span> ? <span class="number">750</span> : <span class="number">720</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 像素转dp</span></span><br><span class="line"><span class="keyword">let</span> Px2Dp = <span class="function"><span class="keyword">function</span> <span class="title">px2dp</span>(<span class="params">px</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> scaleWidth = px * screenPxW*<span class="number">2</span> / basePx;</span><br><span class="line">  size = <span class="built_in">Math</span>.round((scaleWidth/pixelRatio + <span class="number">0.5</span>));</span><br><span class="line">  <span class="keyword">return</span> size;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  SCREEN_WIDTH: width,</span><br><span class="line">  SCREEN_HEIGHT: height,</span><br><span class="line">  iOS: Platform.OS === <span class="string">'ios'</span>,</span><br><span class="line">  Android: Platform.OS === <span class="string">'android'</span>,</span><br><span class="line">  Px2Dp,</span><br><span class="line">  FontSize</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用方式</span></span><br><span class="line"><span class="keyword">import</span> Tool <span class="keyword">from</span> <span class="string">'../../utils/tool'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</span><br><span class="line">    header_info: &#123;</span><br><span class="line">        display: <span class="string">'flex'</span>,</span><br><span class="line">        flexDirection: <span class="string">'row'</span>,</span><br><span class="line">        justifyContent: <span class="string">'space-between'</span>,</span><br><span class="line">        alignItems: <span class="string">'center'</span>,</span><br><span class="line">        height: Tool.Px2Dp(<span class="number">50</span>),</span><br><span class="line">        paddingTop: Tool.Px2Dp(<span class="number">25</span>),</span><br><span class="line">        paddingBottom: Tool.Px2Dp(<span class="number">10</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    text: &#123;</span><br><span class="line">        fontSize: Tool.FontSize(<span class="number">14</span>),</span><br><span class="line">        color: <span class="string">'#fff'</span>,</span><br><span class="line">        paddingLeft: <span class="number">5</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一、Platform-OS&quot;&gt;&lt;a href=&quot;#一、Platform-OS&quot; class=&quot;headerlink&quot; title=&quot;一、Platform.OS&quot;&gt;&lt;/a&gt;一、Platform.OS&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;为了提高代码的兼容性，我们
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="react" scheme="http://blog.poetries.top/tags/react/"/>
    
      <category term="RN" scheme="http://blog.poetries.top/tags/RN/"/>
    
  </entry>
  
  <entry>
    <title>React Native之相机扫码</title>
    <link href="http://blog.poetries.top/2019/10/02/rn-camera/"/>
    <id>http://blog.poetries.top/2019/10/02/rn-camera/</id>
    <published>2019-10-02T03:30:12.000Z</published>
    <updated>2019-12-16T02:35:06.843Z</updated>
    
    <content type="html"><![CDATA[<blockquote><ul><li>本文介绍<code>react-native-camera</code>扫码的应用</li><li>更多详情文档 <a href="https://github.com/react-native-community/react-native-camera" target="_blank" rel="noopener">https://github.com/react-native-community/react-native-camera</a></li></ul></blockquote><p><strong>效果展示</strong></p><p><img src="http://blog.poetries.top/img-repo/2019/10/676.png" alt></p><p><strong>配置</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">react-native link react-native-camera</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配置andriod/app/src/build.gradle </span></span><br><span class="line"></span><br><span class="line">defaultConfig &#123;</span><br><span class="line">    applicationId <span class="string">"com.jtyapps"</span></span><br><span class="line">    minSdkVersion rootProject.ext.minSdkVersion</span><br><span class="line">    targetSdkVersion rootProject.ext.targetSdkVersion</span><br><span class="line">    versionCode <span class="number">1</span></span><br><span class="line">    versionName <span class="string">"1.0"</span></span><br><span class="line">    ndk &#123;</span><br><span class="line">        abiFilters <span class="string">"armeabi-v7a"</span>, <span class="string">"x86"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加这里</span></span><br><span class="line">    missingDimensionStrategy <span class="string">'react-native-camera'</span>, <span class="string">'general'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置andriod/gradle/wrapper/gradle-wrapper.properties</span></span><br><span class="line"><span class="comment">// 本教程使用的是这个版本</span></span><br><span class="line">distributionUrl=https\:<span class="comment">//services.gradle.org/distributions/gradle-4.10.1-all.zip</span></span><br></pre></td></tr></table></figure><p><strong>添加相机权限</strong></p><blockquote><p><code>andriod/app/src/main/AndroidManifest.xml</code></p></blockquote><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BLUETOOTH"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BLUETOOTH_ADMIN"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_FINE_LOCATION"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_COARSE_LOCATION"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.CHANGE_NETWORK_STATE"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.CHANGE_WIFI_STATE"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_WIFI_STATE"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_EXTERNAL_STORAGEE"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.SYSTEM_ALERT_WINDOW"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.CAMERA"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.VIBRATE"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-feature</span> <span class="attr">android:name</span>=<span class="string">"android.hardware.camera"</span> <span class="attr">android:required</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-feature</span> <span class="attr">android:name</span>=<span class="string">"android.hardware.camera.front"</span> <span class="attr">android:required</span>=<span class="string">"false"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><strong>处理逻辑</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// scan.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    View,</span><br><span class="line">    Text,</span><br><span class="line">    StyleSheet,</span><br><span class="line">    Image,</span><br><span class="line">    Platform,</span><br><span class="line">    Vibration,</span><br><span class="line">    TouchableOpacity,</span><br><span class="line">    Animated,</span><br><span class="line">    Easing,</span><br><span class="line">    Dimensions,</span><br><span class="line">    StatusBar</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"><span class="keyword">import</span> Icon <span class="keyword">from</span> <span class="string">'react-native-vector-icons/Feather'</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; width, height &#125; = Dimensions.get(<span class="string">'window'</span>);</span><br><span class="line"><span class="keyword">import</span> &#123; Modal &#125; <span class="keyword">from</span> <span class="string">'@ant-design/react-native'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;RNCamera&#125; <span class="keyword">from</span> <span class="string">'react-native-camera'</span>;</span><br><span class="line"><span class="keyword">import</span> ViewFinder <span class="keyword">from</span> <span class="string">'./ViewFinder'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scanLine <span class="keyword">from</span> <span class="string">'../../assets/images/scan_line.png'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; scaleSizeW, scaleSizeH, setSpText &#125; <span class="keyword">from</span> <span class="string">'../../utils/scale'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">MyScan</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> navigationOptions = <span class="function">(<span class="params">&#123; navigation, navigationOptions &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span>(&#123;</span><br><span class="line">header: <span class="literal">null</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.camera = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            openFlash: <span class="literal">false</span>,</span><br><span class="line">            active: <span class="literal">true</span>,</span><br><span class="line">            flag: <span class="literal">true</span>,</span><br><span class="line">            fadeInOpacity: <span class="keyword">new</span> Animated.Value(<span class="number">0</span>), <span class="comment">// 初始值</span></span><br><span class="line">            isEndAnimation: <span class="literal">false</span>,<span class="comment">//结束动画标记</span></span><br><span class="line">            key: <span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;navigation&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">this</span>._startAnimation(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillReceiveProps(nProps) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;key &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        <span class="keyword">const</span> &#123;navigation&#125; = nProps;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> newKey = navigation.getParam(<span class="string">'key'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(key!=newKey)&#123;</span><br><span class="line">            <span class="keyword">this</span>.transCode = <span class="string">''</span>;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                key: newKey</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'scan进来了'</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开始动画，循环播放</span></span><br><span class="line">    _startAnimation = <span class="function">(<span class="params">isEnd</span>) =&gt;</span> &#123;</span><br><span class="line">        Animated.timing(<span class="keyword">this</span>.state.fadeInOpacity, &#123;</span><br><span class="line">            toValue: <span class="number">1</span>,</span><br><span class="line">            duration: <span class="number">3000</span>,</span><br><span class="line">            easing: Easing.linear</span><br><span class="line">        &#125;).start(</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (isEnd) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                        isEndAnimation: <span class="literal">true</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">this</span>.state.isEndAnimation) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.state.fadeInOpacity.setValue(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">this</span>._startAnimation(<span class="literal">false</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// console.log("开始动画");</span></span><br><span class="line">    &#125;</span><br><span class="line">    barcodeReceived (e)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;<span class="attr">navigation</span>:&#123;navigate&#125;&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">        <span class="keyword">if</span> (e.data !== <span class="keyword">this</span>.transCode) &#123;</span><br><span class="line">            Vibration.vibrate([<span class="number">0</span>, <span class="number">500</span>, <span class="number">200</span>, <span class="number">500</span>]);</span><br><span class="line">            <span class="keyword">this</span>.transCode = e.data; <span class="comment">// 放在this上，防止触发多次，setstate有延时</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.state.flag) &#123;</span><br><span class="line">                <span class="keyword">this</span>.changeState(<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"transCode="</span> + <span class="keyword">this</span>.transCode);</span><br><span class="line">            Modal.alert(<span class="string">'温馨提示'</span>, <span class="string">`确定绑定: <span class="subst">$&#123;<span class="keyword">this</span>.transCode&#125;</span> 吗？`</span>, [</span><br><span class="line">                &#123;</span><br><span class="line">                  text: <span class="string">'取消'</span>,</span><br><span class="line">                  onPress: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'cancel'</span>),</span><br><span class="line">                  style: <span class="string">'cancel'</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123; <span class="attr">text</span>: <span class="string">'确定'</span>, <span class="attr">onPress</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    navigate(<span class="string">'Record'</span>)</span><br><span class="line">                    <span class="comment">// dispatch(&#123;</span></span><br><span class="line">                    <span class="comment">//     type: 'user/bindHeartDev',</span></span><br><span class="line">                    <span class="comment">//     callback: res=&gt;&#123;</span></span><br><span class="line">                    <span class="comment">//         if(res.code == 200) &#123;</span></span><br><span class="line">                    <span class="comment">//             navigate('Record')</span></span><br><span class="line">                    <span class="comment">//         &#125;</span></span><br><span class="line">                    <span class="comment">//     &#125;</span></span><br><span class="line">                    <span class="comment">// &#125;)</span></span><br><span class="line">                &#125; &#125;,</span><br><span class="line">            ]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回按钮点击事件</span></span><br><span class="line">    _goBack = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            isEndAnimation: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">this</span>.props.navigation.goBack();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//开灯关灯</span></span><br><span class="line">    _changeFlash = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            openFlash: !<span class="keyword">this</span>.state.openFlash,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//改变请求状态</span></span><br><span class="line">    changeState = <span class="function">(<span class="params">status</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            flag: status</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'status='</span> + status);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            openFlash,</span><br><span class="line">            active,</span><br><span class="line">        &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;View style=&#123;styles.allContainer&#125;&gt;</span><br><span class="line">                &lt;RNCamera</span><br><span class="line">                    barCodeTypes=&#123;[RNCamera.Constants.BarCodeType.qr]&#125;</span><br><span class="line">                    onBarCodeRead=&#123;<span class="keyword">this</span>.barcodeReceived.bind(<span class="keyword">this</span>)&#125;</span><br><span class="line">                    onCameraReady=&#123;() =&gt; &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">'ready'</span>)</span><br><span class="line">                    &#125;&#125;</span><br><span class="line">                    permissionDialogTitle=&#123;<span class="string">'Permission to use camera'</span>&#125;</span><br><span class="line">                    permissionDialogMessage=&#123;<span class="string">'We need your permission to use your camera phone'</span>&#125;</span><br><span class="line">                    <span class="comment">// defaultVideoQuality=&#123;RNCamera.Constants.VideoQuality["480p"]&#125;</span></span><br><span class="line">                    style=&#123;styles.cameraStyle&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">                        &lt;View style=&#123;styles.titleContainer&#125;&gt;</span><br><span class="line">                            &lt;View style=&#123;styles.leftContainer&#125;&gt;</span><br><span class="line">                                &lt;TouchableOpacity activeOpacity=&#123;<span class="number">1</span>&#125; onPress=&#123;<span class="keyword">this</span>._goBack&#125;&gt;</span><br><span class="line">                                    &lt;View&gt;</span><br><span class="line">                                        &#123;<span class="comment">/* &lt;Image style=&#123;styles.backImg&#125; source=&#123;backIcon&#125; /&gt; */</span>&#125;</span><br><span class="line">                                        &lt;Icon name=<span class="string">"chevron-left"</span> style=&#123;styles.backIcon&#125;/&gt;</span><br><span class="line">                                    &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">                                &lt;/</span>TouchableOpacity&gt;</span><br><span class="line">                            &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;/</span>View&gt;</span><br><span class="line">                    &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;View style=&#123;styles.centerContainer&#125; /</span>&gt;</span><br><span class="line">                    &lt;View style=&#123;&#123; <span class="attr">flexDirection</span>: <span class="string">'row'</span> &#125;&#125;&gt;</span><br><span class="line">                        &lt;View style=&#123;styles.fillView&#125; /&gt;</span><br><span class="line">                        &lt;View style=&#123;styles.scan&#125;&gt;</span><br><span class="line">                            &lt;ViewFinder /&gt;</span><br><span class="line">                            &lt;Animated.View style=&#123;[styles.scanLine, &#123;</span><br><span class="line">                                opacity: <span class="number">1</span>,</span><br><span class="line">                                transform: [&#123;</span><br><span class="line">                                    translateY: <span class="keyword">this</span>.state.fadeInOpacity.interpolate(&#123;</span><br><span class="line">                                        inputRange: [<span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">                                        outputRange: [<span class="number">0</span>, scaleSizeH(<span class="number">300</span>)]</span><br><span class="line">                                    &#125;)</span><br><span class="line">                                &#125;]</span><br><span class="line">                            &#125;]&#125;&gt;</span><br><span class="line">                                &lt;Image source=&#123;scanLine&#125; /&gt;</span><br><span class="line">                            &lt;<span class="regexp">/Animated.View&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;/</span>View&gt;</span><br><span class="line">                        &lt;View style=&#123;styles.fillView&#125; /&gt;</span><br><span class="line">                    &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;View style=&#123;styles.bottomContainer&#125;&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Text</span></span><br><span class="line"><span class="regexp">                            style=&#123;[</span></span><br><span class="line"><span class="regexp">                                styles.text,</span></span><br><span class="line"><span class="regexp">                                &#123;</span></span><br><span class="line"><span class="regexp">                                    textAlign: 'center',</span></span><br><span class="line"><span class="regexp">                                    width: 220,</span></span><br><span class="line"><span class="regexp">                                    marginTop: active ? 25 : 245,</span></span><br><span class="line"><span class="regexp">                                &#125;,</span></span><br><span class="line"><span class="regexp">                            ]&#125;</span></span><br><span class="line"><span class="regexp">                            numberOfLines=&#123;2&#125;</span></span><br><span class="line"><span class="regexp">                        &gt;</span></span><br><span class="line"><span class="regexp">                            请将手表二维码放入扫码框内</span></span><br><span class="line"><span class="regexp">                                &lt;/</span>Text&gt;</span><br><span class="line">                       &#123;<span class="comment">/** &lt;TouchableOpacity onPress=&#123;this._changeFlash&#125;&gt;</span></span><br><span class="line"><span class="comment">                            &lt;View style=&#123;styles.flash&#125;&gt;</span></span><br><span class="line"><span class="comment">                                &lt;Text style=&#123;styles.icon&#125;&gt;(・◇・)&lt;/Text&gt;</span></span><br><span class="line"><span class="comment">                                &lt;Text style=&#123;styles.text&#125;&gt;</span></span><br><span class="line"><span class="comment">                                    开灯/关灯</span></span><br><span class="line"><span class="comment">                                        &lt;/Text&gt;</span></span><br><span class="line"><span class="comment">                            &lt;/View&gt;</span></span><br><span class="line"><span class="comment">                        &lt;/TouchableOpacity&gt;  */</span>&#125;</span><br><span class="line">                        </span><br><span class="line">                    &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>RNCamera&gt; </span><br><span class="line">            &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const styles = StyleSheet.create(&#123;</span></span><br><span class="line"><span class="regexp">    allContainer: &#123;</span></span><br><span class="line"><span class="regexp">        flex: 1,</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    container: &#123;</span></span><br><span class="line"><span class="regexp">        ...Platform.select(&#123;</span></span><br><span class="line"><span class="regexp">            ios: &#123;</span></span><br><span class="line"><span class="regexp">                height: 64 + StatusBar.currentHeight,</span></span><br><span class="line"><span class="regexp">            &#125;,</span></span><br><span class="line"><span class="regexp">            android: &#123;</span></span><br><span class="line"><span class="regexp">                height: 50 + StatusBar.currentHeight,</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">        &#125;),</span></span><br><span class="line"><span class="regexp">        backgroundColor: '#000',</span></span><br><span class="line"><span class="regexp">        opacity: 0.5</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    titleContainer: &#123;</span></span><br><span class="line"><span class="regexp">        flex: 1,</span></span><br><span class="line"><span class="regexp">        ...Platform.select(&#123;</span></span><br><span class="line"><span class="regexp">            ios: &#123;</span></span><br><span class="line"><span class="regexp">                paddingTop: 15,</span></span><br><span class="line"><span class="regexp">            &#125;,</span></span><br><span class="line"><span class="regexp">            android: &#123;</span></span><br><span class="line"><span class="regexp">                paddingTop: 0,</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">        &#125;),</span></span><br><span class="line"><span class="regexp">        flexDirection: 'row',</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    leftContainer: &#123;</span></span><br><span class="line"><span class="regexp">        flex: 0,</span></span><br><span class="line"><span class="regexp">        justifyContent: 'center',</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    backIcon: &#123;</span></span><br><span class="line"><span class="regexp">        marginLeft: 10,</span></span><br><span class="line"><span class="regexp">        fontSize: 30,</span></span><br><span class="line"><span class="regexp">        color: '#fff'</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    cameraStyle: &#123;</span></span><br><span class="line"><span class="regexp">        alignSelf: 'center',</span></span><br><span class="line"><span class="regexp">        width: width,</span></span><br><span class="line"><span class="regexp">        height: height,</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    flash: &#123;</span></span><br><span class="line"><span class="regexp">        flexDirection: 'column',</span></span><br><span class="line"><span class="regexp">        alignItems: 'center',</span></span><br><span class="line"><span class="regexp">        justifyContent: 'flex-start',</span></span><br><span class="line"><span class="regexp">        marginTop: 60,</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    flashIcon: &#123;</span></span><br><span class="line"><span class="regexp">        fontSize: 1,</span></span><br><span class="line"><span class="regexp">        color: '#fff',</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    text: &#123;</span></span><br><span class="line"><span class="regexp">        fontSize: 14,</span></span><br><span class="line"><span class="regexp">        color: '#fff',</span></span><br><span class="line"><span class="regexp">        marginTop: 5</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    icon: &#123;</span></span><br><span class="line"><span class="regexp">        color: '#fff',</span></span><br><span class="line"><span class="regexp">        fontSize: 20,</span></span><br><span class="line"><span class="regexp">        fontFamily: 'iconfont'</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    scanLine: &#123;</span></span><br><span class="line"><span class="regexp">        alignSelf: 'center',</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    centerContainer: &#123;</span></span><br><span class="line"><span class="regexp">        ...Platform.select(&#123;</span></span><br><span class="line"><span class="regexp">            ios: &#123;</span></span><br><span class="line"><span class="regexp">                height: 80,</span></span><br><span class="line"><span class="regexp">            &#125;,</span></span><br><span class="line"><span class="regexp">            android: &#123;</span></span><br><span class="line"><span class="regexp">                height: 60,</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">        &#125;),</span></span><br><span class="line"><span class="regexp">        width: width,</span></span><br><span class="line"><span class="regexp">        backgroundColor: '#000',</span></span><br><span class="line"><span class="regexp">        opacity: 0.5</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    bottomContainer: &#123;</span></span><br><span class="line"><span class="regexp">        alignItems: 'center',</span></span><br><span class="line"><span class="regexp">        backgroundColor: '#000',</span></span><br><span class="line"><span class="regexp">        alignSelf: 'center',</span></span><br><span class="line"><span class="regexp">        opacity: 0.5,</span></span><br><span class="line"><span class="regexp">        flex: 1,</span></span><br><span class="line"><span class="regexp">        width: width</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    fillView: &#123;</span></span><br><span class="line"><span class="regexp">        width: (width - scaleSizeH(300)) /</span> <span class="number">2</span>,</span><br><span class="line">        height: scaleSizeH(<span class="number">300</span>),</span><br><span class="line">        backgroundColor: <span class="string">'#000'</span>,</span><br><span class="line">        opacity: <span class="number">0.5</span></span><br><span class="line">    &#125;,</span><br><span class="line">    scan: &#123;</span><br><span class="line">        width: scaleSizeH(<span class="number">300</span>),</span><br><span class="line">        height: scaleSizeH(<span class="number">300</span>),</span><br><span class="line">        alignSelf: <span class="string">'center'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    info:&#123;</span><br><span class="line">        color: <span class="string">'#fff'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ViewFinder.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123;</span><br><span class="line">    Component,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    ActivityIndicator,</span><br><span class="line">    StyleSheet,</span><br><span class="line">    View,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; scaleSizeW, scaleSizeH, setSpText &#125; <span class="keyword">from</span> <span class="string">'../../utils/scale'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Viewfinder</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getBackgroundColor = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (&#123;</span><br><span class="line">            backgroundColor: <span class="keyword">this</span>.props.backgroundColor,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getEdgeColor = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (&#123;</span><br><span class="line">            borderColor: <span class="keyword">this</span>.props.color,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getSizeStyles = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (&#123;</span><br><span class="line">            height: <span class="keyword">this</span>.props.height,</span><br><span class="line">            width: <span class="keyword">this</span>.props.width,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getEdgeSizeStyles = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (&#123;</span><br><span class="line">            height: <span class="keyword">this</span>.props.borderLength,</span><br><span class="line">            width: <span class="keyword">this</span>.props.borderLength,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    renderLoadingIndicator = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.props.isLoading) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;ActivityIndicator</span><br><span class="line">                animating=&#123;<span class="keyword">this</span>.props.isLoading&#125;</span><br><span class="line">                color=&#123;<span class="keyword">this</span>.props.color&#125;</span><br><span class="line">                size=<span class="string">"large"</span></span><br><span class="line">            /&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;View style=&#123;[styles.container, <span class="keyword">this</span>.getBackgroundColor()]&#125;&gt;</span><br><span class="line">                &lt;View style=&#123;[styles.viewfinder, <span class="keyword">this</span>.getSizeStyles()]&#125;&gt;</span><br><span class="line">                    &lt;View</span><br><span class="line">                        style=&#123;[</span><br><span class="line">                            <span class="keyword">this</span>.getEdgeColor(),</span><br><span class="line">                            <span class="keyword">this</span>.getEdgeSizeStyles(),</span><br><span class="line">                            styles.topLeftEdge,</span><br><span class="line">                            &#123;</span><br><span class="line">                                borderLeftWidth: <span class="keyword">this</span>.props.borderWidth,</span><br><span class="line">                                borderTopWidth: <span class="keyword">this</span>.props.borderWidth,</span><br><span class="line">                            &#125;,</span><br><span class="line">                        ]&#125;</span><br><span class="line">                    /&gt;</span><br><span class="line">                    &lt;View</span><br><span class="line">                        style=&#123;[</span><br><span class="line">                            <span class="keyword">this</span>.getEdgeColor(),</span><br><span class="line">                            <span class="keyword">this</span>.getEdgeSizeStyles(),</span><br><span class="line">                            styles.topRightEdge,</span><br><span class="line">                            &#123;</span><br><span class="line">                                borderRightWidth: <span class="keyword">this</span>.props.borderWidth,</span><br><span class="line">                                borderTopWidth: <span class="keyword">this</span>.props.borderWidth,</span><br><span class="line">                            &#125;,</span><br><span class="line">                        ]&#125;</span><br><span class="line">                    /&gt;</span><br><span class="line">                    &#123;<span class="keyword">this</span>.renderLoadingIndicator()&#125;</span><br><span class="line">                    &lt;View</span><br><span class="line">                        style=&#123;[</span><br><span class="line">                            <span class="keyword">this</span>.getEdgeColor(),</span><br><span class="line">                            <span class="keyword">this</span>.getEdgeSizeStyles(),</span><br><span class="line">                            styles.bottomLeftEdge,</span><br><span class="line">                            &#123;</span><br><span class="line">                                borderLeftWidth: <span class="keyword">this</span>.props.borderWidth,</span><br><span class="line">                                borderBottomWidth: <span class="keyword">this</span>.props.borderWidth,</span><br><span class="line">                            &#125;,</span><br><span class="line">                        ]&#125;</span><br><span class="line">                    /&gt;</span><br><span class="line">                    &lt;View</span><br><span class="line">                        style=&#123;[</span><br><span class="line">                            <span class="keyword">this</span>.getEdgeColor(),</span><br><span class="line">                            <span class="keyword">this</span>.getEdgeSizeStyles(),</span><br><span class="line">                            styles.bottomRightEdge,</span><br><span class="line">                            &#123;</span><br><span class="line">                                borderRightWidth: <span class="keyword">this</span>.props.borderWidth,</span><br><span class="line">                                borderBottomWidth: <span class="keyword">this</span>.props.borderWidth,</span><br><span class="line">                            &#125;,</span><br><span class="line">                        ]&#125;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>View&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</span><br><span class="line">    container: &#123;</span><br><span class="line">        alignItems: <span class="string">'center'</span>,</span><br><span class="line">        justifyContent: <span class="string">'center'</span>,</span><br><span class="line">        position: <span class="string">'absolute'</span>,</span><br><span class="line">        top: <span class="number">0</span>,</span><br><span class="line">        right: <span class="number">0</span>,</span><br><span class="line">        bottom: <span class="number">0</span>,</span><br><span class="line">        left: <span class="number">0</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    viewfinder: &#123;</span><br><span class="line">        alignItems: <span class="string">'center'</span>,</span><br><span class="line">        justifyContent: <span class="string">'center'</span>,</span><br><span class="line">        backgroundColor: <span class="string">'transparent'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    topLeftEdge: &#123;</span><br><span class="line">        position: <span class="string">'absolute'</span>,</span><br><span class="line">        top: <span class="number">0</span>,</span><br><span class="line">        left: <span class="number">0</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    topRightEdge: &#123;</span><br><span class="line">        position: <span class="string">'absolute'</span>,</span><br><span class="line">        top: <span class="number">0</span>,</span><br><span class="line">        right: <span class="number">0</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    bottomLeftEdge: &#123;</span><br><span class="line">        position: <span class="string">'absolute'</span>,</span><br><span class="line">        bottom: <span class="number">0</span>,</span><br><span class="line">        left: <span class="number">0</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    bottomRightEdge: &#123;</span><br><span class="line">        position: <span class="string">'absolute'</span>,</span><br><span class="line">        bottom: <span class="number">0</span>,</span><br><span class="line">        right: <span class="number">0</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Viewfinder.defaultProps = &#123;</span><br><span class="line">    backgroundColor: <span class="string">'transparent'</span>,</span><br><span class="line">    borderWidth: <span class="number">3</span>,</span><br><span class="line">    borderLength: <span class="number">20</span>,</span><br><span class="line">    color: <span class="string">'#1DBAF1'</span>,</span><br><span class="line">    height: scaleSizeH(<span class="number">300</span>),</span><br><span class="line">    isLoading: <span class="literal">false</span>,</span><br><span class="line">    width: scaleSizeH(<span class="number">300</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用方式</span></span><br><span class="line">onScan = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; navigate &#125; = <span class="keyword">this</span>.props.navigation;</span><br><span class="line">    <span class="comment">// 跳转到扫码页面即可打开</span></span><br><span class="line">    navigate(<span class="string">'Scan'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;本文介绍&lt;code&gt;react-native-camera&lt;/code&gt;扫码的应用&lt;/li&gt;
&lt;li&gt;更多详情文档 &lt;a href=&quot;https://github.com/react-native-community/react-nat
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="react" scheme="http://blog.poetries.top/tags/react/"/>
    
      <category term="RN" scheme="http://blog.poetries.top/tags/RN/"/>
    
  </entry>
  
  <entry>
    <title>React Native之蓝牙连接心率带设备</title>
    <link href="http://blog.poetries.top/2019/10/02/rn-ble/"/>
    <id>http://blog.poetries.top/2019/10/02/rn-ble/</id>
    <published>2019-10-02T03:20:12.000Z</published>
    <updated>2019-12-16T02:35:06.843Z</updated>
    
    <content type="html"><![CDATA[<blockquote><ul><li>本文主要介绍 <code>react-native-ble-manager</code> 连接心率带设备。</li><li>文档地址 <a href="https://github.com/innoveit/react-native-ble-manager#methods" target="_blank" rel="noopener">https://github.com/innoveit/react-native-ble-manager#methods</a></li></ul></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 以下是处理蓝牙设备的逻辑</span></span><br><span class="line">state = &#123;</span><br><span class="line">    scanning: <span class="literal">false</span>,<span class="comment">//蓝牙是否在扫描</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化蓝牙设备信息</span></span><br><span class="line">initDevInfo = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//创建对用户的请求，以激活蓝牙</span></span><br><span class="line">    BleManager.enableBluetooth()</span><br><span class="line">        .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'开启成功'</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'The user refuse to enable bluetooth'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">    <span class="comment">//初始化设备</span></span><br><span class="line">    BleManager.start(&#123; <span class="attr">showAlert</span>: <span class="literal">false</span> &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'开始了'</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.onCheckLocation();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.handlerDiscover = bleManagerEmitter.addListener(<span class="string">'BleManagerDiscoverPeripheral'</span>, <span class="keyword">this</span>.handleDiscoverPeripheral);</span><br><span class="line">    <span class="keyword">this</span>.handlerStop = bleManagerEmitter.addListener(<span class="string">'BleManagerStopScan'</span>, <span class="keyword">this</span>.handleStopScan);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">//检查是否获得定位权限</span></span><br><span class="line"> onCheckLocation =<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(Platform.OS === <span class="string">'ios'</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> granted =PermissionsAndroid.check(PermissionsAndroid.PERMISSIONS.ACCESS_COARSE_LOCATION)</span><br><span class="line"></span><br><span class="line">        granted.then(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!data)&#123;</span><br><span class="line">                <span class="keyword">this</span>.requestLocationPermission()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).catch(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'err---------'</span>,err.toString())</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//申请地址权限 有些安卓设备比如华为，需要开启定位才可以扫描到蓝牙设备</span></span><br><span class="line">    <span class="keyword">async</span> requestLocationPermission() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> granted = <span class="keyword">await</span> PermissionsAndroid.request(</span><br><span class="line">                PermissionsAndroid.PERMISSIONS.ACCESS_COARSE_LOCATION,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//第一次请求拒绝后提示用户你为什么要这个权限</span></span><br><span class="line">                    <span class="string">'title'</span>: <span class="string">'是否允许地址查询权限'</span>,</span><br><span class="line">                    <span class="string">'message'</span>: <span class="string">'此权限会造成系统异常，请允许'</span>,</span><br><span class="line">                    buttonNeutral: <span class="string">'等会再问我'</span>,</span><br><span class="line">                    buttonNegative: <span class="string">'不行'</span>,</span><br><span class="line">                    buttonPositive: <span class="string">'好的'</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (granted === PermissionsAndroid.RESULTS.GRANTED) &#123;</span><br><span class="line">                showMsg(<span class="string">"你已获取了定位权限"</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                showMsg(<span class="string">"获取定位权限失败,会造成系统异常"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            showMsg(err.toString())</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">compomentDidMount()&#123;</span><br><span class="line">    <span class="keyword">this</span>.initDevInfo()</span><br><span class="line">    <span class="keyword">this</span>.startScan()</span><br><span class="line">&#125;</span><br><span class="line">handleStopScan = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'停止扫描'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 广播的方式定时读取设备信息</span></span><br><span class="line">handleDiscoverPeripheral = <span class="function">(<span class="params">peripheral</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;<span class="attr">record</span>:&#123;mqttData,realHeartData&#125;,dispatch &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'扫描到的外围设备---'</span>, peripheral);</span><br><span class="line">    <span class="keyword">let</span> devName = peripheral.name</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果已绑定的设备编号和扫描的蓝牙编码相等</span></span><br><span class="line">    <span class="keyword">if</span> (mqttData.deviceCode == peripheral.name) &#123;</span><br><span class="line">        <span class="comment">// 传感器数据解析成可读数据。这里根据设备提供商的文档处理即可</span></span><br><span class="line">        <span class="keyword">let</span> before = peripheral.advertising.serviceUUIDs[<span class="number">1</span>].replace(<span class="regexp">/-/g</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> type1 = before.substr(<span class="number">16</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">let</span> type2 = before.substr(<span class="number">24</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">let</span> analysis = &#123;</span><br><span class="line">            <span class="string">"id"</span>: before.substr(<span class="number">0</span>, <span class="number">10</span>),</span><br><span class="line">            <span class="string">"battery"</span>: <span class="built_in">parseInt</span>(before.substr(<span class="number">14</span>, <span class="number">2</span>), <span class="number">16</span>),</span><br><span class="line">            <span class="string">"heartRate"</span>: type1 === <span class="string">"31"</span> ? <span class="built_in">parseInt</span>(before.substr(<span class="number">18</span>, <span class="number">6</span>), <span class="number">16</span>) : <span class="literal">null</span>,</span><br><span class="line">            <span class="string">"stepCount"</span>: type2 === <span class="string">"32"</span> ? <span class="built_in">parseInt</span>(before.substr(<span class="number">26</span>, <span class="number">6</span>), <span class="number">16</span>) : <span class="literal">null</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">console</span>.log(analysis,<span class="string">'analysis'</span>)</span><br><span class="line">        </span><br><span class="line">            <span class="comment">// 保留心率大于0的</span></span><br><span class="line">            <span class="keyword">if</span>(analysis.heartRate !=<span class="literal">null</span> &amp;&amp; analysis.heartRate&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 记录发送mqtt数据 每隔3秒查询一次心率数据</span></span><br><span class="line">            mqttData.sportData.tmp.push(&#123;</span><br><span class="line">                time: moment(<span class="built_in">Date</span>.now()).format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>),</span><br><span class="line">                heart: analysis.heartRate,</span><br><span class="line">                steps: analysis.stepCount || <span class="number">0</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 记录实时曲线数据</span></span><br><span class="line">            realHeartData.push(&#123;</span><br><span class="line">                time: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line">                value: analysis.heartRate</span><br><span class="line">            &#125;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 刷新页面</span></span><br><span class="line">            dispatch(&#123;</span><br><span class="line">            type: <span class="string">'record/save'</span>,</span><br><span class="line">            payload: &#123;</span><br><span class="line">                mqttData,</span><br><span class="line">                realHeartData</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     *开始扫描蓝牙</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    startScan = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(bleScanTimer) clearInterval(bleScanTimer);</span><br><span class="line"></span><br><span class="line">bleScanTimer = setInterval(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line"><span class="comment">//扫描可用的外围设备</span></span><br><span class="line">BleManager.scan([<span class="string">"180d"</span>], <span class="number">8</span>, <span class="literal">false</span>, &#123; <span class="string">"scanMode"</span>: <span class="number">2</span>, <span class="string">"numberOfMatches"</span>: <span class="number">3</span> &#125;).then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'开始扫描'</span>)</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">this</span>.state.scanning) &#123;</span><br><span class="line"><span class="keyword">this</span>.setState(&#123; <span class="attr">scanning</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;, timerHeartInterval)</span><br><span class="line">&#125;</span><br><span class="line">stopScan = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(bleScanTimer) clearInterval(bleScanTimer);</span><br><span class="line"><span class="keyword">this</span>.setState(&#123; <span class="attr">scanning</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;本文主要介绍 &lt;code&gt;react-native-ble-manager&lt;/code&gt; 连接心率带设备。&lt;/li&gt;
&lt;li&gt;文档地址 &lt;a href=&quot;https://github.com/innoveit/react-native-
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="react" scheme="http://blog.poetries.top/tags/react/"/>
    
      <category term="RN" scheme="http://blog.poetries.top/tags/RN/"/>
    
  </entry>
  
  <entry>
    <title>构建部署easy-mock服务</title>
    <link href="http://blog.poetries.top/2019/10/01/easy-mock/"/>
    <id>http://blog.poetries.top/2019/10/01/easy-mock/</id>
    <published>2019-10-01T03:40:43.000Z</published>
    <updated>2019-12-16T02:35:06.807Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://easy-mock.com" target="_blank" rel="noopener">https://easy-mock.com</a> 官网经常挂，影响了开发效率，在本地部署开发更高效</p></blockquote><h2 id="一、easy-mock部署步骤"><a href="#一、easy-mock部署步骤" class="headerlink" title="一、easy-mock部署步骤"></a>一、easy-mock部署步骤</h2><ul><li>安装 <code>node（&gt;=v8.9</code>） &amp; <code>MongoDB（&gt;=v3.4） &amp; Redis（&gt;=v4.0）</code></li><li>安装 <code>easy-mock</code>，更改配置文件</li><li>启动 <code>easy-mock</code>，测试项目是否可以正常启动，能的话就可以先 Ctrl + C了</li><li>启动 <code>MongoDB</code> 和 Redis`</li><li>npm run build<code>，然后用</code>PM2<code>启动</code>app.js`</li></ul><h2 id="二、MongoDB和Redis环境搭建"><a href="#二、MongoDB和Redis环境搭建" class="headerlink" title="二、MongoDB和Redis环境搭建"></a>二、MongoDB和Redis环境搭建</h2><h3 id="2-1-安装redis"><a href="#2-1-安装redis" class="headerlink" title="2.1 安装redis"></a>2.1 安装redis</h3><blockquote><p>Redis安装教程：<a href="http://www.runoob.com/redis/redis-install.html" target="_blank" rel="noopener">http://www.runoob.com/redis/redis-install.html</a></p></blockquote><p><strong>Mac环境下安装Redis</strong></p><blockquote><p>首先去官网下载redis <a href="https://redis.io/" target="_blank" rel="noopener">https://redis.io/</a></p></blockquote><p><strong>安装与编译</strong></p><ul><li>先找到<code>usr/local</code>目录，也可以直接命令行完成，建议<code>windows</code>可以这样操作，自己<code>mac</code>系统直接命令行出现了错误，找不到改目录，于是手动移动安装目录。</li><li>主要分为两步，先是打开访达，<code>command+shift+G</code>跳转目录</li></ul><p><img src="http://blog.poetries.top/img-repo/20191001/1.png" alt></p><ul><li>编译安装 <code>sudo make install</code></li></ul><p><strong>启动redis客户端</strong></p><blockquote><p>执行<code>redis-cli</code>发现没有连接上</p></blockquote><p><img src="http://blog.poetries.top/img-repo/20191001/2.png" alt></p><blockquote><p>修改默认配置文件 <code>$ vi /usr/local/etc/redis.conf</code></p></blockquote><ul><li>在安装好<code>redis</code>扩展 尝试连接<code>redis</code>时，客户端打不开，原因是需要先开启服务端，这需要先配置</li><li>找到<code>redis.conf</code> 并修改 <code>daemonize no</code> 为 <code>daemonize yes</code> ，这样就可以默认启动就后台运行</li></ul><p><img src="http://blog.poetries.top/img-repo/20191001/3.png" alt></p><p><strong>开启客户端要确保服务端启动</strong></p><p><img src="http://blog.poetries.top/img-repo/20191001/4.png" alt></p><blockquote><p>再次执行 <code>redis-cli</code>启动客户端</p></blockquote><p><strong>easy-mock环境配置，这里只需要启动服务端即可</strong></p><h3 id="2-2-安装MongoDB"><a href="#2-2-安装MongoDB" class="headerlink" title="2.2 安装MongoDB"></a>2.2 安装MongoDB</h3><blockquote><p>MongoDB安装教程：<a href="https://www.cnblogs.com/weixuqin/p/7258000.html" target="_blank" rel="noopener">https://www.cnblogs.com/weixuqin/p/7258000.html</a></p></blockquote><p><strong>Mac上MongoDB安装：</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brew install mongodb</span><br></pre></td></tr></table></figure><p><strong>MongoDB装完要启动服务</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brew services start mongodb</span><br></pre></td></tr></table></figure><blockquote><p>这时候浏览器中访问<code>127.0.0.1:27017</code>应该就已经有内容了</p></blockquote><h2 id="三、总体部署流程"><a href="#三、总体部署流程" class="headerlink" title="三、总体部署流程"></a>三、总体部署流程</h2><blockquote><p>git clone <a href="https://github.com/easy-mock/easy-mock.git" target="_blank" rel="noopener">https://github.com/easy-mock/easy-mock.git</a></p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包部署需要的文件</span></span><br><span class="line">yarn build</span><br></pre></td></tr></table></figure><p><strong>1、启动redis服务</strong></p><p><img src="http://blog.poetries.top/img-repo/20191001/4.png" alt></p><p><strong>2、启动MongoDB服务</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brew services start mongodb</span><br></pre></td></tr></table></figure><p><strong>3、npm run build</strong></p><blockquote><p>执行build 打包文件</p></blockquote><p><strong>4、pm2守护进程</strong></p><p><img src="http://blog.poetries.top/img-repo/20191001/5.png" alt></p><p><img src="http://blog.poetries.top/img-repo/20191001/6.png" alt></p><blockquote><p>打开网址 <a href="http://127.0.0.1:7300/" target="_blank" rel="noopener">http://127.0.0.1:7300/</a></p></blockquote><p><img src="http://blog.poetries.top/img-repo/20191001/7.png" alt></p><h2 id="四、Easy-Mock-线上项目迁移"><a href="#四、Easy-Mock-线上项目迁移" class="headerlink" title="四、Easy Mock 线上项目迁移"></a>四、Easy Mock 线上项目迁移</h2><blockquote><p>参考 <a href="https://github.com/easy-mock/migrate2local?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">https://github.com/easy-mock/migrate2local?tdsourcetag=s_pctim_aiomsg</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://easy-mock.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://easy-mock.com&lt;/a&gt; 官网经常挂，影响了开发效率，在本地部署开发更高效&lt;/p&gt;
&lt;/bloc
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="Mock" scheme="http://blog.poetries.top/tags/Mock/"/>
    
  </entry>
  
  <entry>
    <title>TS之interface与type区别</title>
    <link href="http://blog.poetries.top/2019/09/28/ts-interface-type/"/>
    <id>http://blog.poetries.top/2019/09/28/ts-interface-type/</id>
    <published>2019-09-28T08:25:24.000Z</published>
    <updated>2019-12-16T02:35:06.843Z</updated>
    
    <content type="html"><![CDATA[<h2 id="相同之处"><a href="#相同之处" class="headerlink" title="相同之处"></a>相同之处</h2><h3 id="都可以描述一个对象或者函数"><a href="#都可以描述一个对象或者函数" class="headerlink" title="都可以描述一个对象或者函数"></a>都可以描述一个对象或者函数</h3><p><strong>interface</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface User &#123;</span><br><span class="line">  name: string</span><br><span class="line">  age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface SetUser &#123;</span><br><span class="line">  (name: string, <span class="attr">age</span>: number): <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>type</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type User = &#123;</span><br><span class="line">  name: string</span><br><span class="line">  age: number</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type SetUser = <span class="function">(<span class="params">name: string, age: number</span>)=&gt;</span> <span class="keyword">void</span>;</span><br></pre></td></tr></table></figure><h3 id="都允许拓展（extends）"><a href="#都允许拓展（extends）" class="headerlink" title="都允许拓展（extends）"></a>都允许拓展（extends）</h3><blockquote><p><code>interface</code> 和 <code>type</code> 都可以拓展，并且两者并不是相互独立的，也就是说 <code>interface</code> 可以 <code>extends type</code>, <code>type</code> 也可以 <code>extends interface</code> 。 虽然效果差不多，但是两者语法不同</p></blockquote><p><strong>interface extends interface</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface Name &#123; </span><br><span class="line">  name: string; </span><br><span class="line">&#125;</span><br><span class="line">interface User extends Name &#123; </span><br><span class="line">  age: number; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>type extends type</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type Name = &#123; </span><br><span class="line">  name: string; </span><br><span class="line">&#125;</span><br><span class="line">type User = Name &amp; &#123; <span class="attr">age</span>: number  &#125;;</span><br></pre></td></tr></table></figure><p><strong>interface extends type</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type Name = &#123; </span><br><span class="line">  name: string; </span><br><span class="line">&#125;</span><br><span class="line">interface User extends Name &#123; </span><br><span class="line">  age: number; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>type extends interface</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface Name &#123; </span><br><span class="line">  name: string; </span><br><span class="line">&#125;</span><br><span class="line">type User = Name &amp; &#123; </span><br><span class="line">  age: number; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="不同之处"><a href="#不同之处" class="headerlink" title="不同之处"></a>不同之处</h2><h3 id="type-可以而-interface-不行"><a href="#type-可以而-interface-不行" class="headerlink" title="type 可以而 interface 不行"></a>type 可以而 interface 不行</h3><blockquote><p>type 可以声明基本类型别名，联合类型，元组等类型</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基本类型别名</span></span><br><span class="line">type Name = string</span><br><span class="line"></span><br><span class="line"><span class="comment">// 联合类型</span></span><br><span class="line">interface Dog &#123;</span><br><span class="line">    wong();</span><br><span class="line">&#125;</span><br><span class="line">interface Cat &#123;</span><br><span class="line">    miao();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Pet = Dog | Cat</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体定义数组每个位置的类型</span></span><br><span class="line">type PetList = [Dog, Pet]</span><br></pre></td></tr></table></figure><p><strong>type 语句中还可以使用 typeof 获取实例的 类型进行赋值</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 当你想获取一个变量的类型时，使用 typeof</span></span><br><span class="line"><span class="keyword">let</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">type B = <span class="keyword">typeof</span> div</span><br></pre></td></tr></table></figure><p><strong>其他骚操作</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">type StringOrNumber = string | number;  </span><br><span class="line">type Text = string | &#123; <span class="attr">text</span>: string &#125;;  </span><br><span class="line">type NameLookup = Dictionary&lt;string, Person&gt;;  </span><br><span class="line">type Callback&lt;T&gt; = <span class="function">(<span class="params">data: T</span>) =&gt;</span> <span class="keyword">void</span>;  </span><br><span class="line">type Pair&lt;T&gt; = [T, T];  </span><br><span class="line">type Coordinates = Pair&lt;number&gt;;  </span><br><span class="line">type Tree&lt;T&gt; = T | &#123; <span class="attr">left</span>: Tree&lt;T&gt;, <span class="attr">right</span>: Tree&lt;T&gt; &#125;;</span><br></pre></td></tr></table></figure><h3 id="interface-可以而-type-不行"><a href="#interface-可以而-type-不行" class="headerlink" title="interface 可以而 type 不行"></a>interface 可以而 type 不行</h3><blockquote><p><code>interface</code> 能够声明合并</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface User &#123;</span><br><span class="line">  name: string</span><br><span class="line">  age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface User &#123;</span><br><span class="line">  sex: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">User 接口为 &#123;</span></span><br><span class="line"><span class="comment">  name: string</span></span><br><span class="line"><span class="comment">  age: number</span></span><br><span class="line"><span class="comment">  sex: string </span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><blockquote><p>如果不清楚什么时候用<code>interface/type</code>，能用 <code>interface</code> 实现，就用 <code>interface</code> , 如果不能就用 <code>type</code></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;相同之处&quot;&gt;&lt;a href=&quot;#相同之处&quot; class=&quot;headerlink&quot; title=&quot;相同之处&quot;&gt;&lt;/a&gt;相同之处&lt;/h2&gt;&lt;h3 id=&quot;都可以描述一个对象或者函数&quot;&gt;&lt;a href=&quot;#都可以描述一个对象或者函数&quot; class=&quot;headerlink
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="JavaScript" scheme="http://blog.poetries.top/tags/JavaScript/"/>
    
      <category term="Typescript" scheme="http://blog.poetries.top/tags/Typescript/"/>
    
  </entry>
  
  <entry>
    <title>React Native之设备真机调试</title>
    <link href="http://blog.poetries.top/2019/09/26/rn-device-debug/"/>
    <id>http://blog.poetries.top/2019/09/26/rn-device-debug/</id>
    <published>2019-09-26T01:10:12.000Z</published>
    <updated>2019-12-16T02:35:06.843Z</updated>
    
    <content type="html"><![CDATA[<h2 id="开启-USB-调试"><a href="#开启-USB-调试" class="headerlink" title="开启 USB 调试"></a>开启 USB 调试</h2><blockquote><p>在默认情况下 <code>Android</code> 设备只能从应用市场来安装应用。你需要开启 <code>USB</code> 调试才能自由安装开发版本的 <code>APP</code></p></blockquote><h2 id="通过-USB-数据线连接设备"><a href="#通过-USB-数据线连接设备" class="headerlink" title="通过 USB 数据线连接设备"></a>通过 USB 数据线连接设备</h2><blockquote><p>下面检查你的设备是否能正确连接到 ADB（Android Debug Bridge），使用<code>adb devices</code>命令</p></blockquote><p><img src="http://blog.poetries.top/img-repo/20190926/1.png" alt></p><h2 id="运行应用"><a href="#运行应用" class="headerlink" title="运行应用"></a>运行应用</h2><p>现在你可以运行<code>react-native run-android</code>来在设备上安装并启动应用了</p><h2 id="从设备上访问开发服务器"><a href="#从设备上访问开发服务器" class="headerlink" title="从设备上访问开发服务器"></a>从设备上访问开发服务器</h2><blockquote><p>(Android 5.0 及以上)使用 <code>adb reverse</code> 命令</p></blockquote><p><strong> 方式一</strong></p><ul><li>运行<code>adb reverse tcp:8081 tcp:8081</code></li><li>在命令行执行 <code>adb shell input keyevent 82</code> 弹出开发者工具。打开热更新和远程调试</li></ul><p><strong>方式二</strong></p><blockquote><p>摇晃手机即可弹出开发者工具</p></blockquote><p><img src="http://blog.poetries.top/img-repo/20190926/2.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;开启-USB-调试&quot;&gt;&lt;a href=&quot;#开启-USB-调试&quot; class=&quot;headerlink&quot; title=&quot;开启 USB 调试&quot;&gt;&lt;/a&gt;开启 USB 调试&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;在默认情况下 &lt;code&gt;Android&lt;/code&gt; 设
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="react" scheme="http://blog.poetries.top/tags/react/"/>
    
      <category term="RN" scheme="http://blog.poetries.top/tags/RN/"/>
    
  </entry>
  
  <entry>
    <title>Set、WeakSet、Map及WeakMap</title>
    <link href="http://blog.poetries.top/2019/09/22/es6-set-weakSet-map-weakMap/"/>
    <id>http://blog.poetries.top/2019/09/22/es6-set-weakSet-map-weakMap/</id>
    <published>2019-09-22T07:50:43.000Z</published>
    <updated>2019-12-16T02:35:06.811Z</updated>
    
    <content type="html"><![CDATA[<ul><li><code>Set</code> 和 <code>Map</code> 主要的应用场景在于 <strong>数据重组</strong> 和 <strong>数据储存</strong></li><li><code>Set</code> 是一种叫做<strong>集合</strong>的数据结构，Map 是一种叫做<strong>字典</strong>的数据结构</li></ul><h3 id="1-集合（Set）"><a href="#1-集合（Set）" class="headerlink" title="1. 集合（Set）"></a>1. 集合（Set）</h3><blockquote><p><code>ES6</code> 新增的一种新的数据结构，类似于数组，但成员是唯一且无序的，没有重复的值。</p></blockquote><p><strong>Set 本身是一种构造函数，用来生成 Set 数据结构。</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Set</span>([iterable])</span><br></pre></td></tr></table></figure><p>举个例子：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>].forEach(<span class="function"><span class="params">x</span> =&gt;</span> s.add(x))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> s) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i)<span class="comment">// 1 2 3 4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去重数组的重复对象</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">[... new <span class="built_in">Set</span>(arr)]<span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure><p>Set 对象允许你储存任何类型的唯一值，无论是原始值或者是对象引用。</p><p>向 Set 加入值的时候，不会发生类型转换，所以<code>5</code>和<code>&quot;5&quot;</code>是两个不同的值。Set 内部判断两个值是否不同，使用的算法叫做“Same-value-zero equality”，它类似于<strong>精确相等</strong>运算符（<code>===</code>），主要的区别是<strong> Set 认为<code>NaN</code>等于自身，而精确相等运算符认为<code>NaN</code>不等于自身。</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">set</span> = new Set();</span><br><span class="line">let a = NaN;</span><br><span class="line">let b = NaN;</span><br><span class="line"><span class="keyword">set</span>.add(a);</span><br><span class="line"><span class="keyword">set</span>.add(b);</span><br><span class="line"><span class="keyword">set</span> // Set &#123;<span class="literal">NaN</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> set1 = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">set1.add(<span class="number">5</span>)</span><br><span class="line">set1.add(<span class="string">'5'</span>)</span><br><span class="line"><span class="built_in">console</span>.log([...set1])<span class="comment">// [5, "5"]</span></span><br></pre></td></tr></table></figure><ul><li><p>Set 实例属性</p><ul><li><p>constructor： 构造函数</p></li><li><p>size：元素数量</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">set</span> = new Set([1, 2, 3, 2, 1])</span><br><span class="line"></span><br><span class="line">console.log(<span class="keyword">set</span>.length)// undefined</span><br><span class="line">console.log(<span class="keyword">set</span>.size)// 3</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Set 实例方法</p><ul><li><p>操作方法</p><ul><li><p>add(value)：新增，相当于 array里的push</p></li><li><p>delete(value)：存在即删除集合中value</p></li><li><p>has(value)：判断集合中是否存在 value</p></li><li><p>clear()：清空集合</p><hr><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">set</span> = new Set()</span><br><span class="line"><span class="keyword">set</span>.add(1).add(2).add(1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>.has(1)// true</span><br><span class="line"><span class="keyword">set</span>.has(3)// false</span><br><span class="line"><span class="keyword">set</span>.delete(1)</span><br><span class="line"><span class="keyword">set</span>.has(1)// false</span><br></pre></td></tr></table></figure><p><code>Array.from</code> 方法可以将 Set 结构转为数组</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> items = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>])</span><br><span class="line"><span class="keyword">const</span> array = <span class="built_in">Array</span>.from(items)</span><br><span class="line"><span class="built_in">console</span>.log(array)<span class="comment">// [1, 2, 3]</span></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">const</span> arr = [...items]</span><br><span class="line"><span class="built_in">console</span>.log(arr)<span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>遍历方法（遍历顺序为插入顺序）</p><ul><li><p>keys()：返回一个包含集合中所有键的迭代器</p></li><li><p>values()：返回一个包含集合中所有值得迭代器</p></li><li><p>entries()：返回一个包含Set对象中所有元素得键值对迭代器</p></li><li><p>forEach(callbackFn,  thisArg)：用于对集合成员执行callbackFn操作，如果提供了 thisArg 参数，回调中的this会是这个参数，<strong>没有返回值</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">set</span> = new Set([1, 2, 3])</span><br><span class="line">console.log(<span class="keyword">set</span>.keys())// SetIterator &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">set</span>.values())// SetIterator &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">set</span>.entries())// SetIterator &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> <span class="keyword">set</span>.keys()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;<span class="comment">// 12 3</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> <span class="keyword">set</span>.entries()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;<span class="comment">// [1, 1][2, 2][3, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>.forEach((value, key) =&gt;  &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key + <span class="string">' : '</span> + value)</span><br><span class="line">&#125;)<span class="comment">// 1 : 12 : 23 : 3</span></span><br><span class="line"><span class="built_in">console</span>.log([...set])<span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure><p>Set 可默认遍历，默认迭代器生成函数是 values() 方法</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set</span>.prototype[<span class="built_in">Symbol</span>.iterator] === <span class="built_in">Set</span>.prototype.values<span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>所以， Set可以使用 map、filter 方法</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">set</span> = new Set([1, 2, 3])</span><br><span class="line"><span class="keyword">set</span> = new Set([...<span class="keyword">set</span>].map(item =&gt; item * 2))</span><br><span class="line">console.log([...<span class="keyword">set</span>])// [2, 4, 6]</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> = new Set([...<span class="keyword">set</span>].filter(item =&gt; (item &gt;= 4)))</span><br><span class="line">console.log([...<span class="keyword">set</span>])//[4, 6]</span><br></pre></td></tr></table></figure><p>因此，Set 很容易实现交集（Intersect）、并集（Union）、差集（Difference）</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> set1 = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="keyword">let</span> set2 = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> intersect = <span class="keyword">new</span> <span class="built_in">Set</span>([...set1].filter(<span class="function"><span class="params">value</span> =&gt;</span> set2.has(value)))</span><br><span class="line"><span class="keyword">let</span> union = <span class="keyword">new</span> <span class="built_in">Set</span>([...set1, ...set2])</span><br><span class="line"><span class="keyword">let</span> difference = <span class="keyword">new</span> <span class="built_in">Set</span>([...set1].filter(<span class="function"><span class="params">value</span> =&gt;</span> !set2.has(value)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(intersect)<span class="comment">// Set &#123;2, 3&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(union)<span class="comment">// Set &#123;1, 2, 3, 4&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(difference)<span class="comment">// Set &#123;1&#125;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h3 id="2-WeakSet"><a href="#2-WeakSet" class="headerlink" title="2. WeakSet"></a>2. WeakSet</h3><p>WeakSet 对象允许你将<strong>弱引用对象</strong>储存在一个集合中</p><p>WeakSet 与 Set 的区别：</p><ul><li>WeakSet 只能储存对象引用，不能存放值，而 Set 对象都可以</li><li>WeakSet 对象中储存的对象值都是被弱引用的，即垃圾回收机制不考虑 WeakSet 对该对象的应用，如果没有其他的变量或属性引用这个对象值，则这个对象将会被垃圾回收掉（不考虑该对象还存在于 WeakSet 中），所以，WeakSet 对象里有多少个成员元素，取决于垃圾回收机制有没有运行，运行前后成员个数可能不一致，遍历结束之后，有的成员可能取不到了（被垃圾回收了），WeakSet 对象是无法被遍历的（ES6 规定 WeakSet 不可遍历），也没有办法拿到它包含的所有元素</li></ul><p>属性：</p><ul><li><p>constructor：构造函数，任何一个具有 Iterable 接口的对象，都可以作参数</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line"><span class="keyword">const</span> weakset = <span class="keyword">new</span> <span class="built_in">WeakSet</span>(arr)</span><br><span class="line"><span class="built_in">console</span>.log(weakset)</span><br></pre></td></tr></table></figure></li></ul><p><img width="677" alt="2019-03-08 9 24 34" src="https://user-images.githubusercontent.com/19721451/54000905-3d36c980-4184-11e9-9ccf-0f13bc6dd414.png"></p><p>方法：</p><ul><li>add(value)：在WeakSet 对象中添加一个元素value</li><li>has(value)：判断 WeakSet 对象中是否包含value</li><li>delete(value)：删除元素 value</li><li>clear()：清空所有元素，<strong>注意该方法已废弃</strong></li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="built_in">WeakSet</span>()</span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> foo = &#123;&#125;</span><br><span class="line"></span><br><span class="line">ws.add(<span class="built_in">window</span>)</span><br><span class="line">ws.add(obj)</span><br><span class="line"></span><br><span class="line">ws.has(<span class="built_in">window</span>)<span class="comment">// true</span></span><br><span class="line">ws.has(foo)<span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">ws.delete(<span class="built_in">window</span>)<span class="comment">// true</span></span><br><span class="line">ws.has(<span class="built_in">window</span>)<span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="3-字典（Map）"><a href="#3-字典（Map）" class="headerlink" title="3. 字典（Map）"></a>3. 字典（Map）</h3><p>集合 与 字典 的区别：</p><ul><li>共同点：集合、字典 可以储存不重复的值</li><li>不同点：集合 是以 [value, value]的形式储存元素，字典 是以 [key, value] 的形式储存</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line"><span class="keyword">const</span> o = &#123;<span class="attr">p</span>: <span class="string">'haha'</span>&#125;</span><br><span class="line">m.set(o, <span class="string">'content'</span>)</span><br><span class="line">m.get(o)<span class="comment">// content</span></span><br><span class="line"></span><br><span class="line">m.has(o)<span class="comment">// true</span></span><br><span class="line">m.delete(o)<span class="comment">// true</span></span><br><span class="line">m.has(o)<span class="comment">// false</span></span><br></pre></td></tr></table></figure><p><strong>任何具有 Iterator 接口、且每个成员都是一个双元素的数组的数据结构</strong>都可以当作<code>Map</code>构造函数的参数，例如：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">set</span> = new Set([</span><br><span class="line">  ['foo', 1],</span><br><span class="line">  ['bar', 2]</span><br><span class="line">]);</span><br><span class="line">const m1 = new Map(<span class="keyword">set</span>);</span><br><span class="line">m1.<span class="keyword">get</span>('foo') // 1</span><br><span class="line"></span><br><span class="line">const m2 = new Map([['baz', 3]]);</span><br><span class="line">const m3 = new Map(m2);</span><br><span class="line">m3.<span class="keyword">get</span>('baz') // 3</span><br></pre></td></tr></table></figure><p>如果读取一个未知的键，则返回<code>undefined</code>。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">new Map().get(&apos;asfddfsasadf&apos;)</span><br><span class="line">// undefined</span><br></pre></td></tr></table></figure><p>注意，只有对同一个对象的引用，Map 结构才将其视为同一个键。这一点要非常小心。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const map = new Map();</span><br><span class="line"></span><br><span class="line">map.set([&apos;a&apos;], 555);</span><br><span class="line">map.get([&apos;a&apos;]) // undefined</span><br></pre></td></tr></table></figure><p>上面代码的<code>set</code>和<code>get</code>方法，表面是针对同一个键，但实际上这是两个值，内存地址是不一样的，因此<code>get</code>方法无法读取该键，返回<code>undefined</code>。</p><p>由上可知，Map 的键实际上是跟内存地址绑定的，只要内存地址不一样，就视为两个键。这就解决了同名属性碰撞（clash）的问题，我们扩展别人的库的时候，如果使用对象作为键名，就不用担心自己的属性与原作者的属性同名。</p><p>如果 Map 的键是一个简单类型的值（数字、字符串、布尔值），则只要两个值严格相等，Map 将其视为一个键，比如<code>0</code>和<code>-0</code>就是一个键，布尔值<code>true</code>和字符串<code>true</code>则是两个不同的键。另外，<code>undefined</code>和<code>null</code>也是两个不同的键。虽然<code>NaN</code>不严格相等于自身，但 Map 将其视为同一个键。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let map = new Map();</span><br><span class="line"></span><br><span class="line">map.set(-0, 123);</span><br><span class="line">map.get(+0) // 123</span><br><span class="line"></span><br><span class="line">map.set(true, 1);</span><br><span class="line">map.set(&apos;true&apos;, 2);</span><br><span class="line">map.get(true) // 1</span><br><span class="line"></span><br><span class="line">map.set(undefined, 3);</span><br><span class="line">map.set(null, 4);</span><br><span class="line">map.get(undefined) // 3</span><br><span class="line"></span><br><span class="line">map.set(NaN, 123);</span><br><span class="line">map.get(NaN) // 123</span><br></pre></td></tr></table></figure><p>Map 的属性及方法</p><p>属性：</p><ul><li><p>constructor：构造函数</p></li><li><p>size：返回字典中所包含的元素个数</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">'name'</span>, <span class="string">'An'</span>],</span><br><span class="line">  [<span class="string">'des'</span>, <span class="string">'JS'</span>]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">map.size <span class="comment">// 2</span></span><br></pre></td></tr></table></figure></li></ul><p>操作方法：</p><ul><li>set(key, value)：向字典中添加新元素</li><li>get(key)：通过键查找特定的数值并返回</li><li>has(key)：判断字典中是否存在键key</li><li>delete(key)：通过键 key 从字典中移除对应的数据</li><li>clear()：将这个字典中的所有元素删除</li></ul><p>遍历方法</p><ul><li>Keys()：将字典中包含的所有键名以迭代器形式返回</li><li>values()：将字典中包含的所有数值以迭代器形式返回</li><li>entries()：返回所有成员的迭代器</li><li>forEach()：遍历字典的所有成员</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">            [<span class="string">'name'</span>, <span class="string">'An'</span>],</span><br><span class="line">            [<span class="string">'des'</span>, <span class="string">'JS'</span>]</span><br><span class="line">        ]);</span><br><span class="line"><span class="built_in">console</span>.log(map.entries())<span class="comment">// MapIterator &#123;"name" =&gt; "An", "des" =&gt; "JS"&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(map.keys()) <span class="comment">// MapIterator &#123;"name", "des"&#125;</span></span><br></pre></td></tr></table></figure><p>Map 结构的默认遍历器接口（<code>Symbol.iterator</code>属性），就是<code>entries</code>方法。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">map[Symbol.iterator] === map.entries</span><br><span class="line">// true</span><br></pre></td></tr></table></figure><p>Map 结构转为数组结构，比较快速的方法是使用扩展运算符（<code>...</code>）。</p><p>对于 forEach ，看一个例子</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> reporter = &#123;</span><br><span class="line">  report: <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Key: %s, Value: %s"</span>, key, value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">    [<span class="string">'name'</span>, <span class="string">'An'</span>],</span><br><span class="line">    [<span class="string">'des'</span>, <span class="string">'JS'</span>]</span><br><span class="line">])</span><br><span class="line">map.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value, key, map</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.report(key, value);</span><br><span class="line">&#125;, reporter);</span><br><span class="line"><span class="comment">// Key: name, Value: An</span></span><br><span class="line"><span class="comment">// Key: des, Value: JS</span></span><br></pre></td></tr></table></figure><p>在这个例子中， forEach 方法的回调函数的 this，就指向 reporter</p><p><strong>与其他数据结构的相互转换</strong></p><ol><li><p>Map 转 Array</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">3</span>]])</span><br><span class="line"><span class="built_in">console</span>.log([...map])<span class="comment">// [[1, 1], [2, 2], [3, 3]]</span></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>Array 转 Map</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">3</span>]])</span><br><span class="line"><span class="built_in">console</span>.log(map)<span class="comment">// Map &#123;1 =&gt; 1, 2 =&gt; 2, 3 =&gt; 3&#125;</span></span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>Map 转 Object</p><p>因为 Object 的键名都为字符串，而Map 的键名为对象，所以转换的时候会把非字符串键名转换为字符串键名。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapToObj</span>(<span class="params">map</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> obj = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line">        obj[key] = value</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>().set(<span class="string">'name'</span>, <span class="string">'An'</span>).set(<span class="string">'des'</span>, <span class="string">'JS'</span>)</span><br><span class="line">mapToObj(map) <span class="comment">// &#123;name: "An", des: "JS"&#125;</span></span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>Object 转 Map</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">objToMap</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> <span class="built_in">Object</span>.keys(obj)) &#123;</span><br><span class="line">        map.set(key, obj[key])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">objToMap(&#123;<span class="string">'name'</span>: <span class="string">'An'</span>, <span class="string">'des'</span>: <span class="string">'JS'</span>&#125;) <span class="comment">// Map &#123;"name" =&gt; "An", "des" =&gt; "JS"&#125;</span></span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>Map 转 JSON</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapToJson</span>(<span class="params">map</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify([...map])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>().set(<span class="string">'name'</span>, <span class="string">'An'</span>).set(<span class="string">'des'</span>, <span class="string">'JS'</span>)</span><br><span class="line">mapToJson(map)<span class="comment">// [["name","An"],["des","JS"]]</span></span><br></pre></td></tr></table></figure></li></ol><ol start="6"><li><p>JSON 转 Map</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonToStrMap</span>(<span class="params">jsonStr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> objToMap(<span class="built_in">JSON</span>.parse(jsonStr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jsonToStrMap(<span class="string">'&#123;"name": "An", "des": "JS"&#125;'</span>) <span class="comment">// Map &#123;"name" =&gt; "An", "des" =&gt; "JS"&#125;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="4-WeakMap"><a href="#4-WeakMap" class="headerlink" title="4. WeakMap"></a>4. WeakMap</h3><p>WeakMap 对象是一组键值对的集合，其中的<strong>键是弱引用对象，而值可以是任意</strong>。</p><p><strong>注意，WeakMap 弱引用的只是键名，而不是键值。键值依然是正常引用。</strong></p><p>WeakMap 中，每个键对自己所引用对象的引用都是弱引用，在没有其他引用和该键引用同一对象，这个对象将会被垃圾回收（相应的key则变成无效的），所以，WeakMap 的 key 是不可枚举的。</p><p> 属性：</p><ul><li>constructor：构造函数</li></ul><p>方法：</p><ul><li>has(key)：判断是否有 key 关联对象</li><li>get(key)：返回key关联对象（没有则则返回 undefined）</li><li>set(key)：设置一组key关联对象</li><li>delete(key)：移除 key 的关联对象</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myElement = <span class="built_in">document</span>.getElementById(<span class="string">'logo'</span>);</span><br><span class="line"><span class="keyword">let</span> myWeakmap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"></span><br><span class="line">myWeakmap.set(myElement, &#123;<span class="attr">timesClicked</span>: <span class="number">0</span>&#125;);</span><br><span class="line"></span><br><span class="line">myElement.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> logoData = myWeakmap.get(myElement);</span><br><span class="line">  logoData.timesClicked++;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><h3 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h3><ul><li>Set<ul><li>成员唯一、无序且不重复</li><li>[value,  value]，键值与键名是一致的（或者说只有键值，没有键名）</li><li>可以遍历，方法有：add、delete、has</li></ul></li><li>WeakSet<ul><li>成员都是对象</li><li>成员都是弱引用，可以被垃圾回收机制回收，可以用来保存DOM节点，不容易造成内存泄漏</li><li>不能遍历，方法有add、delete、has</li></ul></li><li>Map<ul><li>本质上是键值对的集合，类似集合</li><li>可以遍历，方法很多可以跟各种数据格式转换</li></ul></li><li>WeakMap<ul><li>只接受对象作为键名（null除外），不接受其他类型的值作为键名</li><li>键名是弱引用，键值可以是任意的，键名所指向的对象可以被垃圾回收，此时键名是无效的</li><li>不能遍历，方法有get、set、has、delete</li></ul></li></ul><h3 id="6-扩展：Object与Set、Map"><a href="#6-扩展：Object与Set、Map" class="headerlink" title="6. 扩展：Object与Set、Map"></a>6. 扩展：Object与Set、Map</h3><ol><li><p>Object 与 Set</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Object</span></span><br><span class="line"><span class="keyword">const</span> properties1 = &#123;</span><br><span class="line">    <span class="string">'width'</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">'height'</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(properties1[<span class="string">'width'</span>]? <span class="literal">true</span>: <span class="literal">false</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Set</span></span><br><span class="line"><span class="keyword">const</span> properties2 = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">properties2.add(<span class="string">'width'</span>)</span><br><span class="line">properties2.add(<span class="string">'height'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(properties2.has(<span class="string">'width'</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p>Object 与 Map</p></li></ol><p>JS 中的对象（Object），本质上是键值对的集合（hash 结构）</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> element = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'App'</span>);</span><br><span class="line"></span><br><span class="line">data[element] = <span class="string">'metadata'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(data[<span class="string">'[object HTMLCollection]'</span>]) <span class="comment">// "metadata"</span></span><br></pre></td></tr></table></figure><p>但当以一个DOM节点作为对象 data 的键，对象会被自动转化为字符串[Object HTMLCollection]，所以说，Object 结构提供了 <strong>字符串-值</strong> 对应，Map则提供了 <strong>值-值</strong> 的对应</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;&lt;code&gt;Set&lt;/code&gt; 和 &lt;code&gt;Map&lt;/code&gt; 主要的应用场景在于 &lt;strong&gt;数据重组&lt;/strong&gt; 和 &lt;strong&gt;数据储存&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Set&lt;/code&gt; 是一种叫做&lt;strong&gt;
      
    
    </summary>
    
      <category term="Front-End" scheme="http://blog.poetries.top/categories/Front-End/"/>
    
    
      <category term="JavaScript" scheme="http://blog.poetries.top/tags/JavaScript/"/>
    
      <category term="ES6" scheme="http://blog.poetries.top/tags/ES6/"/>
    
  </entry>
  
</feed>
